<div class="max-w-2xl mx-auto px-4 py-8">
  <header class="mb-8">
    <div class="flex items-center gap-3 mb-2">
      <%= link_to settings_devices_path, class: "text-zinc-500 hover:text-zinc-300 transition-colors" do %>
        <%= icon "arrow-left", class: "size-5" %>
      <% end %>
      <h1 class="text-2xl font-bold text-zinc-100 font-mono truncate"><%= @device.name %></h1>
    </div>
    <p class="text-sm text-zinc-400">
      <% @active_hubs ||= @device.hubs.select(&:active?) %>
      <% if @active_hubs.any? %>
        <span class="inline-flex items-center gap-1">
          <span class="size-1.5 rounded-full bg-success-500"></span>
          Online
        </span>
      <% else %>
        <span class="inline-flex items-center gap-1">
          <span class="size-1.5 rounded-full bg-zinc-600"></span>
          Offline
        </span>
      <% end %>
    </p>
  </header>

  <%# Device Info %>
  <section class="bg-zinc-900/50 border border-zinc-800 rounded-lg p-4 lg:p-6 mb-6">
    <h2 class="text-sm font-medium text-zinc-400 uppercase tracking-wider mb-4">Device Information</h2>
    <dl class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <dt class="text-xs text-zinc-500">Name</dt>
        <dd class="text-sm text-zinc-200 font-mono mt-1"><%= @device.name %></dd>
      </div>
      <div>
        <dt class="text-xs text-zinc-500">Type</dt>
        <dd class="text-sm text-zinc-200 mt-1"><%= @device.device_type.titleize %></dd>
      </div>
      <div>
        <dt class="text-xs text-zinc-500">Fingerprint</dt>
        <dd class="text-sm text-zinc-200 font-mono mt-1"><%= @device.fingerprint || "—" %></dd>
      </div>
      <div>
        <dt class="text-xs text-zinc-500">Hubs</dt>
        <dd class="text-sm text-zinc-200 mt-1">
          <% @active_hubs ||= @device.hubs.select(&:active?) %>
          <% if @active_hubs.any? %>
            <%= @active_hubs.map(&:name).join(", ") %>
          <% else %>
            No active hubs
          <% end %>
        </dd>
      </div>
    </dl>
  </section>

  <%# Push Notifications %>
  <% @active_hubs ||= @device.hubs.select(&:active?) %>
  <% active_hub = @active_hubs.first %>
  <section class="bg-zinc-900/50 border border-zinc-800 rounded-lg p-4 lg:p-6"
           data-controller="push-subscription"
           data-push-subscription-device-id-value="<%= @device.id %>"
           data-push-subscription-hub-id-value="<%= active_hub&.id %>"
           data-push-subscription-sw-url-value="<%= pwa_service_worker_path %>"
           <% source_hub = @source_device&.hubs&.find(&:active?) if @source_device %>
           <% if source_hub %>
             data-push-subscription-source-hub-id-value="<%= source_hub.id %>"
           <% end %>>
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-sm font-medium text-zinc-400 uppercase tracking-wider">Push Notifications</h2>
      <span data-push-subscription-target="status" class="text-xs text-zinc-500"></span>
    </div>

    <% if active_hub.nil? %>
      <p class="text-sm text-zinc-500">
        Device must be online to configure push notifications.
      </p>
    <% else %>
      <div class="flex items-center justify-between gap-4">
        <div class="min-w-0">
          <p class="text-sm text-zinc-300">
            Receive browser push notifications when agents need your attention.
          </p>
          <% if @source_device && @source_device != @device %>
            <p class="text-xs text-zinc-500 mt-1">
              Keys will be copied from <strong class="text-zinc-400"><%= @source_device.name %></strong>
            </p>
          <% end %>
        </div>

        <div class="shrink-0 flex items-center gap-2">
          <%# CLI has keys + browser subscribed %>
          <div data-push-subscription-target="subscribedButtons" class="hidden flex items-center gap-2">
            <button data-action="push-subscription#test"
                    class="text-xs px-3 py-1.5 text-zinc-400 hover:text-zinc-200 bg-zinc-800 hover:bg-zinc-800/80 border border-zinc-700/50 rounded-lg transition-colors">
              Test
            </button>
            <button data-action="push-subscription#disable"
                    class="text-xs px-3 py-1.5 text-zinc-400 hover:text-red-400 bg-zinc-800 hover:bg-zinc-800/80 border border-zinc-700/50 rounded-lg transition-colors">
              Disable
            </button>
          </div>

          <%# CLI has keys but browser NOT subscribed %>
          <div data-push-subscription-target="enableBrowserButtons" class="hidden">
            <button data-action="push-subscription#enableBrowser"
                    class="text-xs px-3 py-1.5 text-primary-300 hover:text-primary-200 bg-primary-500/10 hover:bg-primary-500/20 border border-primary-500/20 rounded-lg transition-colors">
              Enable on this browser
            </button>
          </div>

          <%# CLI has NO keys — full enable flow %>
          <div data-push-subscription-target="enableButtons" class="hidden">
            <button data-action="push-subscription#enable"
                    class="text-xs px-3 py-1.5 text-primary-300 hover:text-primary-200 bg-primary-500/10 hover:bg-primary-500/20 border border-primary-500/20 rounded-lg transition-colors">
              Enable
            </button>
          </div>
        </div>
      </div>
    <% end %>
  </section>
</div>

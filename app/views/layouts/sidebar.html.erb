<!DOCTYPE html>
<html class="dark">
  <head>
    <title><%= content_for(:title) || "Botster" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Botster">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <meta name="bridge" content="<%= asset_path('workers/bridge.js') %>">
    <meta name="crypto-worker-url" content="<%= asset_path('workers/matrix_crypto.js') %>">
    <meta name="crypto-wasm-js-url" content="https://esm.sh/@matrix-org/matrix-sdk-crypto-wasm@15.3.0">

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-zinc-950 text-zinc-100 h-dvh font-sans antialiased flex flex-col" data-controller="hub" data-hub>
    <%= render Elements::SidebarComponent.new(class: "flex-1 min-h-0 flex flex-col overflow-y-auto") do |layout| %>
      <% layout.with_desktop_sidebar do %>
        <%= render "layouts/sidebar_content", sidebar_id: "desktop" %>
      <% end %>
      <% layout.with_mobile_sidebar do %>
        <%= render "layouts/sidebar_content", sidebar_id: "mobile" %>
      <% end %>

      <% layout.with_header do %>
        <%= turbo_stream_from [Current.user, :hubs] %>
        <%# Mobile header content - logo %>
        <%= link_to root_path, class: "flex items-center gap-2 text-primary-400" do %>
          <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          <span class="font-mono font-bold tracking-tight">botster</span>
        <% end %>
      <% end %>

      <%= yield %>
    <% end %>

    <%# Modals - available on all hub-scoped pages %>
    <% if Current.hub %>
      <%= turbo_stream_from Current.hub %>
      <%= render "hubs/new_agent_modal" %>
      <%= render "hubs/delete_agent_modal" %>
      <%= render "hubs/share_modal" %>
    <% end %>
  </body>
</html>

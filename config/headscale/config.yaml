# Headscale configuration for local development
# See: https://headscale.net/ref/configuration/

server_url: http://localhost:8080
listen_addr: 0.0.0.0:8080
metrics_listen_addr: 0.0.0.0:9090

# gRPC API (for remote CLI)
grpc_listen_addr: 0.0.0.0:50443
grpc_allow_insecure: true

# Noise protocol (Tailscale v2) - key auto-generated on first run
noise:
  private_key_path: /var/lib/headscale/noise_private.key

# Database
database:
  type: sqlite
  sqlite:
    path: /var/lib/headscale/db.sqlite

# Disable TLS for local dev (use reverse proxy in production)
tls_cert_path: ""
tls_key_path: ""

# DERP - embedded relay server
derp:
  server:
    enabled: true
    region_id: 999
    region_code: local
    region_name: "Local Dev"
    stun_listen_addr: 0.0.0.0:3478
    private_key_path: /var/lib/headscale/derp_private.key

  # Don't use external DERP regions for local dev
  urls: []
  paths: []
  auto_update_enabled: false
  update_frequency: 24h

# IP address allocation
prefixes:
  v4: 100.64.0.0/10
  v6: fd7a:115c:a1e0::/48
allocation: sequential

# DNS configuration
dns:
  magic_dns: true
  base_domain: tail.local
  nameservers:
    global: []
  extra_records: []

# Disable log streaming (not needed for local dev)
log:
  format: text
  level: info

# Node update check
disable_check_updates: true

# Ephemeral node cleanup
ephemeral_node_inactivity_timeout: 30m

# Policy (ACL) - can also be set via API
policy:
  mode: file
  path: ""

# OIDC - disabled for local dev (use pre-auth keys)
oidc:
  only_start_if_oidc_is_available: false
  issuer: ""
  client_id: ""
  client_secret: ""

var hA=Object.create;var AA=Object.defineProperty;var vA=Object.getOwnPropertyDescriptor;var uA=Object.getOwnPropertyNames,tA=Object.getOwnPropertySymbols,EA=Object.getPrototypeOf,iA=Object.prototype.hasOwnProperty,mA=Object.prototype.propertyIsEnumerable;var PA=(I,F,U)=>F in I?AA(I,F,{enumerable:!0,configurable:!0,writable:!0,value:U}):I[F]=U,rA=(I,F)=>{for(var U in F||(F={}))iA.call(F,U)&&PA(I,U,F[U]);if(tA)for(var U of tA(F))mA.call(F,U)&&PA(I,U,F[U]);return I};var BA=(I,F)=>()=>(F||I((F={exports:{}}).exports,F),F.exports);var RA=(I,F,U,W)=>{if(F&&typeof F=="object"||typeof F=="function")for(let C of uA(F))!iA.call(I,C)&&C!==U&&AA(I,C,{get:()=>F[C],enumerable:!(W=vA(F,C))||W.enumerable});return I};var jA=(I,F,U)=>(U=I!=null?hA(EA(I)):{},RA(F||!I||!I.__esModule?AA(U,"default",{value:I,enumerable:!0}):U,I));var sA=BA((q,$A)=>{(function(I,F){if(typeof q=="object"&&typeof $A=="object")$A.exports=F();else if(typeof define=="function"&&define.amd)define([],F);else{var U=F();for(var W in U)(typeof q=="object"?q:I)[W]=U[W]}})(self,function(){return(()=>{"use strict";var I={4567:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.AccessibilityManager=void 0;let o=t(9042),p=t(6114),s=t(9924),c=t(3656),P=t(844),n=t(5596),r=t(9631);class A extends P.Disposable{constructor(e,j){super(),this._terminal=e,this._renderService=j,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityTreeRoot=document.createElement("div"),this._accessibilityTreeRoot.classList.add("xterm-accessibility"),this._accessibilityTreeRoot.tabIndex=0,this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let k=0;k<this._terminal.rows;k++)this._rowElements[k]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[k]);if(this._topBoundaryFocusListener=k=>this._handleBoundaryFocus(k,0),this._bottomBoundaryFocusListener=k=>this._handleBoundaryFocus(k,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityTreeRoot.appendChild(this._rowContainer),this._renderRowsDebouncer=new s.TimeBasedDebouncer(this._renderRows.bind(this)),this._refreshRows(),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityTreeRoot.appendChild(this._liveRegion),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityTreeRoot),this.register(this._renderRowsDebouncer),this.register(this._terminal.onResize(k=>this._handleResize(k.rows))),this.register(this._terminal.onRender(k=>this._refreshRows(k.start,k.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(k=>this._handleChar(k))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(k=>this._handleTab(k))),this.register(this._terminal.onKey(k=>this._handleKey(k.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new n.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register((0,c.addDisposableDomListener)(window,"resize",()=>this._refreshRowsDimensions())),this.register((0,P.toDisposable)(()=>{(0,r.removeElementFromParent)(this._accessibilityTreeRoot),this._rowElements.length=0}))}_handleBoundaryFocus(e,j){let k=e.target,a=this._rowElements[j===0?1:this._rowElements.length-2];if(k.getAttribute("aria-posinset")===(j===0?"1":`${this._terminal.buffer.lines.length}`)||e.relatedTarget!==a)return;let l,h;if(j===0?(l=k,h=this._rowElements.pop(),this._rowContainer.removeChild(h)):(l=this._rowElements.shift(),h=k,this._rowContainer.removeChild(l)),l.removeEventListener("focus",this._topBoundaryFocusListener),h.removeEventListener("focus",this._bottomBoundaryFocusListener),j===0){let i=this._createAccessibilityTreeNode();this._rowElements.unshift(i),this._rowContainer.insertAdjacentElement("afterbegin",i)}else{let i=this._createAccessibilityTreeNode();this._rowElements.push(i),this._rowContainer.appendChild(i)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(j===0?-1:1),this._rowElements[j===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let j=this._rowContainer.children.length;j<this._terminal.rows;j++)this._rowElements[j]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[j]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let e=document.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_handleTab(e){for(let j=0;j<e;j++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=o.tooMuchOutput)),p.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityTreeRoot.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,p.isMac&&(0,r.removeElementFromParent)(this._liveRegion)}_handleKey(e){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(e)||this._charsToConsume.push(e)}_refreshRows(e,j){this._renderRowsDebouncer.refresh(e,j,this._terminal.rows)}_renderRows(e,j){let k=this._terminal.buffer,a=k.lines.length.toString();for(let l=e;l<=j;l++){let h=k.translateBufferLineToString(k.ydisp+l,!0),i=(k.ydisp+l+1).toString(),d=this._rowElements[l];d&&(h.length===0?d.innerText="\xA0":d.textContent=h,d.setAttribute("aria-posinset",i),d.setAttribute("aria-setsize",a))}this._announceCharacters()}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityTreeRoot.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}}B.AccessibilityManager=A},3614:(C,B)=>{function t(c){return c.replace(/\r?\n/g,"\r")}function o(c,P){return P?"\x1B[200~"+c+"\x1B[201~":c}function p(c,P,n){c=o(c=t(c),n.decPrivateModes.bracketedPasteMode),n.triggerDataEvent(c,!0),P.value=""}function s(c,P,n){let r=n.getBoundingClientRect(),A=c.clientX-r.left-10,$=c.clientY-r.top-10;P.style.width="20px",P.style.height="20px",P.style.left=`${A}px`,P.style.top=`${$}px`,P.style.zIndex="1000",P.focus()}Object.defineProperty(B,"__esModule",{value:!0}),B.rightClickHandler=B.moveTextAreaUnderMouseCursor=B.paste=B.handlePasteEvent=B.copyHandler=B.bracketTextForPaste=B.prepareTextForTerminal=void 0,B.prepareTextForTerminal=t,B.bracketTextForPaste=o,B.copyHandler=function(c,P){c.clipboardData&&c.clipboardData.setData("text/plain",P.selectionText),c.preventDefault()},B.handlePasteEvent=function(c,P,n){c.stopPropagation(),c.clipboardData&&p(c.clipboardData.getData("text/plain"),P,n)},B.paste=p,B.moveTextAreaUnderMouseCursor=s,B.rightClickHandler=function(c,P,n,r,A){s(c,P,n),A&&r.rightClickSelect(c),P.value=r.selectionText,P.select()}},7239:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.ColorContrastCache=void 0;let o=t(1505);B.ColorContrastCache=class{constructor(){this._color=new o.TwoKeyMap,this._css=new o.TwoKeyMap}setCss(p,s,c){this._css.set(p,s,c)}getCss(p,s){return this._css.get(p,s)}setColor(p,s,c){this._color.set(p,s,c)}getColor(p,s){return this._color.get(p,s)}clear(){this._color.clear(),this._css.clear()}}},9631:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.removeElementFromParent=void 0,B.removeElementFromParent=function(...t){var o;for(let p of t)(o=p==null?void 0:p.parentElement)===null||o===void 0||o.removeChild(p)}},3656:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.addDisposableDomListener=void 0,B.addDisposableDomListener=function(t,o,p,s){t.addEventListener(o,p,s);let c=!1;return{dispose:()=>{c||(c=!0,t.removeEventListener(o,p,s))}}}},6465:function(C,B,t){var o=this&&this.__decorate||function(A,$,e,j){var k,a=arguments.length,l=a<3?$:j===null?j=Object.getOwnPropertyDescriptor($,e):j;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(A,$,e,j);else for(var h=A.length-1;h>=0;h--)(k=A[h])&&(l=(a<3?k(l):a>3?k($,e,l):k($,e))||l);return a>3&&l&&Object.defineProperty($,e,l),l},p=this&&this.__param||function(A,$){return function(e,j){$(e,j,A)}};Object.defineProperty(B,"__esModule",{value:!0}),B.Linkifier2=void 0;let s=t(2585),c=t(8460),P=t(844),n=t(3656),r=class extends P.Disposable{constructor(A){super(),this._bufferService=A,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._activeLine=-1,this._onShowLinkUnderline=this.register(new c.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new c.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,P.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,P.toDisposable)(()=>{this._lastMouseEvent=void 0}))}get currentLink(){return this._currentLink}registerLinkProvider(A){return this._linkProviders.push(A),{dispose:()=>{let $=this._linkProviders.indexOf(A);$!==-1&&this._linkProviders.splice($,1)}}}attachToDom(A,$,e){this._element=A,this._mouseService=$,this._renderService=e,this.register((0,n.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,n.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(A){if(this._lastMouseEvent=A,!this._element||!this._mouseService)return;let $=this._positionFromMouseEvent(A,this._element,this._mouseService);if(!$)return;this._isMouseOut=!1;let e=A.composedPath();for(let j=0;j<e.length;j++){let k=e[j];if(k.classList.contains("xterm"))break;if(k.classList.contains("xterm-hover"))return}this._lastBufferCell&&$.x===this._lastBufferCell.x&&$.y===this._lastBufferCell.y||(this._handleHover($),this._lastBufferCell=$)}_handleHover(A){if(this._activeLine!==A.y)return this._clearCurrentLink(),void this._askForLink(A,!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,A)||(this._clearCurrentLink(),this._askForLink(A,!0))}_askForLink(A,$){var e,j;this._activeProviderReplies&&$||((e=this._activeProviderReplies)===null||e===void 0||e.forEach(a=>{a==null||a.forEach(l=>{l.link.dispose&&l.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=A.y);let k=!1;for(let[a,l]of this._linkProviders.entries())$?!((j=this._activeProviderReplies)===null||j===void 0)&&j.get(a)&&(k=this._checkLinkProviderResult(a,A,k)):l.provideLinks(A.y,h=>{var i,d;if(this._isMouseOut)return;let v=h==null?void 0:h.map(E=>({link:E}));(i=this._activeProviderReplies)===null||i===void 0||i.set(a,v),k=this._checkLinkProviderResult(a,A,k),((d=this._activeProviderReplies)===null||d===void 0?void 0:d.size)===this._linkProviders.length&&this._removeIntersectingLinks(A.y,this._activeProviderReplies)})}_removeIntersectingLinks(A,$){let e=new Set;for(let j=0;j<$.size;j++){let k=$.get(j);if(k)for(let a=0;a<k.length;a++){let l=k[a],h=l.link.range.start.y<A?0:l.link.range.start.x,i=l.link.range.end.y>A?this._bufferService.cols:l.link.range.end.x;for(let d=h;d<=i;d++){if(e.has(d)){k.splice(a--,1);break}e.add(d)}}}}_checkLinkProviderResult(A,$,e){var j;if(!this._activeProviderReplies)return e;let k=this._activeProviderReplies.get(A),a=!1;for(let l=0;l<A;l++)this._activeProviderReplies.has(l)&&!this._activeProviderReplies.get(l)||(a=!0);if(!a&&k){let l=k.find(h=>this._linkAtPosition(h.link,$));l&&(e=!0,this._handleNewLink(l))}if(this._activeProviderReplies.size===this._linkProviders.length&&!e)for(let l=0;l<this._activeProviderReplies.size;l++){let h=(j=this._activeProviderReplies.get(l))===null||j===void 0?void 0:j.find(i=>this._linkAtPosition(i.link,$));if(h){e=!0,this._handleNewLink(h);break}}return e}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(A){if(!this._element||!this._mouseService||!this._currentLink)return;let $=this._positionFromMouseEvent(A,this._element,this._mouseService);$&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,$)&&this._currentLink.link.activate(A,this._currentLink.link.text)}_clearCurrentLink(A,$){this._element&&this._currentLink&&this._lastMouseEvent&&(!A||!$||this._currentLink.link.range.start.y>=A&&this._currentLink.link.range.end.y<=$)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,P.disposeArray)(this._linkCacheDisposables))}_handleNewLink(A){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;let $=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);$&&this._linkAtPosition(A.link,$)&&(this._currentLink=A,this._currentLink.state={decorations:{underline:A.link.decorations===void 0||A.link.decorations.underline,pointerCursor:A.link.decorations===void 0||A.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,A.link,this._lastMouseEvent),A.link.decorations={},Object.defineProperties(A.link.decorations,{pointerCursor:{get:()=>{var e,j;return(j=(e=this._currentLink)===null||e===void 0?void 0:e.state)===null||j===void 0?void 0:j.decorations.pointerCursor},set:e=>{var j,k;((j=this._currentLink)===null||j===void 0?void 0:j.state)&&this._currentLink.state.decorations.pointerCursor!==e&&(this._currentLink.state.decorations.pointerCursor=e,this._currentLink.state.isHovered&&((k=this._element)===null||k===void 0||k.classList.toggle("xterm-cursor-pointer",e)))}},underline:{get:()=>{var e,j;return(j=(e=this._currentLink)===null||e===void 0?void 0:e.state)===null||j===void 0?void 0:j.decorations.underline},set:e=>{var j,k,a;((j=this._currentLink)===null||j===void 0?void 0:j.state)&&((a=(k=this._currentLink)===null||k===void 0?void 0:k.state)===null||a===void 0?void 0:a.decorations.underline)!==e&&(this._currentLink.state.decorations.underline=e,this._currentLink.state.isHovered&&this._fireUnderlineEvent(A.link,e))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(e=>{let j=e.start===0?0:e.start+1+this._bufferService.buffer.ydisp,k=this._currentLink?this._lastMouseEvent:void 0;if(this._clearCurrentLink(j,e.end+1+this._bufferService.buffer.ydisp),k&&this._element){let a=this._positionFromMouseEvent(k,this._element,this._mouseService);a&&this._askForLink(a,!1)}})))}_linkHover(A,$,e){var j;!((j=this._currentLink)===null||j===void 0)&&j.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent($,!0),this._currentLink.state.decorations.pointerCursor&&A.classList.add("xterm-cursor-pointer")),$.hover&&$.hover(e,$.text)}_fireUnderlineEvent(A,$){let e=A.range,j=this._bufferService.buffer.ydisp,k=this._createLinkUnderlineEvent(e.start.x-1,e.start.y-j-1,e.end.x,e.end.y-j-1,void 0);($?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(k)}_linkLeave(A,$,e){var j;!((j=this._currentLink)===null||j===void 0)&&j.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent($,!1),this._currentLink.state.decorations.pointerCursor&&A.classList.remove("xterm-cursor-pointer")),$.leave&&$.leave(e,$.text)}_linkAtPosition(A,$){let e=A.range.start.y*this._bufferService.cols+A.range.start.x,j=A.range.end.y*this._bufferService.cols+A.range.end.x,k=$.y*this._bufferService.cols+$.x;return e<=k&&k<=j}_positionFromMouseEvent(A,$,e){let j=e.getCoords(A,$,this._bufferService.cols,this._bufferService.rows);if(j)return{x:j[0],y:j[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(A,$,e,j,k){return{x1:A,y1:$,x2:e,y2:j,cols:this._bufferService.cols,fg:k}}};r=o([p(0,s.IBufferService)],r),B.Linkifier2=r},9042:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.tooMuchOutput=B.promptLabel=void 0,B.promptLabel="Terminal input",B.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(C,B,t){var o=this&&this.__decorate||function(r,A,$,e){var j,k=arguments.length,a=k<3?A:e===null?e=Object.getOwnPropertyDescriptor(A,$):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,A,$,e);else for(var l=r.length-1;l>=0;l--)(j=r[l])&&(a=(k<3?j(a):k>3?j(A,$,a):j(A,$))||a);return k>3&&a&&Object.defineProperty(A,$,a),a},p=this&&this.__param||function(r,A){return function($,e){A($,e,r)}};Object.defineProperty(B,"__esModule",{value:!0}),B.OscLinkProvider=void 0;let s=t(511),c=t(2585),P=class{constructor(r,A,$){this._bufferService=r,this._optionsService=A,this._oscLinkService=$}provideLinks(r,A){var $;let e=this._bufferService.buffer.lines.get(r-1);if(!e)return void A(void 0);let j=[],k=this._optionsService.rawOptions.linkHandler,a=new s.CellData,l=e.getTrimmedLength(),h=-1,i=-1,d=!1;for(let v=0;v<l;v++)if(i!==-1||e.hasContent(v)){if(e.loadCell(v,a),a.hasExtendedAttrs()&&a.extended.urlId){if(i===-1){i=v,h=a.extended.urlId;continue}d=a.extended.urlId!==h}else i!==-1&&(d=!0);if(d||i!==-1&&v===l-1){let E=($=this._oscLinkService.getLinkData(h))===null||$===void 0?void 0:$.uri;if(E){let m={start:{x:i+1,y:r},end:{x:v+(d||v!==l-1?0:1),y:r}},X=!1;if(!(k!=null&&k.allowNonHttpProtocols))try{let M=new URL(E);["http:","https:"].includes(M.protocol)||(X=!0)}catch(M){X=!0}X||j.push({text:E,range:m,activate:(M,T)=>k?k.activate(M,T,m):n(0,T),hover:(M,T)=>{var w;return(w=k==null?void 0:k.hover)===null||w===void 0?void 0:w.call(k,M,T,m)},leave:(M,T)=>{var w;return(w=k==null?void 0:k.leave)===null||w===void 0?void 0:w.call(k,M,T,m)}})}d=!1,a.hasExtendedAttrs()&&a.extended.urlId?(i=v,h=a.extended.urlId):(i=-1,h=-1)}}A(j)}};function n(r,A){if(confirm(`Do you want to navigate to ${A}?

WARNING: This link could potentially be dangerous`)){let $=window.open();if($){try{$.opener=null}catch(e){}$.location.href=A}else console.warn("Opening link blocked as opener could not be cleared")}}P=o([p(0,c.IBufferService),p(1,c.IOptionsService),p(2,c.IOscLinkService)],P),B.OscLinkProvider=P},6193:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.RenderDebouncer=void 0,B.RenderDebouncer=class{constructor(t,o){this._parentWindow=t,this._renderCallback=o,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(t){return this._refreshCallbacks.push(t),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(t,o,p){this._rowCount=p,t=t!==void 0?t:0,o=o!==void 0?o:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,t):t,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,o):o,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();let t=Math.max(this._rowStart,0),o=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(t,o),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let t of this._refreshCallbacks)t(0);this._refreshCallbacks=[]}}},5596:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.ScreenDprMonitor=void 0;let o=t(844);class p extends o.Disposable{constructor(c){super(),this._parentWindow=c,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,o.toDisposable)(()=>{this.clearListener()}))}setListener(c){this._listener&&this.clearListener(),this._listener=c,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var c;this._outerListener&&((c=this._resolutionMediaMatchList)===null||c===void 0||c.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}B.ScreenDprMonitor=p},3236:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.Terminal=void 0;let o=t(2950),p=t(1680),s=t(3614),c=t(2584),P=t(5435),n=t(9312),r=t(6114),A=t(3656),$=t(9042),e=t(4567),j=t(1296),k=t(7399),a=t(8460),l=t(8437),h=t(3230),i=t(4725),d=t(428),v=t(8934),E=t(6465),m=t(5114),X=t(8969),M=t(8055),T=t(4269),w=t(5941),g=t(3107),u=t(5744),f=t(9074),x=t(2585),b=t(3730),L=t(844),N=t(6731),D=typeof window!="undefined"?window.document:null;class V extends X.CoreTerminal{constructor(R={}){super(R),this.browser=r,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._onCursorMove=this.register(new a.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new a.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new a.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new a.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new a.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new a.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new a.EventEmitter),this._onBlur=this.register(new a.EventEmitter),this._onA11yCharEmitter=this.register(new a.EventEmitter),this._onA11yTabEmitter=this.register(new a.EventEmitter),this._onWillOpen=this.register(new a.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(E.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(b.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(f.DecorationService),this._instantiationService.setService(x.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((S,y)=>this.refresh(S,y))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(S=>this._reportWindowsOptions(S))),this.register(this._inputHandler.onColor(S=>this._handleColorEvent(S))),this.register((0,a.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,a.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,a.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,a.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(S=>this._afterResize(S.cols,S.rows))),this.register((0,L.toDisposable)(()=>{var S,y;this._customKeyEventHandler=void 0,(y=(S=this.element)===null||S===void 0?void 0:S.parentNode)===null||y===void 0||y.removeChild(this.element)}))}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(R){if(this._themeService)for(let S of R){let y,Q="";switch(S.index){case 256:y="foreground",Q="10";break;case 257:y="background",Q="11";break;case 258:y="cursor",Q="12";break;default:y="ansi",Q="4;"+S.index}switch(S.type){case 0:let G=M.color.toColorRGB(y==="ansi"?this._themeService.colors.ansi[S.index]:this._themeService.colors[y]);this.coreService.triggerDataEvent(`${c.C0.ESC}]${Q};${(0,w.toRgbString)(G)}${c.C1_ESCAPED.ST}`);break;case 1:if(y==="ansi")this._themeService.modifyColors(_=>_.ansi[S.index]=M.rgba.toColor(...S.color));else{let _=y;this._themeService.modifyColors(Z=>Z[_]=M.rgba.toColor(...S.color))}break;case 2:this._themeService.restoreColor(S.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(R){var S;R?!this._accessibilityManager&&this._renderService&&(this._accessibilityManager=new e.AccessibilityManager(this,this._renderService)):((S=this._accessibilityManager)===null||S===void 0||S.dispose(),this._accessibilityManager=void 0)}_handleTextAreaFocus(R){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(c.C0.ESC+"[I"),this.updateCursorStyle(R),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var R;return(R=this.textarea)===null||R===void 0?void 0:R.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(c.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let R=this.buffer.ybase+this.buffer.y,S=this.buffer.lines.get(R);if(!S)return;let y=Math.min(this.buffer.x,this.cols-1),Q=this._renderService.dimensions.css.cell.height,G=S.getWidth(y),_=this._renderService.dimensions.css.cell.width*G,Z=this.buffer.y*this._renderService.dimensions.css.cell.height,K=y*this._renderService.dimensions.css.cell.width;this.textarea.style.left=K+"px",this.textarea.style.top=Z+"px",this.textarea.style.width=_+"px",this.textarea.style.height=Q+"px",this.textarea.style.lineHeight=Q+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,A.addDisposableDomListener)(this.element,"copy",S=>{this.hasSelection()&&(0,s.copyHandler)(S,this._selectionService)}));let R=S=>(0,s.handlePasteEvent)(S,this.textarea,this.coreService);this.register((0,A.addDisposableDomListener)(this.textarea,"paste",R)),this.register((0,A.addDisposableDomListener)(this.element,"paste",R)),r.isFirefox?this.register((0,A.addDisposableDomListener)(this.element,"mousedown",S=>{S.button===2&&(0,s.rightClickHandler)(S,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,A.addDisposableDomListener)(this.element,"contextmenu",S=>{(0,s.rightClickHandler)(S,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),r.isLinux&&this.register((0,A.addDisposableDomListener)(this.element,"auxclick",S=>{S.button===1&&(0,s.moveTextAreaUnderMouseCursor)(S,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,A.addDisposableDomListener)(this.textarea,"keyup",R=>this._keyUp(R),!0)),this.register((0,A.addDisposableDomListener)(this.textarea,"keydown",R=>this._keyDown(R),!0)),this.register((0,A.addDisposableDomListener)(this.textarea,"keypress",R=>this._keyPress(R),!0)),this.register((0,A.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,A.addDisposableDomListener)(this.textarea,"compositionupdate",R=>this._compositionHelper.compositionupdate(R))),this.register((0,A.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,A.addDisposableDomListener)(this.textarea,"input",R=>this._inputEvent(R),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(R){var S;if(!R)throw new Error("Terminal requires a parent element.");R.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=R.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),this.element.setAttribute("tabindex","0"),R.appendChild(this.element);let y=D.createDocumentFragment();this._viewportElement=D.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),y.appendChild(this._viewportElement),this._viewportScrollArea=D.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=D.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=D.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),y.appendChild(this.screenElement),this.textarea=D.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",$.promptLabel),r.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(m.CoreBrowserService,this.textarea,(S=this._document.defaultView)!==null&&S!==void 0?S:window),this._instantiationService.setService(i.ICoreBrowserService,this._coreBrowserService),this.register((0,A.addDisposableDomListener)(this.textarea,"focus",Q=>this._handleTextAreaFocus(Q))),this.register((0,A.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(d.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(i.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(N.ThemeService),this._instantiationService.setService(i.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(T.CharacterJoinerService),this._instantiationService.setService(i.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(h.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(i.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(Q=>this._onRender.fire(Q))),this.onResize(Q=>this._renderService.resize(Q.cols,Q.rows)),this._compositionView=D.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(o.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(y);try{this._onWillOpen.fire(this.element)}catch(Q){}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(v.MouseService),this._instantiationService.setService(i.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(p.Viewport,Q=>this.scrollLines(Q,!0,1),this._viewportElement,this._viewportScrollArea),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(n.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(i.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(Q=>this.scrollLines(Q.amount,Q.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(Q=>this._renderService.handleSelectionChanged(Q.start,Q.end,Q.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(Q=>{this.textarea.value=Q,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(Q=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,A.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(g.BufferDecorationRenderer,this.screenElement)),this.register((0,A.addDisposableDomListener)(this.element,"mousedown",Q=>this._selectionService.handleMouseDown(Q))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager=new e.AccessibilityManager(this,this._renderService)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",Q=>this._handleScreenReaderModeOptionChange(Q))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(u.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",Q=>{!this._overviewRulerRenderer&&Q&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(u.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(j.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){let R=this,S=this.element;function y(_){let Z=R._mouseService.getMouseReportCoords(_,R.screenElement);if(!Z)return!1;let K,Y;switch(_.overrideType||_.type){case"mousemove":Y=32,_.buttons===void 0?(K=3,_.button!==void 0&&(K=_.button<3?_.button:3)):K=1&_.buttons?0:4&_.buttons?1:2&_.buttons?2:3;break;case"mouseup":Y=0,K=_.button<3?_.button:3;break;case"mousedown":Y=1,K=_.button<3?_.button:3;break;case"wheel":if(R.viewport.getLinesScrolled(_)===0)return!1;Y=_.deltaY<0?0:1,K=4;break;default:return!1}return!(Y===void 0||K===void 0||K>4)&&R.coreMouseService.triggerMouseEvent({col:Z.col,row:Z.row,x:Z.x,y:Z.y,button:K,action:Y,ctrl:_.ctrlKey,alt:_.altKey,shift:_.shiftKey})}let Q={mouseup:null,wheel:null,mousedrag:null,mousemove:null},G={mouseup:_=>(y(_),_.buttons||(this._document.removeEventListener("mouseup",Q.mouseup),Q.mousedrag&&this._document.removeEventListener("mousemove",Q.mousedrag)),this.cancel(_)),wheel:_=>(y(_),this.cancel(_,!0)),mousedrag:_=>{_.buttons&&y(_)},mousemove:_=>{_.buttons||y(_)}};this.register(this.coreMouseService.onProtocolChange(_=>{_?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(_)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&_?Q.mousemove||(S.addEventListener("mousemove",G.mousemove),Q.mousemove=G.mousemove):(S.removeEventListener("mousemove",Q.mousemove),Q.mousemove=null),16&_?Q.wheel||(S.addEventListener("wheel",G.wheel,{passive:!1}),Q.wheel=G.wheel):(S.removeEventListener("wheel",Q.wheel),Q.wheel=null),2&_?Q.mouseup||(Q.mouseup=G.mouseup):(this._document.removeEventListener("mouseup",Q.mouseup),Q.mouseup=null),4&_?Q.mousedrag||(Q.mousedrag=G.mousedrag):(this._document.removeEventListener("mousemove",Q.mousedrag),Q.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,A.addDisposableDomListener)(S,"mousedown",_=>{if(_.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(_))return y(_),Q.mouseup&&this._document.addEventListener("mouseup",Q.mouseup),Q.mousedrag&&this._document.addEventListener("mousemove",Q.mousedrag),this.cancel(_)})),this.register((0,A.addDisposableDomListener)(S,"wheel",_=>{if(!Q.wheel){if(!this.buffer.hasScrollback){let Z=this.viewport.getLinesScrolled(_);if(Z===0)return;let K=c.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(_.deltaY<0?"A":"B"),Y="";for(let O=0;O<Math.abs(Z);O++)Y+=K;return this.coreService.triggerDataEvent(Y,!0),this.cancel(_,!0)}return this.viewport.handleWheel(_)?this.cancel(_):void 0}},{passive:!1})),this.register((0,A.addDisposableDomListener)(S,"touchstart",_=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(_),this.cancel(_)},{passive:!0})),this.register((0,A.addDisposableDomListener)(S,"touchmove",_=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(_)?void 0:this.cancel(_)},{passive:!1}))}refresh(R,S){var y;(y=this._renderService)===null||y===void 0||y.refreshRows(R,S)}updateCursorStyle(R){var S;!((S=this._selectionService)===null||S===void 0)&&S.shouldColumnSelect(R)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(R,S,y=0){super.scrollLines(R,S,y),this.refresh(0,this.rows-1)}paste(R){(0,s.paste)(R,this.textarea,this.coreService)}attachCustomKeyEventHandler(R){this._customKeyEventHandler=R}registerLinkProvider(R){return this.linkifier2.registerLinkProvider(R)}registerCharacterJoiner(R){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let S=this._characterJoinerService.register(R);return this.refresh(0,this.rows-1),S}deregisterCharacterJoiner(R){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(R)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}addMarker(R){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+R)}registerDecoration(R){return this._decorationService.registerDecoration(R)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(R,S,y){this._selectionService.setSelection(R,S,y)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var R;(R=this._selectionService)===null||R===void 0||R.clearSelection()}selectAll(){var R;(R=this._selectionService)===null||R===void 0||R.selectAll()}selectLines(R,S){var y;(y=this._selectionService)===null||y===void 0||y.selectLines(R,S)}_keyDown(R){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(R)===!1)return!1;let S=this.browser.isMac&&this.options.macOptionIsMeta&&R.altKey;if(!S&&!this._compositionHelper.keydown(R))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this._bufferService.scrollToBottom(),!1;S||R.key!=="Dead"&&R.key!=="AltGraph"||(this._unprocessedDeadKey=!0);let y=(0,k.evaluateKeyboardEvent)(R,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(R),y.type===3||y.type===2){let Q=this.rows-1;return this.scrollLines(y.type===2?-Q:Q),this.cancel(R,!0)}return y.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,R)||(y.cancel&&this.cancel(R,!0),!y.key||!!(R.key&&!R.ctrlKey&&!R.altKey&&!R.metaKey&&R.key.length===1&&R.key.charCodeAt(0)>=65&&R.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(y.key!==c.C0.ETX&&y.key!==c.C0.CR||(this.textarea.value=""),this._onKey.fire({key:y.key,domEvent:R}),this._showCursor(),this.coreService.triggerDataEvent(y.key,!0),!this.optionsService.rawOptions.screenReaderMode||R.altKey||R.ctrlKey?this.cancel(R,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(R,S){let y=R.isMac&&!this.options.macOptionIsMeta&&S.altKey&&!S.ctrlKey&&!S.metaKey||R.isWindows&&S.altKey&&S.ctrlKey&&!S.metaKey||R.isWindows&&S.getModifierState("AltGraph");return S.type==="keypress"?y:y&&(!S.keyCode||S.keyCode>47)}_keyUp(R){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(R)===!1||(function(S){return S.keyCode===16||S.keyCode===17||S.keyCode===18}(R)||this.focus(),this.updateCursorStyle(R),this._keyPressHandled=!1)}_keyPress(R){let S;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(R)===!1)return!1;if(this.cancel(R),R.charCode)S=R.charCode;else if(R.which===null||R.which===void 0)S=R.keyCode;else{if(R.which===0||R.charCode===0)return!1;S=R.which}return!(!S||(R.altKey||R.ctrlKey||R.metaKey)&&!this._isThirdLevelShift(this.browser,R)||(S=String.fromCharCode(S),this._onKey.fire({key:S,domEvent:R}),this._showCursor(),this.coreService.triggerDataEvent(S,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(R){if(R.data&&R.inputType==="insertText"&&(!R.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let S=R.data;return this.coreService.triggerDataEvent(S,!0),this.cancel(R),!0}return!1}resize(R,S){R!==this.cols||S!==this.rows?super.resize(R,S):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(R,S){var y,Q;(y=this._charSizeService)===null||y===void 0||y.measure(),(Q=this.viewport)===null||Q===void 0||Q.syncScrollArea(!0)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let R=1;R<this.rows;R++)this.buffer.lines.push(this.buffer.getBlankLine(l.DEFAULT_ATTR_DATA));this.refresh(0,this.rows-1),this._onScroll.fire({position:this.buffer.ydisp,source:0})}}reset(){var R,S;this.options.rows=this.rows,this.options.cols=this.cols;let y=this._customKeyEventHandler;this._setup(),super.reset(),(R=this._selectionService)===null||R===void 0||R.reset(),this._decorationService.reset(),this._customKeyEventHandler=y,this.refresh(0,this.rows-1),(S=this.viewport)===null||S===void 0||S.syncScrollArea()}clearTextureAtlas(){var R;(R=this._renderService)===null||R===void 0||R.clearTextureAtlas()}_reportFocus(){var R;!((R=this.element)===null||R===void 0)&&R.classList.contains("focus")?this.coreService.triggerDataEvent(c.C0.ESC+"[I"):this.coreService.triggerDataEvent(c.C0.ESC+"[O")}_reportWindowsOptions(R){if(this._renderService)switch(R){case P.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:let S=this._renderService.dimensions.css.canvas.width.toFixed(0),y=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${c.C0.ESC}[4;${y};${S}t`);break;case P.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:let Q=this._renderService.dimensions.css.cell.width.toFixed(0),G=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${c.C0.ESC}[6;${G};${Q}t`)}}cancel(R,S){if(this.options.cancelEvents||S)return R.preventDefault(),R.stopPropagation(),!1}}B.Terminal=V},9924:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.TimeBasedDebouncer=void 0,B.TimeBasedDebouncer=class{constructor(t,o=1e3){this._renderCallback=t,this._debounceThresholdMS=o,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(t,o,p){this._rowCount=p,t=t!==void 0?t:0,o=o!==void 0?o:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,t):t,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,o):o;let s=Date.now();if(s-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=s,this._innerRefresh();else if(!this._additionalRefreshRequested){let c=s-this._lastRefreshMs,P=this._debounceThresholdMS-c;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},P)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let t=Math.max(this._rowStart,0),o=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(t,o)}}},1680:function(C,B,t){var o=this&&this.__decorate||function(A,$,e,j){var k,a=arguments.length,l=a<3?$:j===null?j=Object.getOwnPropertyDescriptor($,e):j;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(A,$,e,j);else for(var h=A.length-1;h>=0;h--)(k=A[h])&&(l=(a<3?k(l):a>3?k($,e,l):k($,e))||l);return a>3&&l&&Object.defineProperty($,e,l),l},p=this&&this.__param||function(A,$){return function(e,j){$(e,j,A)}};Object.defineProperty(B,"__esModule",{value:!0}),B.Viewport=void 0;let s=t(844),c=t(3656),P=t(4725),n=t(2585),r=class extends s.Disposable{constructor(A,$,e,j,k,a,l,h,i){super(),this._scrollLines=A,this._viewportElement=$,this._scrollArea=e,this._bufferService=j,this._optionsService=k,this._charSizeService=a,this._renderService=l,this._coreBrowserService=h,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,c.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(d=>this._activeBuffer=d.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(d=>this._renderDimensions=d)),this._handleThemeChange(i.colors),this.register(i.onChangeColors(d=>this._handleThemeChange(d))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea(),0)}_handleThemeChange(A){this._viewportElement.style.backgroundColor=A.background.css}_refresh(A){if(A)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;let $=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==$&&(this._lastRecordedBufferHeight=$,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}let A=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==A&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=A),this._refreshAnimationFrame=null}syncScrollArea(A=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(A);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(A)}_handleScroll(A){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._scrollLines(0);let $=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._scrollLines($)}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;let A=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(A*(this._smoothScrollState.target-this._smoothScrollState.origin)),A<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(A,$){let e=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!($<0&&this._viewportElement.scrollTop!==0||$>0&&e<this._lastRecordedBufferHeight)||(A.cancelable&&A.preventDefault(),!1)}handleWheel(A){let $=this._getPixelsScrolled(A);return $!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+$:this._smoothScrollState.target+=$,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=$,this._bubbleScroll(A,$))}_getPixelsScrolled(A){if(A.deltaY===0||A.shiftKey)return 0;let $=this._applyScrollModifier(A.deltaY,A);return A.deltaMode===WheelEvent.DOM_DELTA_LINE?$*=this._currentRowHeight:A.deltaMode===WheelEvent.DOM_DELTA_PAGE&&($*=this._currentRowHeight*this._bufferService.rows),$}getLinesScrolled(A){if(A.deltaY===0||A.shiftKey)return 0;let $=this._applyScrollModifier(A.deltaY,A);return A.deltaMode===WheelEvent.DOM_DELTA_PIXEL?($/=this._currentRowHeight+0,this._wheelPartialScroll+=$,$=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):A.deltaMode===WheelEvent.DOM_DELTA_PAGE&&($*=this._bufferService.rows),$}_applyScrollModifier(A,$){let e=this._optionsService.rawOptions.fastScrollModifier;return e==="alt"&&$.altKey||e==="ctrl"&&$.ctrlKey||e==="shift"&&$.shiftKey?A*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:A*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(A){this._lastTouchY=A.touches[0].pageY}handleTouchMove(A){let $=this._lastTouchY-A.touches[0].pageY;return this._lastTouchY=A.touches[0].pageY,$!==0&&(this._viewportElement.scrollTop+=$,this._bubbleScroll(A,$))}};r=o([p(3,n.IBufferService),p(4,n.IOptionsService),p(5,P.ICharSizeService),p(6,P.IRenderService),p(7,P.ICoreBrowserService),p(8,P.IThemeService)],r),B.Viewport=r},3107:function(C,B,t){var o=this&&this.__decorate||function(A,$,e,j){var k,a=arguments.length,l=a<3?$:j===null?j=Object.getOwnPropertyDescriptor($,e):j;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(A,$,e,j);else for(var h=A.length-1;h>=0;h--)(k=A[h])&&(l=(a<3?k(l):a>3?k($,e,l):k($,e))||l);return a>3&&l&&Object.defineProperty($,e,l),l},p=this&&this.__param||function(A,$){return function(e,j){$(e,j,A)}};Object.defineProperty(B,"__esModule",{value:!0}),B.BufferDecorationRenderer=void 0;let s=t(3656),c=t(4725),P=t(844),n=t(2585),r=class extends P.Disposable{constructor(A,$,e,j){super(),this._screenElement=A,this._bufferService=$,this._decorationService=e,this._renderService=j,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register((0,s.addDisposableDomListener)(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(k=>this._removeDecoration(k))),this.register((0,P.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let A of this._decorationService.decorations)this._renderDecoration(A);this._dimensionsChanged=!1}_renderDecoration(A){this._refreshStyle(A),this._dimensionsChanged&&this._refreshXPosition(A)}_createElement(A){var $;let e=document.createElement("div");e.classList.add("xterm-decoration"),e.style.width=`${Math.round((A.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,e.style.height=(A.options.height||1)*this._renderService.dimensions.css.cell.height+"px",e.style.top=(A.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",e.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let j=($=A.options.x)!==null&&$!==void 0?$:0;return j&&j>this._bufferService.cols&&(e.style.display="none"),this._refreshXPosition(A,e),e}_refreshStyle(A){let $=A.marker.line-this._bufferService.buffers.active.ydisp;if($<0||$>=this._bufferService.rows)A.element&&(A.element.style.display="none",A.onRenderEmitter.fire(A.element));else{let e=this._decorationElements.get(A);e||(e=this._createElement(A),A.element=e,this._decorationElements.set(A,e),this._container.appendChild(e)),e.style.top=$*this._renderService.dimensions.css.cell.height+"px",e.style.display=this._altBufferIsActive?"none":"block",A.onRenderEmitter.fire(e)}}_refreshXPosition(A,$=A.element){var e;if(!$)return;let j=(e=A.options.x)!==null&&e!==void 0?e:0;(A.options.anchor||"left")==="right"?$.style.right=j?j*this._renderService.dimensions.css.cell.width+"px":"":$.style.left=j?j*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(A){var $;($=this._decorationElements.get(A))===null||$===void 0||$.remove(),this._decorationElements.delete(A),A.dispose()}};r=o([p(1,n.IBufferService),p(2,n.IDecorationService),p(3,c.IRenderService)],r),B.BufferDecorationRenderer=r},5871:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.ColorZoneStore=void 0,B.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(t){if(t.options.overviewRulerOptions){for(let o of this._zones)if(o.color===t.options.overviewRulerOptions.color&&o.position===t.options.overviewRulerOptions.position){if(this._lineIntersectsZone(o,t.marker.line))return;if(this._lineAdjacentToZone(o,t.marker.line,t.options.overviewRulerOptions.position))return void this._addLineToZone(o,t.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=t.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=t.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=t.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=t.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:t.options.overviewRulerOptions.color,position:t.options.overviewRulerOptions.position,startBufferLine:t.marker.line,endBufferLine:t.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(t){this._linePadding=t}_lineIntersectsZone(t,o){return o>=t.startBufferLine&&o<=t.endBufferLine}_lineAdjacentToZone(t,o,p){return o>=t.startBufferLine-this._linePadding[p||"full"]&&o<=t.endBufferLine+this._linePadding[p||"full"]}_addLineToZone(t,o){t.startBufferLine=Math.min(t.startBufferLine,o),t.endBufferLine=Math.max(t.endBufferLine,o)}}},5744:function(C,B,t){var o=this&&this.__decorate||function(k,a,l,h){var i,d=arguments.length,v=d<3?a:h===null?h=Object.getOwnPropertyDescriptor(a,l):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(k,a,l,h);else for(var E=k.length-1;E>=0;E--)(i=k[E])&&(v=(d<3?i(v):d>3?i(a,l,v):i(a,l))||v);return d>3&&v&&Object.defineProperty(a,l,v),v},p=this&&this.__param||function(k,a){return function(l,h){a(l,h,k)}};Object.defineProperty(B,"__esModule",{value:!0}),B.OverviewRulerRenderer=void 0;let s=t(5871),c=t(3656),P=t(4725),n=t(844),r=t(2585),A={full:0,left:0,center:0,right:0},$={full:0,left:0,center:0,right:0},e={full:0,left:0,center:0,right:0},j=class extends n.Disposable{constructor(k,a,l,h,i,d,v){var E;super(),this._viewportElement=k,this._screenElement=a,this._bufferService=l,this._decorationService=h,this._renderService=i,this._optionsService=d,this._coreBrowseService=v,this._colorZoneStore=new s.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(E=this._viewportElement.parentElement)===null||E===void 0||E.insertBefore(this._canvas,this._viewportElement);let m=this._canvas.getContext("2d");if(!m)throw new Error("Ctx cannot be null");this._ctx=m,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,n.toDisposable)(()=>{var X;(X=this._canvas)===null||X===void 0||X.remove()}))}get _width(){return this._optionsService.options.overviewRulerWidth||0}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register((0,c.addDisposableDomListener)(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){let k=Math.floor(this._canvas.width/3),a=Math.ceil(this._canvas.width/3);$.full=this._canvas.width,$.left=k,$.center=a,$.right=k,this._refreshDrawHeightConstants(),e.full=0,e.left=0,e.center=$.left,e.right=$.left+$.center}_refreshDrawHeightConstants(){A.full=Math.round(2*this._coreBrowseService.dpr);let k=this._canvas.height/this._bufferService.buffer.lines.length,a=Math.round(Math.max(Math.min(k,12),6)*this._coreBrowseService.dpr);A.left=a,A.center=a,A.right=a}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*A.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*A.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*A.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*A.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let a of this._decorationService.decorations)this._colorZoneStore.addDecoration(a);this._ctx.lineWidth=1;let k=this._colorZoneStore.zones;for(let a of k)a.position!=="full"&&this._renderColorZone(a);for(let a of k)a.position==="full"&&this._renderColorZone(a);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(k){this._ctx.fillStyle=k.color,this._ctx.fillRect(e[k.position||"full"],Math.round((this._canvas.height-1)*(k.startBufferLine/this._bufferService.buffers.active.lines.length)-A[k.position||"full"]/2),$[k.position||"full"],Math.round((this._canvas.height-1)*((k.endBufferLine-k.startBufferLine)/this._bufferService.buffers.active.lines.length)+A[k.position||"full"]))}_queueRefresh(k,a){this._shouldUpdateDimensions=k||this._shouldUpdateDimensions,this._shouldUpdateAnchor=a||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};j=o([p(2,r.IBufferService),p(3,r.IDecorationService),p(4,P.IRenderService),p(5,r.IOptionsService),p(6,P.ICoreBrowserService)],j),B.OverviewRulerRenderer=j},2950:function(C,B,t){var o=this&&this.__decorate||function(r,A,$,e){var j,k=arguments.length,a=k<3?A:e===null?e=Object.getOwnPropertyDescriptor(A,$):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,A,$,e);else for(var l=r.length-1;l>=0;l--)(j=r[l])&&(a=(k<3?j(a):k>3?j(A,$,a):j(A,$))||a);return k>3&&a&&Object.defineProperty(A,$,a),a},p=this&&this.__param||function(r,A){return function($,e){A($,e,r)}};Object.defineProperty(B,"__esModule",{value:!0}),B.CompositionHelper=void 0;let s=t(4725),c=t(2585),P=t(2584),n=class{constructor(r,A,$,e,j,k){this._textarea=r,this._compositionView=A,this._bufferService=$,this._optionsService=e,this._coreService=j,this._renderService=k,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(r){this._compositionView.textContent=r.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(r){if(this._isComposing||this._isSendingComposition){if(r.keyCode===229||r.keyCode===16||r.keyCode===17||r.keyCode===18)return!1;this._finalizeComposition(!1)}return r.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(r){if(this._compositionView.classList.remove("active"),this._isComposing=!1,r){let A={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let $;this._isSendingComposition=!1,A.start+=this._dataAlreadySent.length,$=this._isComposing?this._textarea.value.substring(A.start,A.end):this._textarea.value.substring(A.start),$.length>0&&this._coreService.triggerDataEvent($,!0)}},0)}else{this._isSendingComposition=!1;let A=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(A,!0)}}_handleAnyTextareaChanges(){let r=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let A=this._textarea.value,$=A.replace(r,"");this._dataAlreadySent=$,A.length>r.length?this._coreService.triggerDataEvent($,!0):A.length<r.length?this._coreService.triggerDataEvent(`${P.C0.DEL}`,!0):A.length===r.length&&A!==r&&this._coreService.triggerDataEvent(A,!0)}},0)}updateCompositionElements(r){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let A=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),$=this._renderService.dimensions.css.cell.height,e=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,j=A*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=j+"px",this._compositionView.style.top=e+"px",this._compositionView.style.height=$+"px",this._compositionView.style.lineHeight=$+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let k=this._compositionView.getBoundingClientRect();this._textarea.style.left=j+"px",this._textarea.style.top=e+"px",this._textarea.style.width=Math.max(k.width,1)+"px",this._textarea.style.height=Math.max(k.height,1)+"px",this._textarea.style.lineHeight=k.height+"px"}r||setTimeout(()=>this.updateCompositionElements(!0),0)}}};n=o([p(2,c.IBufferService),p(3,c.IOptionsService),p(4,c.ICoreService),p(5,s.IRenderService)],n),B.CompositionHelper=n},9806:(C,B)=>{function t(o,p,s){let c=s.getBoundingClientRect(),P=o.getComputedStyle(s),n=parseInt(P.getPropertyValue("padding-left")),r=parseInt(P.getPropertyValue("padding-top"));return[p.clientX-c.left-n,p.clientY-c.top-r]}Object.defineProperty(B,"__esModule",{value:!0}),B.getCoords=B.getCoordsRelativeToElement=void 0,B.getCoordsRelativeToElement=t,B.getCoords=function(o,p,s,c,P,n,r,A,$){if(!n)return;let e=t(o,p,s);return e?(e[0]=Math.ceil((e[0]+($?r/2:0))/r),e[1]=Math.ceil(e[1]/A),e[0]=Math.min(Math.max(e[0],1),c+($?1:0)),e[1]=Math.min(Math.max(e[1],1),P),e):void 0}},9504:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.moveToCellSequence=void 0;let o=t(2584);function p(A,$,e,j){let k=A-s(A,e),a=$-s($,e),l=Math.abs(k-a)-function(h,i,d){let v=0,E=h-s(h,d),m=i-s(i,d);for(let X=0;X<Math.abs(E-m);X++){let M=c(h,i)==="A"?-1:1,T=d.buffer.lines.get(E+M*X);T!=null&&T.isWrapped&&v++}return v}(A,$,e);return r(l,n(c(A,$),j))}function s(A,$){let e=0,j=$.buffer.lines.get(A),k=j==null?void 0:j.isWrapped;for(;k&&A>=0&&A<$.rows;)e++,j=$.buffer.lines.get(--A),k=j==null?void 0:j.isWrapped;return e}function c(A,$){return A>$?"A":"B"}function P(A,$,e,j,k,a){let l=A,h=$,i="";for(;l!==e||h!==j;)l+=k?1:-1,k&&l>a.cols-1?(i+=a.buffer.translateBufferLineToString(h,!1,A,l),l=0,A=0,h++):!k&&l<0&&(i+=a.buffer.translateBufferLineToString(h,!1,0,A+1),l=a.cols-1,A=l,h--);return i+a.buffer.translateBufferLineToString(h,!1,A,l)}function n(A,$){let e=$?"O":"[";return o.C0.ESC+e+A}function r(A,$){A=Math.floor(A);let e="";for(let j=0;j<A;j++)e+=$;return e}B.moveToCellSequence=function(A,$,e,j){let k=e.buffer.x,a=e.buffer.y;if(!e.buffer.hasScrollback)return function(i,d,v,E,m,X){return p(d,E,m,X).length===0?"":r(P(i,d,i,d-s(d,m),!1,m).length,n("D",X))}(k,a,0,$,e,j)+p(a,$,e,j)+function(i,d,v,E,m,X){let M;M=p(d,E,m,X).length>0?E-s(E,m):d;let T=E,w=function(g,u,f,x,b,L){let N;return N=p(f,x,b,L).length>0?x-s(x,b):u,g<f&&N<=x||g>=f&&N<x?"C":"D"}(i,d,v,E,m,X);return r(P(i,M,v,T,w==="C",m).length,n(w,X))}(k,a,A,$,e,j);let l;if(a===$)return l=k>A?"D":"C",r(Math.abs(k-A),n(l,j));l=a>$?"D":"C";let h=Math.abs(a-$);return r(function(i,d){return d.cols-i}(a>$?A:k,e)+(h-1)*e.cols+1+((a>$?k:A)-1),n(l,j))}},1296:function(C,B,t){var o=this&&this.__decorate||function(i,d,v,E){var m,X=arguments.length,M=X<3?d:E===null?E=Object.getOwnPropertyDescriptor(d,v):E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(i,d,v,E);else for(var T=i.length-1;T>=0;T--)(m=i[T])&&(M=(X<3?m(M):X>3?m(d,v,M):m(d,v))||M);return X>3&&M&&Object.defineProperty(d,v,M),M},p=this&&this.__param||function(i,d){return function(v,E){d(v,E,i)}};Object.defineProperty(B,"__esModule",{value:!0}),B.DomRenderer=void 0;let s=t(9631),c=t(3787),P=t(2223),n=t(6171),r=t(4725),A=t(8055),$=t(8460),e=t(844),j=t(2585),k="xterm-dom-renderer-owner-",a="xterm-focus",l=1,h=class extends e.Disposable{constructor(i,d,v,E,m,X,M,T,w,g){super(),this._element=i,this._screenElement=d,this._viewportElement=v,this._linkifier2=E,this._charSizeService=X,this._optionsService=M,this._bufferService=T,this._coreBrowserService=w,this._terminalClass=l++,this._rowElements=[],this._cellToRowElements=[],this.onRequestRedraw=this.register(new $.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add("xterm-rows"),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add("xterm-selection"),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,n.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(g.onChangeColors(u=>this._injectCss(u))),this._injectCss(g.colors),this._rowFactory=m.createInstance(c.DomRendererRowFactory,document),this._element.classList.add(k+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(u=>this._handleLinkHover(u))),this.register(this._linkifier2.onHideLinkUnderline(u=>this._handleLinkLeave(u))),this.register((0,e.toDisposable)(()=>{this._element.classList.remove(k+this._terminalClass),(0,s.removeElementFromParent)(this._rowContainer,this._selectionContainer,this._themeStyleElement,this._dimensionsStyleElement)}))}_updateDimensions(){let i=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*i,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*i),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/i),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/i),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let v of this._rowElements)v.style.width=`${this.dimensions.css.canvas.width}px`,v.style.height=`${this.dimensions.css.cell.height}px`,v.style.lineHeight=`${this.dimensions.css.cell.height}px`,v.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let d=`${this._terminalSelector} .xterm-rows span { display: inline-block; height: 100%; vertical-align: top; width: ${this.dimensions.css.cell.width}px}`;this._dimensionsStyleElement.textContent=d,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(i){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let d=`${this._terminalSelector} .xterm-rows { color: ${i.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px;}`;d+=`${this._terminalSelector} span:not(.${c.BOLD_CLASS}) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.${c.BOLD_CLASS} { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.${c.ITALIC_CLASS} { font-style: italic;}`,d+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  box-shadow: none; }}",d+="@keyframes blink_block_"+this._terminalClass+` { 0% {  background-color: ${i.cursor.css};  color: ${i.cursorAccent.css}; } 50% {  background-color: ${i.cursorAccent.css};  color: ${i.cursor.css}; }}`,d+=`${this._terminalSelector} .xterm-rows:not(.xterm-focus) .${c.CURSOR_CLASS}.${c.CURSOR_STYLE_BLOCK_CLASS} { outline: 1px solid ${i.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .xterm-rows.xterm-focus .${c.CURSOR_CLASS}.${c.CURSOR_BLINK_CLASS}:not(.${c.CURSOR_STYLE_BLOCK_CLASS}) { animation: blink_box_shadow_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .xterm-rows.xterm-focus .${c.CURSOR_CLASS}.${c.CURSOR_BLINK_CLASS}.${c.CURSOR_STYLE_BLOCK_CLASS} { animation: blink_block_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .xterm-rows.xterm-focus .${c.CURSOR_CLASS}.${c.CURSOR_STYLE_BLOCK_CLASS} { background-color: ${i.cursor.css}; color: ${i.cursorAccent.css};}${this._terminalSelector} .xterm-rows .${c.CURSOR_CLASS}.${c.CURSOR_STYLE_BAR_CLASS} { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${i.cursor.css} inset;}${this._terminalSelector} .xterm-rows .${c.CURSOR_CLASS}.${c.CURSOR_STYLE_UNDERLINE_CLASS} { box-shadow: 0 -1px 0 ${i.cursor.css} inset;}`,d+=`${this._terminalSelector} .xterm-selection { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .xterm-selection div { position: absolute; background-color: ${i.selectionBackgroundOpaque.css};}${this._terminalSelector} .xterm-selection div { position: absolute; background-color: ${i.selectionInactiveBackgroundOpaque.css};}`;for(let[v,E]of i.ansi.entries())d+=`${this._terminalSelector} .xterm-fg-${v} { color: ${E.css}; }${this._terminalSelector} .xterm-bg-${v} { background-color: ${E.css}; }`;d+=`${this._terminalSelector} .xterm-fg-${P.INVERTED_DEFAULT_COLOR} { color: ${A.color.opaque(i.background).css}; }${this._terminalSelector} .xterm-bg-${P.INVERTED_DEFAULT_COLOR} { background-color: ${i.foreground.css}; }`,this._themeStyleElement.textContent=d}handleDevicePixelRatioChange(){this._updateDimensions()}_refreshRowElements(i,d){for(let v=this._rowElements.length;v<=d;v++){let E=document.createElement("div");this._rowContainer.appendChild(E),this._rowElements.push(E)}for(;this._rowElements.length>d;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(i,d){this._refreshRowElements(i,d),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions()}handleBlur(){this._rowContainer.classList.remove(a)}handleFocus(){this._rowContainer.classList.add(a)}handleSelectionChanged(i,d,v){for(;this._selectionContainer.children.length;)this._selectionContainer.removeChild(this._selectionContainer.children[0]);if(this._rowFactory.handleSelectionChanged(i,d,v),this.renderRows(0,this._bufferService.rows-1),!i||!d)return;let E=i[1]-this._bufferService.buffer.ydisp,m=d[1]-this._bufferService.buffer.ydisp,X=Math.max(E,0),M=Math.min(m,this._bufferService.rows-1);if(X>=this._bufferService.rows||M<0)return;let T=document.createDocumentFragment();if(v){let w=i[0]>d[0];T.appendChild(this._createSelectionElement(X,w?d[0]:i[0],w?i[0]:d[0],M-X+1))}else{let w=E===X?i[0]:0,g=X===m?d[0]:this._bufferService.cols;T.appendChild(this._createSelectionElement(X,w,g));let u=M-X-1;if(T.appendChild(this._createSelectionElement(X+1,0,this._bufferService.cols,u)),X!==M){let f=m===M?d[0]:this._bufferService.cols;T.appendChild(this._createSelectionElement(M,0,f))}}this._selectionContainer.appendChild(T)}_createSelectionElement(i,d,v,E=1){let m=document.createElement("div");return m.style.height=E*this.dimensions.css.cell.height+"px",m.style.top=i*this.dimensions.css.cell.height+"px",m.style.left=d*this.dimensions.css.cell.width+"px",m.style.width=this.dimensions.css.cell.width*(v-d)+"px",m}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions()}clear(){for(let i of this._rowElements)i.replaceChildren()}renderRows(i,d){let v=this._bufferService.buffer.ybase+this._bufferService.buffer.y,E=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),m=this._optionsService.rawOptions.cursorBlink;for(let X=i;X<=d;X++){let M=this._rowElements[X],T=X+this._bufferService.buffer.ydisp,w=this._bufferService.buffer.lines.get(T),g=this._optionsService.rawOptions.cursorStyle;this._cellToRowElements[X]&&this._cellToRowElements[X].length===this._bufferService.cols||(this._cellToRowElements[X]=new Int16Array(this._bufferService.cols)),M.replaceChildren(this._rowFactory.createRow(w,T,T===v,g,E,m,this.dimensions.css.cell.width,this._bufferService.cols,this._cellToRowElements[X]))}}get _terminalSelector(){return`.${k}${this._terminalClass}`}_handleLinkHover(i){this._setCellUnderline(i.x1,i.x2,i.y1,i.y2,i.cols,!0)}_handleLinkLeave(i){this._setCellUnderline(i.x1,i.x2,i.y1,i.y2,i.cols,!1)}_setCellUnderline(i,d,v,E,m,X){if(i=this._cellToRowElements[v][i],d=this._cellToRowElements[E][d],i!==-1&&d!==-1)for(;i!==d||v!==E;){let M=this._rowElements[v];if(!M)return;let T=M.children[i];T&&(T.style.textDecoration=X?"underline":"none"),++i>=m&&(i=0,v++)}}};h=o([p(4,j.IInstantiationService),p(5,r.ICharSizeService),p(6,j.IOptionsService),p(7,j.IBufferService),p(8,r.ICoreBrowserService),p(9,r.IThemeService)],h),B.DomRenderer=h},3787:function(C,B,t){var o=this&&this.__decorate||function(l,h,i,d){var v,E=arguments.length,m=E<3?h:d===null?d=Object.getOwnPropertyDescriptor(h,i):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(l,h,i,d);else for(var X=l.length-1;X>=0;X--)(v=l[X])&&(m=(E<3?v(m):E>3?v(h,i,m):v(h,i))||m);return E>3&&m&&Object.defineProperty(h,i,m),m},p=this&&this.__param||function(l,h){return function(i,d){h(i,d,l)}};Object.defineProperty(B,"__esModule",{value:!0}),B.DomRendererRowFactory=B.CURSOR_STYLE_UNDERLINE_CLASS=B.CURSOR_STYLE_BAR_CLASS=B.CURSOR_STYLE_BLOCK_CLASS=B.CURSOR_BLINK_CLASS=B.CURSOR_CLASS=B.STRIKETHROUGH_CLASS=B.UNDERLINE_CLASS=B.ITALIC_CLASS=B.DIM_CLASS=B.BOLD_CLASS=void 0;let s=t(2223),c=t(643),P=t(511),n=t(2585),r=t(8055),A=t(4725),$=t(4269),e=t(6171),j=t(3734);B.BOLD_CLASS="xterm-bold",B.DIM_CLASS="xterm-dim",B.ITALIC_CLASS="xterm-italic",B.UNDERLINE_CLASS="xterm-underline",B.STRIKETHROUGH_CLASS="xterm-strikethrough",B.CURSOR_CLASS="xterm-cursor",B.CURSOR_BLINK_CLASS="xterm-cursor-blink",B.CURSOR_STYLE_BLOCK_CLASS="xterm-cursor-block",B.CURSOR_STYLE_BAR_CLASS="xterm-cursor-bar",B.CURSOR_STYLE_UNDERLINE_CLASS="xterm-cursor-underline";let k=class{constructor(l,h,i,d,v,E,m){this._document=l,this._characterJoinerService=h,this._optionsService=i,this._coreBrowserService=d,this._coreService=v,this._decorationService=E,this._themeService=m,this._workCell=new P.CellData,this._columnSelectMode=!1}handleSelectionChanged(l,h,i){this._selectionStart=l,this._selectionEnd=h,this._columnSelectMode=i}createRow(l,h,i,d,v,E,m,X,M){let T=this._document.createDocumentFragment(),w=this._characterJoinerService.getJoinedCharacters(h),g=0;for(let b=Math.min(l.length,X)-1;b>=0;b--)if(l.loadCell(b,this._workCell).getCode()!==c.NULL_CELL_CODE||i&&b===v){g=b+1;break}let u=this._themeService.colors,f=-1,x=0;for(;x<g;x++){l.loadCell(x,this._workCell);let b=this._workCell.getWidth();if(b===0){M[x]=f;continue}let L=!1,N=x,D=this._workCell;if(w.length>0&&x===w[0][0]){L=!0;let O=w.shift();D=new $.JoinedCellData(this._workCell,l.translateToString(!0,O[0],O[1]),O[1]-O[0]),N=O[1]-1,b=D.getWidth()}let V=this._document.createElement("span");if(b>1&&(V.style.width=m*b+"px"),L&&(V.style.display="inline",v>=x&&v<=N&&(v=x)),!this._coreService.isCursorHidden&&i&&x===v)switch(V.classList.add(B.CURSOR_CLASS),E&&V.classList.add(B.CURSOR_BLINK_CLASS),d){case"bar":V.classList.add(B.CURSOR_STYLE_BAR_CLASS);break;case"underline":V.classList.add(B.CURSOR_STYLE_UNDERLINE_CLASS);break;default:V.classList.add(B.CURSOR_STYLE_BLOCK_CLASS)}if(D.isBold()&&V.classList.add(B.BOLD_CLASS),D.isItalic()&&V.classList.add(B.ITALIC_CLASS),D.isDim()&&V.classList.add(B.DIM_CLASS),D.isInvisible()?V.textContent=c.WHITESPACE_CELL_CHAR:V.textContent=D.getChars()||c.WHITESPACE_CELL_CHAR,D.isUnderline()&&(V.classList.add(`${B.UNDERLINE_CLASS}-${D.extended.underlineStyle}`),V.textContent===" "&&(V.textContent="\xA0"),!D.isUnderlineColorDefault()))if(D.isUnderlineColorRGB())V.style.textDecorationColor=`rgb(${j.AttributeData.toColorRGB(D.getUnderlineColor()).join(",")})`;else{let O=D.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&D.isBold()&&O<8&&(O+=8),V.style.textDecorationColor=u.ansi[O].css}D.isStrikethrough()&&V.classList.add(B.STRIKETHROUGH_CLASS);let H=D.getFgColor(),R=D.getFgColorMode(),S=D.getBgColor(),y=D.getBgColorMode(),Q=!!D.isInverse();if(Q){let O=H;H=S,S=O;let gA=R;R=y,y=gA}let G,_,Z=!1;this._decorationService.forEachDecorationAtCell(x,h,void 0,O=>{O.options.layer!=="top"&&Z||(O.backgroundColorRGB&&(y=50331648,S=O.backgroundColorRGB.rgba>>8&16777215,G=O.backgroundColorRGB),O.foregroundColorRGB&&(R=50331648,H=O.foregroundColorRGB.rgba>>8&16777215,_=O.foregroundColorRGB),Z=O.options.layer==="top")});let K=this._isCellInSelection(x,h),Y;switch(Z||u.selectionForeground&&K&&(R=50331648,H=u.selectionForeground.rgba>>8&16777215,_=u.selectionForeground),K&&(G=this._coreBrowserService.isFocused?u.selectionBackgroundOpaque:u.selectionInactiveBackgroundOpaque,Z=!0),Z&&V.classList.add("xterm-decoration-top"),y){case 16777216:case 33554432:Y=u.ansi[S],V.classList.add(`xterm-bg-${S}`);break;case 50331648:Y=r.rgba.toColor(S>>16,S>>8&255,255&S),this._addStyle(V,`background-color:#${a((S>>>0).toString(16),"0",6)}`);break;default:Q?(Y=u.foreground,V.classList.add(`xterm-bg-${s.INVERTED_DEFAULT_COLOR}`)):Y=u.background}switch(G||D.isDim()&&(G=r.color.multiplyOpacity(Y,.5)),R){case 16777216:case 33554432:D.isBold()&&H<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(H+=8),this._applyMinimumContrast(V,Y,u.ansi[H],D,G,void 0)||V.classList.add(`xterm-fg-${H}`);break;case 50331648:let O=r.rgba.toColor(H>>16&255,H>>8&255,255&H);this._applyMinimumContrast(V,Y,O,D,G,_)||this._addStyle(V,`color:#${a(H.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(V,Y,u.foreground,D,G,void 0)||Q&&V.classList.add(`xterm-fg-${s.INVERTED_DEFAULT_COLOR}`)}T.appendChild(V),M[x]=++f,x=N}return x<X-1&&M.subarray(x).fill(++f),T}_applyMinimumContrast(l,h,i,d,v,E){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,e.excludeFromContrastRatioDemands)(d.getCode()))return!1;let m;return v||E||(m=this._themeService.colors.contrastCache.getColor(h.rgba,i.rgba)),m===void 0&&(m=r.color.ensureContrastRatio(v||h,E||i,this._optionsService.rawOptions.minimumContrastRatio),this._themeService.colors.contrastCache.setColor((v||h).rgba,(E||i).rgba,m!=null?m:null)),!!m&&(this._addStyle(l,`color:${m.css}`),!0)}_addStyle(l,h){l.setAttribute("style",`${l.getAttribute("style")||""}${h};`)}_isCellInSelection(l,h){let i=this._selectionStart,d=this._selectionEnd;return!(!i||!d)&&(this._columnSelectMode?i[0]<=d[0]?l>=i[0]&&h>=i[1]&&l<d[0]&&h<=d[1]:l<i[0]&&h>=i[1]&&l>=d[0]&&h<=d[1]:h>i[1]&&h<d[1]||i[1]===d[1]&&h===i[1]&&l>=i[0]&&l<d[0]||i[1]<d[1]&&h===d[1]&&l<d[0]||i[1]<d[1]&&h===i[1]&&l>=i[0])}};function a(l,h,i){for(;l.length<i;)l=h+l;return l}k=o([p(1,A.ICharacterJoinerService),p(2,n.IOptionsService),p(3,A.ICoreBrowserService),p(4,n.ICoreService),p(5,n.IDecorationService),p(6,A.IThemeService)],k),B.DomRendererRowFactory=k},2223:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.TEXT_BASELINE=B.DIM_OPACITY=B.INVERTED_DEFAULT_COLOR=void 0;let o=t(6114);B.INVERTED_DEFAULT_COLOR=257,B.DIM_OPACITY=.5,B.TEXT_BASELINE=o.isFirefox||o.isLegacyEdge?"bottom":"ideographic"},6171:(C,B)=>{function t(o){return 57508<=o&&o<=57558}Object.defineProperty(B,"__esModule",{value:!0}),B.createRenderDimensions=B.excludeFromContrastRatioDemands=B.isRestrictedPowerlineGlyph=B.isPowerlineGlyph=B.throwIfFalsy=void 0,B.throwIfFalsy=function(o){if(!o)throw new Error("value must not be falsy");return o},B.isPowerlineGlyph=t,B.isRestrictedPowerlineGlyph=function(o){return 57520<=o&&o<=57527},B.excludeFromContrastRatioDemands=function(o){return t(o)||function(p){return 9472<=p&&p<=9631}(o)},B.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.SelectionModel=void 0,B.SelectionModel=class{constructor(t){this._bufferService=t,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let t=this.selectionStart[0]+this.selectionStartLength;return t>this._bufferService.cols?t%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)-1]:[t%this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)]:[t,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let t=this.selectionStart[0]+this.selectionStartLength;return t>this._bufferService.cols?[t%this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)]:[Math.max(t,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let t=this.selectionStart,o=this.selectionEnd;return!(!t||!o)&&(t[1]>o[1]||t[1]===o[1]&&t[0]>o[0])}handleTrim(t){return this.selectionStart&&(this.selectionStart[1]-=t),this.selectionEnd&&(this.selectionEnd[1]-=t),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(C,B,t){var o=this&&this.__decorate||function(A,$,e,j){var k,a=arguments.length,l=a<3?$:j===null?j=Object.getOwnPropertyDescriptor($,e):j;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(A,$,e,j);else for(var h=A.length-1;h>=0;h--)(k=A[h])&&(l=(a<3?k(l):a>3?k($,e,l):k($,e))||l);return a>3&&l&&Object.defineProperty($,e,l),l},p=this&&this.__param||function(A,$){return function(e,j){$(e,j,A)}};Object.defineProperty(B,"__esModule",{value:!0}),B.CharSizeService=void 0;let s=t(2585),c=t(8460),P=t(844),n=class extends P.Disposable{constructor(A,$,e){super(),this._optionsService=e,this.width=0,this.height=0,this._onCharSizeChange=this.register(new c.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new r(A,$,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let A=this._measureStrategy.measure();A.width===this.width&&A.height===this.height||(this.width=A.width,this.height=A.height,this._onCharSizeChange.fire())}};n=o([p(2,s.IOptionsService)],n),B.CharSizeService=n;class r{constructor($,e,j){this._document=$,this._parentElement=e,this._optionsService=j,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W",this._measureElement.setAttribute("aria-hidden","true"),this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;let $=this._measureElement.getBoundingClientRect();return $.width!==0&&$.height!==0&&(this._result.width=$.width,this._result.height=Math.ceil($.height)),this._result}}},4269:function(C,B,t){var o=this&&this.__decorate||function($,e,j,k){var a,l=arguments.length,h=l<3?e:k===null?k=Object.getOwnPropertyDescriptor(e,j):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate($,e,j,k);else for(var i=$.length-1;i>=0;i--)(a=$[i])&&(h=(l<3?a(h):l>3?a(e,j,h):a(e,j))||h);return l>3&&h&&Object.defineProperty(e,j,h),h},p=this&&this.__param||function($,e){return function(j,k){e(j,k,$)}};Object.defineProperty(B,"__esModule",{value:!0}),B.CharacterJoinerService=B.JoinedCellData=void 0;let s=t(3734),c=t(643),P=t(511),n=t(2585);class r extends s.AttributeData{constructor(e,j,k){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=j,this._width=k}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}B.JoinedCellData=r;let A=class nA{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new P.CellData}register(e){let j={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(j),j.id}deregister(e){for(let j=0;j<this._characterJoiners.length;j++)if(this._characterJoiners[j].id===e)return this._characterJoiners.splice(j,1),!0;return!1}getJoinedCharacters(e){if(this._characterJoiners.length===0)return[];let j=this._bufferService.buffer.lines.get(e);if(!j||j.length===0)return[];let k=[],a=j.translateToString(!0),l=0,h=0,i=0,d=j.getFg(0),v=j.getBg(0);for(let E=0;E<j.getTrimmedLength();E++)if(j.loadCell(E,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==d||this._workCell.bg!==v){if(E-l>1){let m=this._getJoinedRanges(a,i,h,j,l);for(let X=0;X<m.length;X++)k.push(m[X])}l=E,i=h,d=this._workCell.fg,v=this._workCell.bg}h+=this._workCell.getChars().length||c.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-l>1){let E=this._getJoinedRanges(a,i,h,j,l);for(let m=0;m<E.length;m++)k.push(E[m])}return k}_getJoinedRanges(e,j,k,a,l){let h=e.substring(j,k),i=[];try{i=this._characterJoiners[0].handler(h)}catch(d){console.error(d)}for(let d=1;d<this._characterJoiners.length;d++)try{let v=this._characterJoiners[d].handler(h);for(let E=0;E<v.length;E++)nA._mergeRanges(i,v[E])}catch(v){console.error(v)}return this._stringRangesToCellRanges(i,a,l),i}_stringRangesToCellRanges(e,j,k){let a=0,l=!1,h=0,i=e[a];if(i){for(let d=k;d<this._bufferService.cols;d++){let v=j.getWidth(d),E=j.getString(d).length||c.WHITESPACE_CELL_CHAR.length;if(v!==0){if(!l&&i[0]<=h&&(i[0]=d,l=!0),i[1]<=h){if(i[1]=d,i=e[++a],!i)break;i[0]<=h?(i[0]=d,l=!0):l=!1}h+=E}}i&&(i[1]=this._bufferService.cols)}}static _mergeRanges(e,j){let k=!1;for(let a=0;a<e.length;a++){let l=e[a];if(k){if(j[1]<=l[0])return e[a-1][1]=j[1],e;if(j[1]<=l[1])return e[a-1][1]=Math.max(j[1],l[1]),e.splice(a,1),e;e.splice(a,1),a--}else{if(j[1]<=l[0])return e.splice(a,0,j),e;if(j[1]<=l[1])return l[0]=Math.min(j[0],l[0]),e;j[0]<l[1]&&(l[0]=Math.min(j[0],l[0]),k=!0)}}return k?e[e.length-1][1]=j[1]:e.push(j),e}};A=o([p(0,n.IBufferService)],A),B.CharacterJoinerService=A},5114:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.CoreBrowserService=void 0,B.CoreBrowserService=class{constructor(t,o){this._textarea=t,this.window=o,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(C,B,t){var o=this&&this.__decorate||function(n,r,A,$){var e,j=arguments.length,k=j<3?r:$===null?$=Object.getOwnPropertyDescriptor(r,A):$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(n,r,A,$);else for(var a=n.length-1;a>=0;a--)(e=n[a])&&(k=(j<3?e(k):j>3?e(r,A,k):e(r,A))||k);return j>3&&k&&Object.defineProperty(r,A,k),k},p=this&&this.__param||function(n,r){return function(A,$){r(A,$,n)}};Object.defineProperty(B,"__esModule",{value:!0}),B.MouseService=void 0;let s=t(4725),c=t(9806),P=class{constructor(n,r){this._renderService=n,this._charSizeService=r}getCoords(n,r,A,$,e){return(0,c.getCoords)(window,n,r,A,$,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,e)}getMouseReportCoords(n,r){let A=(0,c.getCoordsRelativeToElement)(window,n,r);if(!(!this._charSizeService.hasValidSize||A[0]<0||A[1]<0||A[0]>=this._renderService.dimensions.css.canvas.width||A[1]>=this._renderService.dimensions.css.canvas.height))return{col:Math.floor(A[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(A[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(A[0]),y:Math.floor(A[1])}}};P=o([p(0,s.IRenderService),p(1,s.ICharSizeService)],P),B.MouseService=P},3230:function(C,B,t){var o=this&&this.__decorate||function(k,a,l,h){var i,d=arguments.length,v=d<3?a:h===null?h=Object.getOwnPropertyDescriptor(a,l):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(k,a,l,h);else for(var E=k.length-1;E>=0;E--)(i=k[E])&&(v=(d<3?i(v):d>3?i(a,l,v):i(a,l))||v);return d>3&&v&&Object.defineProperty(a,l,v),v},p=this&&this.__param||function(k,a){return function(l,h){a(l,h,k)}};Object.defineProperty(B,"__esModule",{value:!0}),B.RenderService=void 0;let s=t(6193),c=t(8460),P=t(844),n=t(5596),r=t(3656),A=t(2585),$=t(4725),e=t(7226),j=class extends P.Disposable{constructor(k,a,l,h,i,d,v,E){if(super(),this._rowCount=k,this._charSizeService=h,this._pausedResizeTask=new e.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new c.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new c.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new c.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new c.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this.register({dispose:()=>{var m;return(m=this._renderer)===null||m===void 0?void 0:m.dispose()}}),this._renderDebouncer=new s.RenderDebouncer(v.window,(m,X)=>this._renderRows(m,X)),this.register(this._renderDebouncer),this._screenDprMonitor=new n.ScreenDprMonitor(v.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(d.onResize(()=>this._fullRefresh())),this.register(d.buffers.onBufferActivate(()=>{var m;return(m=this._renderer)===null||m===void 0?void 0:m.clear()})),this.register(l.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(i.onDecorationRegistered(()=>this._fullRefresh())),this.register(i.onDecorationRemoved(()=>this._fullRefresh())),this.register(l.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(d.cols,d.rows),this._fullRefresh()})),this.register(l.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(d.buffer.y,d.buffer.y,!0))),this.register((0,r.addDisposableDomListener)(v.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(E.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in v.window){let m=new v.window.IntersectionObserver(X=>this._handleIntersectionChange(X[X.length-1]),{threshold:0});m.observe(a),this.register({dispose:()=>m.disconnect()})}}get dimensions(){return this._renderer.dimensions}_handleIntersectionChange(k){this._isPaused=k.isIntersecting===void 0?k.intersectionRatio===0:!k.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(k,a,l=!1){this._isPaused?this._needsFullRefresh=!0:(l||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(k,a,this._rowCount))}_renderRows(k,a){this._renderer&&(this._renderer.renderRows(k,a),this._needsSelectionRefresh&&(this._renderer.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:k,end:a}),this._onRender.fire({start:k,end:a}),this._isNextRenderRedrawOnly=!0)}resize(k,a){this._rowCount=a,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer&&(this._renderer.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.dimensions))}hasRenderer(){return!!this._renderer}setRenderer(k){var a;(a=this._renderer)===null||a===void 0||a.dispose(),this._renderer=k,this._renderer.onRequestRedraw(l=>this.refreshRows(l.start,l.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(k){return this._renderDebouncer.addRefreshCallback(k)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var k,a;this._renderer&&((a=(k=this._renderer).clearTextureAtlas)===null||a===void 0||a.call(k),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer&&(this._renderer.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(k,a){this._renderer&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.handleResize(k,a)):this._renderer.handleResize(k,a),this._fullRefresh())}handleCharSizeChanged(){var k;(k=this._renderer)===null||k===void 0||k.handleCharSizeChanged()}handleBlur(){var k;(k=this._renderer)===null||k===void 0||k.handleBlur()}handleFocus(){var k;(k=this._renderer)===null||k===void 0||k.handleFocus()}handleSelectionChanged(k,a,l){var h;this._selectionState.start=k,this._selectionState.end=a,this._selectionState.columnSelectMode=l,(h=this._renderer)===null||h===void 0||h.handleSelectionChanged(k,a,l)}handleCursorMove(){var k;(k=this._renderer)===null||k===void 0||k.handleCursorMove()}clear(){var k;(k=this._renderer)===null||k===void 0||k.clear()}};j=o([p(2,A.IOptionsService),p(3,$.ICharSizeService),p(4,A.IDecorationService),p(5,A.IBufferService),p(6,$.ICoreBrowserService),p(7,$.IThemeService)],j),B.RenderService=j},9312:function(C,B,t){var o=this&&this.__decorate||function(i,d,v,E){var m,X=arguments.length,M=X<3?d:E===null?E=Object.getOwnPropertyDescriptor(d,v):E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(i,d,v,E);else for(var T=i.length-1;T>=0;T--)(m=i[T])&&(M=(X<3?m(M):X>3?m(d,v,M):m(d,v))||M);return X>3&&M&&Object.defineProperty(d,v,M),M},p=this&&this.__param||function(i,d){return function(v,E){d(v,E,i)}};Object.defineProperty(B,"__esModule",{value:!0}),B.SelectionService=void 0;let s=t(6114),c=t(456),P=t(511),n=t(8460),r=t(4725),A=t(2585),$=t(9806),e=t(9504),j=t(844),k=t(4841),a=String.fromCharCode(160),l=new RegExp(a,"g"),h=class extends j.Disposable{constructor(i,d,v,E,m,X,M,T,w){super(),this._element=i,this._screenElement=d,this._linkifier=v,this._bufferService=E,this._coreService=m,this._mouseService=X,this._optionsService=M,this._renderService=T,this._coreBrowserService=w,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new P.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new n.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new n.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new n.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new n.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=g=>this._handleMouseMove(g),this._mouseUpListener=g=>this._handleMouseUp(g),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(g=>this._handleTrim(g)),this.register(this._bufferService.buffers.onBufferActivate(g=>this._handleBufferActivate(g))),this.enable(),this._model=new c.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,j.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let i=this._model.finalSelectionStart,d=this._model.finalSelectionEnd;return!(!i||!d||i[0]===d[0]&&i[1]===d[1])}get selectionText(){let i=this._model.finalSelectionStart,d=this._model.finalSelectionEnd;if(!i||!d)return"";let v=this._bufferService.buffer,E=[];if(this._activeSelectionMode===3){if(i[0]===d[0])return"";let m=i[0]<d[0]?i[0]:d[0],X=i[0]<d[0]?d[0]:i[0];for(let M=i[1];M<=d[1];M++){let T=v.translateBufferLineToString(M,!0,m,X);E.push(T)}}else{let m=i[1]===d[1]?d[0]:void 0;E.push(v.translateBufferLineToString(i[1],!0,i[0],m));for(let X=i[1]+1;X<=d[1]-1;X++){let M=v.lines.get(X),T=v.translateBufferLineToString(X,!0);M!=null&&M.isWrapped?E[E.length-1]+=T:E.push(T)}if(i[1]!==d[1]){let X=v.lines.get(d[1]),M=v.translateBufferLineToString(d[1],!0,0,d[0]);X&&X.isWrapped?E[E.length-1]+=M:E.push(M)}}return E.map(m=>m.replace(l," ")).join(s.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(i){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),s.isLinux&&i&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(i){let d=this._getMouseBufferCoords(i),v=this._model.finalSelectionStart,E=this._model.finalSelectionEnd;return!!(v&&E&&d)&&this._areCoordsInSelection(d,v,E)}isCellInSelection(i,d){let v=this._model.finalSelectionStart,E=this._model.finalSelectionEnd;return!(!v||!E)&&this._areCoordsInSelection([i,d],v,E)}_areCoordsInSelection(i,d,v){return i[1]>d[1]&&i[1]<v[1]||d[1]===v[1]&&i[1]===d[1]&&i[0]>=d[0]&&i[0]<v[0]||d[1]<v[1]&&i[1]===v[1]&&i[0]<v[0]||d[1]<v[1]&&i[1]===d[1]&&i[0]>=d[0]}_selectWordAtCursor(i,d){var v,E;let m=(E=(v=this._linkifier.currentLink)===null||v===void 0?void 0:v.link)===null||E===void 0?void 0:E.range;if(m)return this._model.selectionStart=[m.start.x-1,m.start.y-1],this._model.selectionStartLength=(0,k.getRangeLength)(m,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let X=this._getMouseBufferCoords(i);return!!X&&(this._selectWordAt(X,d),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(i,d){this._model.clearSelection(),i=Math.max(i,0),d=Math.min(d,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,i],this._model.selectionEnd=[this._bufferService.cols,d],this.refresh(),this._onSelectionChange.fire()}_handleTrim(i){this._model.handleTrim(i)&&this.refresh()}_getMouseBufferCoords(i){let d=this._mouseService.getCoords(i,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(d)return d[0]--,d[1]--,d[1]+=this._bufferService.buffer.ydisp,d}_getMouseEventScrollAmount(i){let d=(0,$.getCoordsRelativeToElement)(this._coreBrowserService.window,i,this._screenElement)[1],v=this._renderService.dimensions.css.canvas.height;return d>=0&&d<=v?0:(d>v&&(d-=v),d=Math.min(Math.max(d,-50),50),d/=50,d/Math.abs(d)+Math.round(14*d))}shouldForceSelection(i){return s.isMac?i.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:i.shiftKey}handleMouseDown(i){if(this._mouseDownTimeStamp=i.timeStamp,(i.button!==2||!this.hasSelection)&&i.button===0){if(!this._enabled){if(!this.shouldForceSelection(i))return;i.stopPropagation()}i.preventDefault(),this._dragScrollAmount=0,this._enabled&&i.shiftKey?this._handleIncrementalClick(i):i.detail===1?this._handleSingleClick(i):i.detail===2?this._handleDoubleClick(i):i.detail===3&&this._handleTripleClick(i),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(i){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(i))}_handleSingleClick(i){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(i)?3:0,this._model.selectionStart=this._getMouseBufferCoords(i),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let d=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);d&&d.length!==this._model.selectionStart[0]&&d.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(i){this._selectWordAtCursor(i,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(i){let d=this._getMouseBufferCoords(i);d&&(this._activeSelectionMode=2,this._selectLineAt(d[1]))}shouldColumnSelect(i){return i.altKey&&!(s.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(i){if(i.stopImmediatePropagation(),!this._model.selectionStart)return;let d=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(i),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(i),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let v=this._bufferService.buffer;if(this._model.selectionEnd[1]<v.lines.length){let E=v.lines.get(this._model.selectionEnd[1]);E&&E.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}d&&d[0]===this._model.selectionEnd[0]&&d[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let i=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(i.ydisp+this._bufferService.rows,i.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=i.ydisp),this.refresh()}}_handleMouseUp(i){let d=i.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&d<500&&i.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let v=this._mouseService.getCoords(i,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(v&&v[0]!==void 0&&v[1]!==void 0){let E=(0,e.moveToCellSequence)(v[0]-1,v[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(E,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let i=this._model.finalSelectionStart,d=this._model.finalSelectionEnd,v=!(!i||!d||i[0]===d[0]&&i[1]===d[1]);v?i&&d&&(this._oldSelectionStart&&this._oldSelectionEnd&&i[0]===this._oldSelectionStart[0]&&i[1]===this._oldSelectionStart[1]&&d[0]===this._oldSelectionEnd[0]&&d[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(i,d,v)):this._oldHasSelection&&this._fireOnSelectionChange(i,d,v)}_fireOnSelectionChange(i,d,v){this._oldSelectionStart=i,this._oldSelectionEnd=d,this._oldHasSelection=v,this._onSelectionChange.fire()}_handleBufferActivate(i){this.clearSelection(),this._trimListener.dispose(),this._trimListener=i.activeBuffer.lines.onTrim(d=>this._handleTrim(d))}_convertViewportColToCharacterIndex(i,d){let v=d;for(let E=0;d>=E;E++){let m=i.loadCell(E,this._workCell).getChars().length;this._workCell.getWidth()===0?v--:m>1&&d!==E&&(v+=m-1)}return v}setSelection(i,d,v){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[i,d],this._model.selectionStartLength=v,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(i){this._isClickInSelection(i)||(this._selectWordAtCursor(i,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(i,d,v=!0,E=!0){if(i[0]>=this._bufferService.cols)return;let m=this._bufferService.buffer,X=m.lines.get(i[1]);if(!X)return;let M=m.translateBufferLineToString(i[1],!1),T=this._convertViewportColToCharacterIndex(X,i[0]),w=T,g=i[0]-T,u=0,f=0,x=0,b=0;if(M.charAt(T)===" "){for(;T>0&&M.charAt(T-1)===" ";)T--;for(;w<M.length&&M.charAt(w+1)===" ";)w++}else{let D=i[0],V=i[0];X.getWidth(D)===0&&(u++,D--),X.getWidth(V)===2&&(f++,V++);let H=X.getString(V).length;for(H>1&&(b+=H-1,w+=H-1);D>0&&T>0&&!this._isCharWordSeparator(X.loadCell(D-1,this._workCell));){X.loadCell(D-1,this._workCell);let R=this._workCell.getChars().length;this._workCell.getWidth()===0?(u++,D--):R>1&&(x+=R-1,T-=R-1),T--,D--}for(;V<X.length&&w+1<M.length&&!this._isCharWordSeparator(X.loadCell(V+1,this._workCell));){X.loadCell(V+1,this._workCell);let R=this._workCell.getChars().length;this._workCell.getWidth()===2?(f++,V++):R>1&&(b+=R-1,w+=R-1),w++,V++}}w++;let L=T+g-u+x,N=Math.min(this._bufferService.cols,w-T+u+f-x-b);if(d||M.slice(T,w).trim()!==""){if(v&&L===0&&X.getCodePoint(0)!==32){let D=m.lines.get(i[1]-1);if(D&&X.isWrapped&&D.getCodePoint(this._bufferService.cols-1)!==32){let V=this._getWordAt([this._bufferService.cols-1,i[1]-1],!1,!0,!1);if(V){let H=this._bufferService.cols-V.start;L-=H,N+=H}}}if(E&&L+N===this._bufferService.cols&&X.getCodePoint(this._bufferService.cols-1)!==32){let D=m.lines.get(i[1]+1);if((D==null?void 0:D.isWrapped)&&D.getCodePoint(0)!==32){let V=this._getWordAt([0,i[1]+1],!1,!1,!0);V&&(N+=V.length)}}return{start:L,length:N}}}_selectWordAt(i,d){let v=this._getWordAt(i,d);if(v){for(;v.start<0;)v.start+=this._bufferService.cols,i[1]--;this._model.selectionStart=[v.start,i[1]],this._model.selectionStartLength=v.length}}_selectToWordAt(i){let d=this._getWordAt(i,!0);if(d){let v=i[1];for(;d.start<0;)d.start+=this._bufferService.cols,v--;if(!this._model.areSelectionValuesReversed())for(;d.start+d.length>this._bufferService.cols;)d.length-=this._bufferService.cols,v++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?d.start:d.start+d.length,v]}}_isCharWordSeparator(i){return i.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(i.getChars())>=0}_selectLineAt(i){let d=this._bufferService.buffer.getWrappedRangeForLine(i),v={start:{x:0,y:d.first},end:{x:this._bufferService.cols-1,y:d.last}};this._model.selectionStart=[0,d.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,k.getRangeLength)(v,this._bufferService.cols)}};h=o([p(3,A.IBufferService),p(4,A.ICoreService),p(5,r.IMouseService),p(6,A.IOptionsService),p(7,r.IRenderService),p(8,r.ICoreBrowserService)],h),B.SelectionService=h},4725:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.IThemeService=B.ICharacterJoinerService=B.ISelectionService=B.IRenderService=B.IMouseService=B.ICoreBrowserService=B.ICharSizeService=void 0;let o=t(8343);B.ICharSizeService=(0,o.createDecorator)("CharSizeService"),B.ICoreBrowserService=(0,o.createDecorator)("CoreBrowserService"),B.IMouseService=(0,o.createDecorator)("MouseService"),B.IRenderService=(0,o.createDecorator)("RenderService"),B.ISelectionService=(0,o.createDecorator)("SelectionService"),B.ICharacterJoinerService=(0,o.createDecorator)("CharacterJoinerService"),B.IThemeService=(0,o.createDecorator)("ThemeService")},6731:function(C,B,t){var o=this&&this.__decorate||function(h,i,d,v){var E,m=arguments.length,X=m<3?i:v===null?v=Object.getOwnPropertyDescriptor(i,d):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")X=Reflect.decorate(h,i,d,v);else for(var M=h.length-1;M>=0;M--)(E=h[M])&&(X=(m<3?E(X):m>3?E(i,d,X):E(i,d))||X);return m>3&&X&&Object.defineProperty(i,d,X),X},p=this&&this.__param||function(h,i){return function(d,v){i(d,v,h)}};Object.defineProperty(B,"__esModule",{value:!0}),B.ThemeService=B.DEFAULT_ANSI_COLORS=void 0;let s=t(7239),c=t(8055),P=t(8460),n=t(844),r=t(2585),A=c.css.toColor("#ffffff"),$=c.css.toColor("#000000"),e=c.css.toColor("#ffffff"),j=c.css.toColor("#000000"),k={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};B.DEFAULT_ANSI_COLORS=Object.freeze((()=>{let h=[c.css.toColor("#2e3436"),c.css.toColor("#cc0000"),c.css.toColor("#4e9a06"),c.css.toColor("#c4a000"),c.css.toColor("#3465a4"),c.css.toColor("#75507b"),c.css.toColor("#06989a"),c.css.toColor("#d3d7cf"),c.css.toColor("#555753"),c.css.toColor("#ef2929"),c.css.toColor("#8ae234"),c.css.toColor("#fce94f"),c.css.toColor("#729fcf"),c.css.toColor("#ad7fa8"),c.css.toColor("#34e2e2"),c.css.toColor("#eeeeec")],i=[0,95,135,175,215,255];for(let d=0;d<216;d++){let v=i[d/36%6|0],E=i[d/6%6|0],m=i[d%6];h.push({css:c.channels.toCss(v,E,m),rgba:c.channels.toRgba(v,E,m)})}for(let d=0;d<24;d++){let v=8+10*d;h.push({css:c.channels.toCss(v,v,v),rgba:c.channels.toRgba(v,v,v)})}return h})());let a=class extends n.Disposable{constructor(h){super(),this._optionsService=h,this._onChangeColors=this.register(new P.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._contrastCache=new s.ColorContrastCache,this._colors={foreground:A,background:$,cursor:e,cursorAccent:j,selectionForeground:void 0,selectionBackgroundTransparent:k,selectionBackgroundOpaque:c.color.blend($,k),selectionInactiveBackgroundTransparent:k,selectionInactiveBackgroundOpaque:c.color.blend($,k),ansi:B.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(h={}){let i=this._colors;if(i.foreground=l(h.foreground,A),i.background=l(h.background,$),i.cursor=l(h.cursor,e),i.cursorAccent=l(h.cursorAccent,j),i.selectionBackgroundTransparent=l(h.selectionBackground,k),i.selectionBackgroundOpaque=c.color.blend(i.background,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundTransparent=l(h.selectionInactiveBackground,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundOpaque=c.color.blend(i.background,i.selectionInactiveBackgroundTransparent),i.selectionForeground=h.selectionForeground?l(h.selectionForeground,c.NULL_COLOR):void 0,i.selectionForeground===c.NULL_COLOR&&(i.selectionForeground=void 0),c.color.isOpaque(i.selectionBackgroundTransparent)&&(i.selectionBackgroundTransparent=c.color.opacity(i.selectionBackgroundTransparent,.3)),c.color.isOpaque(i.selectionInactiveBackgroundTransparent)&&(i.selectionInactiveBackgroundTransparent=c.color.opacity(i.selectionInactiveBackgroundTransparent,.3)),i.ansi=B.DEFAULT_ANSI_COLORS.slice(),i.ansi[0]=l(h.black,B.DEFAULT_ANSI_COLORS[0]),i.ansi[1]=l(h.red,B.DEFAULT_ANSI_COLORS[1]),i.ansi[2]=l(h.green,B.DEFAULT_ANSI_COLORS[2]),i.ansi[3]=l(h.yellow,B.DEFAULT_ANSI_COLORS[3]),i.ansi[4]=l(h.blue,B.DEFAULT_ANSI_COLORS[4]),i.ansi[5]=l(h.magenta,B.DEFAULT_ANSI_COLORS[5]),i.ansi[6]=l(h.cyan,B.DEFAULT_ANSI_COLORS[6]),i.ansi[7]=l(h.white,B.DEFAULT_ANSI_COLORS[7]),i.ansi[8]=l(h.brightBlack,B.DEFAULT_ANSI_COLORS[8]),i.ansi[9]=l(h.brightRed,B.DEFAULT_ANSI_COLORS[9]),i.ansi[10]=l(h.brightGreen,B.DEFAULT_ANSI_COLORS[10]),i.ansi[11]=l(h.brightYellow,B.DEFAULT_ANSI_COLORS[11]),i.ansi[12]=l(h.brightBlue,B.DEFAULT_ANSI_COLORS[12]),i.ansi[13]=l(h.brightMagenta,B.DEFAULT_ANSI_COLORS[13]),i.ansi[14]=l(h.brightCyan,B.DEFAULT_ANSI_COLORS[14]),i.ansi[15]=l(h.brightWhite,B.DEFAULT_ANSI_COLORS[15]),h.extendedAnsi){let d=Math.min(i.ansi.length-16,h.extendedAnsi.length);for(let v=0;v<d;v++)i.ansi[v+16]=l(h.extendedAnsi[v],B.DEFAULT_ANSI_COLORS[v+16])}this._contrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(h){this._restoreColor(h),this._onChangeColors.fire(this.colors)}_restoreColor(h){if(h!==void 0)switch(h){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[h]=this._restoreColors.ansi[h]}else for(let i=0;i<this._restoreColors.ansi.length;++i)this._colors.ansi[i]=this._restoreColors.ansi[i]}modifyColors(h){h(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function l(h,i){if(h!==void 0)try{return c.css.toColor(h)}catch(d){}return i}a=o([p(0,r.IOptionsService)],a),B.ThemeService=a},6349:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.CircularList=void 0;let o=t(8460),p=t(844);class s extends p.Disposable{constructor(P){super(),this._maxLength=P,this.onDeleteEmitter=this.register(new o.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new o.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new o.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(P){if(this._maxLength===P)return;let n=new Array(P);for(let r=0;r<Math.min(P,this.length);r++)n[r]=this._array[this._getCyclicIndex(r)];this._array=n,this._maxLength=P,this._startIndex=0}get length(){return this._length}set length(P){if(P>this._length)for(let n=this._length;n<P;n++)this._array[n]=void 0;this._length=P}get(P){return this._array[this._getCyclicIndex(P)]}set(P,n){this._array[this._getCyclicIndex(P)]=n}push(P){this._array[this._getCyclicIndex(this._length)]=P,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(P,n,...r){if(n){for(let A=P;A<this._length-n;A++)this._array[this._getCyclicIndex(A)]=this._array[this._getCyclicIndex(A+n)];this._length-=n,this.onDeleteEmitter.fire({index:P,amount:n})}for(let A=this._length-1;A>=P;A--)this._array[this._getCyclicIndex(A+r.length)]=this._array[this._getCyclicIndex(A)];for(let A=0;A<r.length;A++)this._array[this._getCyclicIndex(P+A)]=r[A];if(r.length&&this.onInsertEmitter.fire({index:P,amount:r.length}),this._length+r.length>this._maxLength){let A=this._length+r.length-this._maxLength;this._startIndex+=A,this._length=this._maxLength,this.onTrimEmitter.fire(A)}else this._length+=r.length}trimStart(P){P>this._length&&(P=this._length),this._startIndex+=P,this._length-=P,this.onTrimEmitter.fire(P)}shiftElements(P,n,r){if(!(n<=0)){if(P<0||P>=this._length)throw new Error("start argument out of range");if(P+r<0)throw new Error("Cannot shift elements in list beyond index 0");if(r>0){for(let $=n-1;$>=0;$--)this.set(P+$+r,this.get(P+$));let A=P+n+r-this._length;if(A>0)for(this._length+=A;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let A=0;A<n;A++)this.set(P+A+r,this.get(P+A))}}_getCyclicIndex(P){return(this._startIndex+P)%this._maxLength}}B.CircularList=s},1439:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.clone=void 0,B.clone=function t(o,p=5){if(typeof o!="object")return o;let s=Array.isArray(o)?[]:{};for(let c in o)s[c]=p<=1?o[c]:o[c]&&t(o[c],p-1);return s}},8055:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.contrastRatio=B.toPaddedHex=B.rgba=B.rgb=B.css=B.color=B.channels=B.NULL_COLOR=void 0;let o=t(6114),p=0,s=0,c=0,P=0;var n,r,A;function $(j){let k=j.toString(16);return k.length<2?"0"+k:k}function e(j,k){return j<k?(k+.05)/(j+.05):(j+.05)/(k+.05)}B.NULL_COLOR={css:"#00000000",rgba:0},function(j){j.toCss=function(k,a,l,h){return h!==void 0?`#${$(k)}${$(a)}${$(l)}${$(h)}`:`#${$(k)}${$(a)}${$(l)}`},j.toRgba=function(k,a,l,h=255){return(k<<24|a<<16|l<<8|h)>>>0}}(n=B.channels||(B.channels={})),function(j){function k(a,l){return P=Math.round(255*l),[p,s,c]=A.toChannels(a.rgba),{css:n.toCss(p,s,c,P),rgba:n.toRgba(p,s,c,P)}}j.blend=function(a,l){if(P=(255&l.rgba)/255,P===1)return{css:l.css,rgba:l.rgba};let h=l.rgba>>24&255,i=l.rgba>>16&255,d=l.rgba>>8&255,v=a.rgba>>24&255,E=a.rgba>>16&255,m=a.rgba>>8&255;return p=v+Math.round((h-v)*P),s=E+Math.round((i-E)*P),c=m+Math.round((d-m)*P),{css:n.toCss(p,s,c),rgba:n.toRgba(p,s,c)}},j.isOpaque=function(a){return(255&a.rgba)==255},j.ensureContrastRatio=function(a,l,h){let i=A.ensureContrastRatio(a.rgba,l.rgba,h);if(i)return A.toColor(i>>24&255,i>>16&255,i>>8&255)},j.opaque=function(a){let l=(255|a.rgba)>>>0;return[p,s,c]=A.toChannels(l),{css:n.toCss(p,s,c),rgba:l}},j.opacity=k,j.multiplyOpacity=function(a,l){return P=255&a.rgba,k(a,P*l/255)},j.toColorRGB=function(a){return[a.rgba>>24&255,a.rgba>>16&255,a.rgba>>8&255]}}(B.color||(B.color={})),function(j){let k,a;if(!o.isNode){let l=document.createElement("canvas");l.width=1,l.height=1;let h=l.getContext("2d",{willReadFrequently:!0});h&&(k=h,k.globalCompositeOperation="copy",a=k.createLinearGradient(0,0,1,1))}j.toColor=function(l){if(l.match(/#[\da-f]{3,8}/i))switch(l.length){case 4:return p=parseInt(l.slice(1,2).repeat(2),16),s=parseInt(l.slice(2,3).repeat(2),16),c=parseInt(l.slice(3,4).repeat(2),16),A.toColor(p,s,c);case 5:return p=parseInt(l.slice(1,2).repeat(2),16),s=parseInt(l.slice(2,3).repeat(2),16),c=parseInt(l.slice(3,4).repeat(2),16),P=parseInt(l.slice(4,5).repeat(2),16),A.toColor(p,s,c,P);case 7:return{css:l,rgba:(parseInt(l.slice(1),16)<<8|255)>>>0};case 9:return{css:l,rgba:parseInt(l.slice(1),16)>>>0}}let h=l.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(h)return p=parseInt(h[1]),s=parseInt(h[2]),c=parseInt(h[3]),P=Math.round(255*(h[5]===void 0?1:parseFloat(h[5]))),A.toColor(p,s,c,P);if(!k||!a)throw new Error("css.toColor: Unsupported css format");if(k.fillStyle=a,k.fillStyle=l,typeof k.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(k.fillRect(0,0,1,1),[p,s,c,P]=k.getImageData(0,0,1,1).data,P!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:n.toRgba(p,s,c,P),css:l}}}(B.css||(B.css={})),function(j){function k(a,l,h){let i=a/255,d=l/255,v=h/255;return .2126*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.7152*(d<=.03928?d/12.92:Math.pow((d+.055)/1.055,2.4))+.0722*(v<=.03928?v/12.92:Math.pow((v+.055)/1.055,2.4))}j.relativeLuminance=function(a){return k(a>>16&255,a>>8&255,255&a)},j.relativeLuminance2=k}(r=B.rgb||(B.rgb={})),function(j){function k(l,h,i){let d=l>>24&255,v=l>>16&255,E=l>>8&255,m=h>>24&255,X=h>>16&255,M=h>>8&255,T=e(r.relativeLuminance2(m,X,M),r.relativeLuminance2(d,v,E));for(;T<i&&(m>0||X>0||M>0);)m-=Math.max(0,Math.ceil(.1*m)),X-=Math.max(0,Math.ceil(.1*X)),M-=Math.max(0,Math.ceil(.1*M)),T=e(r.relativeLuminance2(m,X,M),r.relativeLuminance2(d,v,E));return(m<<24|X<<16|M<<8|255)>>>0}function a(l,h,i){let d=l>>24&255,v=l>>16&255,E=l>>8&255,m=h>>24&255,X=h>>16&255,M=h>>8&255,T=e(r.relativeLuminance2(m,X,M),r.relativeLuminance2(d,v,E));for(;T<i&&(m<255||X<255||M<255);)m=Math.min(255,m+Math.ceil(.1*(255-m))),X=Math.min(255,X+Math.ceil(.1*(255-X))),M=Math.min(255,M+Math.ceil(.1*(255-M))),T=e(r.relativeLuminance2(m,X,M),r.relativeLuminance2(d,v,E));return(m<<24|X<<16|M<<8|255)>>>0}j.ensureContrastRatio=function(l,h,i){let d=r.relativeLuminance(l>>8),v=r.relativeLuminance(h>>8);if(e(d,v)<i){if(v<d){let X=k(l,h,i),M=e(d,r.relativeLuminance(X>>8));if(M<i){let T=a(l,h,i);return M>e(d,r.relativeLuminance(T>>8))?X:T}return X}let E=a(l,h,i),m=e(d,r.relativeLuminance(E>>8));if(m<i){let X=k(l,h,i);return m>e(d,r.relativeLuminance(X>>8))?E:X}return E}},j.reduceLuminance=k,j.increaseLuminance=a,j.toChannels=function(l){return[l>>24&255,l>>16&255,l>>8&255,255&l]},j.toColor=function(l,h,i,d){return{css:n.toCss(l,h,i,d),rgba:n.toRgba(l,h,i,d)}}}(A=B.rgba||(B.rgba={})),B.toPaddedHex=$,B.contrastRatio=e},8969:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.CoreTerminal=void 0;let o=t(844),p=t(2585),s=t(4348),c=t(7866),P=t(744),n=t(7302),r=t(6975),A=t(8460),$=t(1753),e=t(1480),j=t(7994),k=t(9282),a=t(5435),l=t(5981),h=t(2660),i=!1;class d extends o.Disposable{constructor(E){super(),this._onBinary=this.register(new A.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new A.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new A.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new A.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new A.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new A.EventEmitter),this._instantiationService=new s.InstantiationService,this.optionsService=this.register(new n.OptionsService(E)),this._instantiationService.setService(p.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(P.BufferService)),this._instantiationService.setService(p.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(c.LogService)),this._instantiationService.setService(p.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(r.CoreService)),this._instantiationService.setService(p.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance($.CoreMouseService)),this._instantiationService.setService(p.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(e.UnicodeService)),this._instantiationService.setService(p.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(j.CharsetService),this._instantiationService.setService(p.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(h.OscLinkService),this._instantiationService.setService(p.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new a.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,A.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,A.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,A.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,A.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onSpecificOptionChange("windowsMode",m=>this._handleWindowsModeOptionChange(m))),this.register(this._bufferService.onScroll(m=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(m=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new l.WriteBuffer((m,X)=>this._inputHandler.parse(m,X))),this.register((0,A.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed)),this.register((0,o.toDisposable)(()=>{var m;(m=this._windowsMode)===null||m===void 0||m.dispose(),this._windowsMode=void 0}))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new A.EventEmitter),this._onScroll.event(E=>{var m;(m=this._onScrollApi)===null||m===void 0||m.fire(E.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(E){for(let m in E)this.optionsService.options[m]=E[m]}write(E,m){this._writeBuffer.write(E,m)}writeSync(E,m){this._logService.logLevel<=p.LogLevelEnum.WARN&&!i&&(this._logService.warn("writeSync is unreliable and will be removed soon."),i=!0),this._writeBuffer.writeSync(E,m)}resize(E,m){isNaN(E)||isNaN(m)||(E=Math.max(E,P.MINIMUM_COLS),m=Math.max(m,P.MINIMUM_ROWS),this._bufferService.resize(E,m))}scroll(E,m=!1){this._bufferService.scroll(E,m)}scrollLines(E,m,X){this._bufferService.scrollLines(E,m,X)}scrollPages(E){this._bufferService.scrollPages(E)}scrollToTop(){this._bufferService.scrollToTop()}scrollToBottom(){this._bufferService.scrollToBottom()}scrollToLine(E){this._bufferService.scrollToLine(E)}registerEscHandler(E,m){return this._inputHandler.registerEscHandler(E,m)}registerDcsHandler(E,m){return this._inputHandler.registerDcsHandler(E,m)}registerCsiHandler(E,m){return this._inputHandler.registerCsiHandler(E,m)}registerOscHandler(E,m){return this._inputHandler.registerOscHandler(E,m)}_setup(){this.optionsService.rawOptions.windowsMode&&this._enableWindowsMode()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsModeOptionChange(E){var m;E?this._enableWindowsMode():((m=this._windowsMode)===null||m===void 0||m.dispose(),this._windowsMode=void 0)}_enableWindowsMode(){if(!this._windowsMode){let E=[];E.push(this.onLineFeed(k.updateWindowsModeWrappedState.bind(null,this._bufferService))),E.push(this.registerCsiHandler({final:"H"},()=>((0,k.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsMode={dispose:()=>{for(let m of E)m.dispose()}}}}}B.CoreTerminal=d},8460:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.forwardEvent=B.EventEmitter=void 0,B.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=t=>(this._listeners.push(t),{dispose:()=>{if(!this._disposed){for(let o=0;o<this._listeners.length;o++)if(this._listeners[o]===t)return void this._listeners.splice(o,1)}}})),this._event}fire(t,o){let p=[];for(let s=0;s<this._listeners.length;s++)p.push(this._listeners[s]);for(let s=0;s<p.length;s++)p[s].call(void 0,t,o)}dispose(){this._listeners&&(this._listeners.length=0),this._disposed=!0}},B.forwardEvent=function(t,o){return t(p=>o.fire(p))}},5435:function(C,B,t){var o=this&&this.__decorate||function(w,g,u,f){var x,b=arguments.length,L=b<3?g:f===null?f=Object.getOwnPropertyDescriptor(g,u):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(w,g,u,f);else for(var N=w.length-1;N>=0;N--)(x=w[N])&&(L=(b<3?x(L):b>3?x(g,u,L):x(g,u))||L);return b>3&&L&&Object.defineProperty(g,u,L),L},p=this&&this.__param||function(w,g){return function(u,f){g(u,f,w)}};Object.defineProperty(B,"__esModule",{value:!0}),B.InputHandler=B.WindowsOptionsReportType=void 0;let s=t(2584),c=t(7116),P=t(2015),n=t(844),r=t(482),A=t(8437),$=t(8460),e=t(643),j=t(511),k=t(3734),a=t(2585),l=t(6242),h=t(6351),i=t(5941),d={"(":0,")":1,"*":2,"+":3,"-":1,".":2},v=131072;function E(w,g){if(w>24)return g.setWinLines||!1;switch(w){case 1:return!!g.restoreWin;case 2:return!!g.minimizeWin;case 3:return!!g.setWinPosition;case 4:return!!g.setWinSizePixels;case 5:return!!g.raiseWin;case 6:return!!g.lowerWin;case 7:return!!g.refreshWin;case 8:return!!g.setWinSizeChars;case 9:return!!g.maximizeWin;case 10:return!!g.fullscreenWin;case 11:return!!g.getWinState;case 13:return!!g.getWinPosition;case 14:return!!g.getWinSizePixels;case 15:return!!g.getScreenSizePixels;case 16:return!!g.getCellSizePixels;case 18:return!!g.getWinSizeChars;case 19:return!!g.getScreenSizeChars;case 20:return!!g.getIconTitle;case 21:return!!g.getWinTitle;case 22:return!!g.pushTitle;case 23:return!!g.popTitle;case 24:return!!g.setWinLines}return!1}var m;(function(w){w[w.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",w[w.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(m=B.WindowsOptionsReportType||(B.WindowsOptionsReportType={}));let X=0;class M extends n.Disposable{constructor(g,u,f,x,b,L,N,D,V=new P.EscapeSequenceParser){super(),this._bufferService=g,this._charsetService=u,this._coreService=f,this._logService=x,this._optionsService=b,this._oscLinkService=L,this._coreMouseService=N,this._unicodeService=D,this._parser=V,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new r.StringToUtf32,this._utf8Decoder=new r.Utf8ToUtf32,this._workCell=new j.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=A.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=A.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new $.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new $.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new $.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new $.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new $.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new $.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new $.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new $.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new $.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new $.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new $.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new $.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new $.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new T(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(H=>this._activeBuffer=H.activeBuffer)),this._parser.setCsiHandlerFallback((H,R)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(H),params:R.toArray()})}),this._parser.setEscHandlerFallback(H=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(H)})}),this._parser.setExecuteHandlerFallback(H=>{this._logService.debug("Unknown EXECUTE code: ",{code:H})}),this._parser.setOscHandlerFallback((H,R,S)=>{this._logService.debug("Unknown OSC code: ",{identifier:H,action:R,data:S})}),this._parser.setDcsHandlerFallback((H,R,S)=>{R==="HOOK"&&(S=S.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(H),action:R,payload:S})}),this._parser.setPrintHandler((H,R,S)=>this.print(H,R,S)),this._parser.registerCsiHandler({final:"@"},H=>this.insertChars(H)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},H=>this.scrollLeft(H)),this._parser.registerCsiHandler({final:"A"},H=>this.cursorUp(H)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},H=>this.scrollRight(H)),this._parser.registerCsiHandler({final:"B"},H=>this.cursorDown(H)),this._parser.registerCsiHandler({final:"C"},H=>this.cursorForward(H)),this._parser.registerCsiHandler({final:"D"},H=>this.cursorBackward(H)),this._parser.registerCsiHandler({final:"E"},H=>this.cursorNextLine(H)),this._parser.registerCsiHandler({final:"F"},H=>this.cursorPrecedingLine(H)),this._parser.registerCsiHandler({final:"G"},H=>this.cursorCharAbsolute(H)),this._parser.registerCsiHandler({final:"H"},H=>this.cursorPosition(H)),this._parser.registerCsiHandler({final:"I"},H=>this.cursorForwardTab(H)),this._parser.registerCsiHandler({final:"J"},H=>this.eraseInDisplay(H,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},H=>this.eraseInDisplay(H,!0)),this._parser.registerCsiHandler({final:"K"},H=>this.eraseInLine(H,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},H=>this.eraseInLine(H,!0)),this._parser.registerCsiHandler({final:"L"},H=>this.insertLines(H)),this._parser.registerCsiHandler({final:"M"},H=>this.deleteLines(H)),this._parser.registerCsiHandler({final:"P"},H=>this.deleteChars(H)),this._parser.registerCsiHandler({final:"S"},H=>this.scrollUp(H)),this._parser.registerCsiHandler({final:"T"},H=>this.scrollDown(H)),this._parser.registerCsiHandler({final:"X"},H=>this.eraseChars(H)),this._parser.registerCsiHandler({final:"Z"},H=>this.cursorBackwardTab(H)),this._parser.registerCsiHandler({final:"`"},H=>this.charPosAbsolute(H)),this._parser.registerCsiHandler({final:"a"},H=>this.hPositionRelative(H)),this._parser.registerCsiHandler({final:"b"},H=>this.repeatPrecedingCharacter(H)),this._parser.registerCsiHandler({final:"c"},H=>this.sendDeviceAttributesPrimary(H)),this._parser.registerCsiHandler({prefix:">",final:"c"},H=>this.sendDeviceAttributesSecondary(H)),this._parser.registerCsiHandler({final:"d"},H=>this.linePosAbsolute(H)),this._parser.registerCsiHandler({final:"e"},H=>this.vPositionRelative(H)),this._parser.registerCsiHandler({final:"f"},H=>this.hVPosition(H)),this._parser.registerCsiHandler({final:"g"},H=>this.tabClear(H)),this._parser.registerCsiHandler({final:"h"},H=>this.setMode(H)),this._parser.registerCsiHandler({prefix:"?",final:"h"},H=>this.setModePrivate(H)),this._parser.registerCsiHandler({final:"l"},H=>this.resetMode(H)),this._parser.registerCsiHandler({prefix:"?",final:"l"},H=>this.resetModePrivate(H)),this._parser.registerCsiHandler({final:"m"},H=>this.charAttributes(H)),this._parser.registerCsiHandler({final:"n"},H=>this.deviceStatus(H)),this._parser.registerCsiHandler({prefix:"?",final:"n"},H=>this.deviceStatusPrivate(H)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},H=>this.softReset(H)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},H=>this.setCursorStyle(H)),this._parser.registerCsiHandler({final:"r"},H=>this.setScrollRegion(H)),this._parser.registerCsiHandler({final:"s"},H=>this.saveCursor(H)),this._parser.registerCsiHandler({final:"t"},H=>this.windowOptions(H)),this._parser.registerCsiHandler({final:"u"},H=>this.restoreCursor(H)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},H=>this.insertColumns(H)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},H=>this.deleteColumns(H)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},H=>this.selectProtected(H)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},H=>this.requestMode(H,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},H=>this.requestMode(H,!1)),this._parser.setExecuteHandler(s.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(s.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(s.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(s.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(s.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(s.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(s.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(s.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(s.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(s.C1.IND,()=>this.index()),this._parser.setExecuteHandler(s.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(s.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new l.OscHandler(H=>(this.setTitle(H),this.setIconName(H),!0))),this._parser.registerOscHandler(1,new l.OscHandler(H=>this.setIconName(H))),this._parser.registerOscHandler(2,new l.OscHandler(H=>this.setTitle(H))),this._parser.registerOscHandler(4,new l.OscHandler(H=>this.setOrReportIndexedColor(H))),this._parser.registerOscHandler(8,new l.OscHandler(H=>this.setHyperlink(H))),this._parser.registerOscHandler(10,new l.OscHandler(H=>this.setOrReportFgColor(H))),this._parser.registerOscHandler(11,new l.OscHandler(H=>this.setOrReportBgColor(H))),this._parser.registerOscHandler(12,new l.OscHandler(H=>this.setOrReportCursorColor(H))),this._parser.registerOscHandler(104,new l.OscHandler(H=>this.restoreIndexedColor(H))),this._parser.registerOscHandler(110,new l.OscHandler(H=>this.restoreFgColor(H))),this._parser.registerOscHandler(111,new l.OscHandler(H=>this.restoreBgColor(H))),this._parser.registerOscHandler(112,new l.OscHandler(H=>this.restoreCursorColor(H))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let H in c.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:H},()=>this.selectCharset("("+H)),this._parser.registerEscHandler({intermediates:")",final:H},()=>this.selectCharset(")"+H)),this._parser.registerEscHandler({intermediates:"*",final:H},()=>this.selectCharset("*"+H)),this._parser.registerEscHandler({intermediates:"+",final:H},()=>this.selectCharset("+"+H)),this._parser.registerEscHandler({intermediates:"-",final:H},()=>this.selectCharset("-"+H)),this._parser.registerEscHandler({intermediates:".",final:H},()=>this.selectCharset("."+H)),this._parser.registerEscHandler({intermediates:"/",final:H},()=>this.selectCharset("/"+H));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(H=>(this._logService.error("Parsing error: ",H),H)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new h.DcsHandler((H,R)=>this.requestStatusString(H,R)))}getAttrData(){return this._curAttrData}_preserveStack(g,u,f,x){this._parseStack.paused=!0,this._parseStack.cursorStartX=g,this._parseStack.cursorStartY=u,this._parseStack.decodedLength=f,this._parseStack.position=x}_logSlowResolvingAsync(g){this._logService.logLevel<=a.LogLevelEnum.WARN&&Promise.race([g,new Promise((u,f)=>setTimeout(()=>f("#SLOW_TIMEOUT"),5e3))]).catch(u=>{if(u!=="#SLOW_TIMEOUT")throw u;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(g,u){let f,x=this._activeBuffer.x,b=this._activeBuffer.y,L=0,N=this._parseStack.paused;if(N){if(f=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,u))return this._logSlowResolvingAsync(f),f;x=this._parseStack.cursorStartX,b=this._parseStack.cursorStartY,this._parseStack.paused=!1,g.length>v&&(L=this._parseStack.position+v)}if(this._logService.logLevel<=a.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof g=="string"?` "${g}"`:` "${Array.prototype.map.call(g,D=>String.fromCharCode(D)).join("")}"`),typeof g=="string"?g.split("").map(D=>D.charCodeAt(0)):g),this._parseBuffer.length<g.length&&this._parseBuffer.length<v&&(this._parseBuffer=new Uint32Array(Math.min(g.length,v))),N||this._dirtyRowTracker.clearRange(),g.length>v)for(let D=L;D<g.length;D+=v){let V=D+v<g.length?D+v:g.length,H=typeof g=="string"?this._stringDecoder.decode(g.substring(D,V),this._parseBuffer):this._utf8Decoder.decode(g.subarray(D,V),this._parseBuffer);if(f=this._parser.parse(this._parseBuffer,H))return this._preserveStack(x,b,H,D),this._logSlowResolvingAsync(f),f}else if(!N){let D=typeof g=="string"?this._stringDecoder.decode(g,this._parseBuffer):this._utf8Decoder.decode(g,this._parseBuffer);if(f=this._parser.parse(this._parseBuffer,D))return this._preserveStack(x,b,D,0),this._logSlowResolvingAsync(f),f}this._activeBuffer.x===x&&this._activeBuffer.y===b||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(g,u,f){let x,b,L=this._charsetService.charset,N=this._optionsService.rawOptions.screenReaderMode,D=this._bufferService.cols,V=this._coreService.decPrivateModes.wraparound,H=this._coreService.modes.insertMode,R=this._curAttrData,S=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&f-u>0&&S.getWidth(this._activeBuffer.x-1)===2&&S.setCellFromCodePoint(this._activeBuffer.x-1,0,1,R.fg,R.bg,R.extended);for(let y=u;y<f;++y){if(x=g[y],b=this._unicodeService.wcwidth(x),x<127&&L){let Q=L[String.fromCharCode(x)];Q&&(x=Q.charCodeAt(0))}if(N&&this._onA11yChar.fire((0,r.stringFromCodePoint)(x)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),b||!this._activeBuffer.x){if(this._activeBuffer.x+b-1>=D){if(V){for(;this._activeBuffer.x<D;)S.setCellFromCodePoint(this._activeBuffer.x++,0,1,R.fg,R.bg,R.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),S=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=D-1,b===2)continue}if(H&&(S.insertCells(this._activeBuffer.x,b,this._activeBuffer.getNullCell(R),R),S.getWidth(D-1)===2&&S.setCellFromCodePoint(D-1,e.NULL_CELL_CODE,e.NULL_CELL_WIDTH,R.fg,R.bg,R.extended)),S.setCellFromCodePoint(this._activeBuffer.x++,x,b,R.fg,R.bg,R.extended),b>0)for(;--b;)S.setCellFromCodePoint(this._activeBuffer.x++,0,0,R.fg,R.bg,R.extended)}else S.getWidth(this._activeBuffer.x-1)?S.addCodepointToCell(this._activeBuffer.x-1,x):S.addCodepointToCell(this._activeBuffer.x-2,x)}f-u>0&&(S.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<D&&f-u>0&&S.getWidth(this._activeBuffer.x)===0&&!S.hasContent(this._activeBuffer.x)&&S.setCellFromCodePoint(this._activeBuffer.x,0,1,R.fg,R.bg,R.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(g,u){return g.final!=="t"||g.prefix||g.intermediates?this._parser.registerCsiHandler(g,u):this._parser.registerCsiHandler(g,f=>!E(f.params[0],this._optionsService.rawOptions.windowOptions)||u(f))}registerDcsHandler(g,u){return this._parser.registerDcsHandler(g,new h.DcsHandler(u))}registerEscHandler(g,u){return this._parser.registerEscHandler(g,u)}registerOscHandler(g,u){return this._parser.registerOscHandler(g,new l.OscHandler(u))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var g;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((g=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||g===void 0?void 0:g.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);u.hasWidth(this._activeBuffer.x)&&!u.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let g=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-g),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(g=this._bufferService.cols-1){this._activeBuffer.x=Math.min(g,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(g,u){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=g,this._activeBuffer.y=this._activeBuffer.scrollTop+u):(this._activeBuffer.x=g,this._activeBuffer.y=u),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(g,u){this._restrictCursor(),this._setCursor(this._activeBuffer.x+g,this._activeBuffer.y+u)}cursorUp(g){let u=this._activeBuffer.y-this._activeBuffer.scrollTop;return u>=0?this._moveCursor(0,-Math.min(u,g.params[0]||1)):this._moveCursor(0,-(g.params[0]||1)),!0}cursorDown(g){let u=this._activeBuffer.scrollBottom-this._activeBuffer.y;return u>=0?this._moveCursor(0,Math.min(u,g.params[0]||1)):this._moveCursor(0,g.params[0]||1),!0}cursorForward(g){return this._moveCursor(g.params[0]||1,0),!0}cursorBackward(g){return this._moveCursor(-(g.params[0]||1),0),!0}cursorNextLine(g){return this.cursorDown(g),this._activeBuffer.x=0,!0}cursorPrecedingLine(g){return this.cursorUp(g),this._activeBuffer.x=0,!0}cursorCharAbsolute(g){return this._setCursor((g.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(g){return this._setCursor(g.length>=2?(g.params[1]||1)-1:0,(g.params[0]||1)-1),!0}charPosAbsolute(g){return this._setCursor((g.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(g){return this._moveCursor(g.params[0]||1,0),!0}linePosAbsolute(g){return this._setCursor(this._activeBuffer.x,(g.params[0]||1)-1),!0}vPositionRelative(g){return this._moveCursor(0,g.params[0]||1),!0}hVPosition(g){return this.cursorPosition(g),!0}tabClear(g){let u=g.params[0];return u===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:u===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(g){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let u=g.params[0]||1;for(;u--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(g){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let u=g.params[0]||1;for(;u--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(g){let u=g.params[0];return u===1&&(this._curAttrData.bg|=536870912),u!==2&&u!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(g,u,f,x=!1,b=!1){let L=this._activeBuffer.lines.get(this._activeBuffer.ybase+g);L.replaceCells(u,f,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),b),x&&(L.isWrapped=!1)}_resetBufferLine(g,u=!1){let f=this._activeBuffer.lines.get(this._activeBuffer.ybase+g);f.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),u),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+g),f.isWrapped=!1}eraseInDisplay(g,u=!1){let f;switch(this._restrictCursor(this._bufferService.cols),g.params[0]){case 0:for(f=this._activeBuffer.y,this._dirtyRowTracker.markDirty(f),this._eraseInBufferLine(f++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,u);f<this._bufferService.rows;f++)this._resetBufferLine(f,u);this._dirtyRowTracker.markDirty(f);break;case 1:for(f=this._activeBuffer.y,this._dirtyRowTracker.markDirty(f),this._eraseInBufferLine(f,0,this._activeBuffer.x+1,!0,u),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(f+1).isWrapped=!1);f--;)this._resetBufferLine(f,u);this._dirtyRowTracker.markDirty(0);break;case 2:for(f=this._bufferService.rows,this._dirtyRowTracker.markDirty(f-1);f--;)this._resetBufferLine(f,u);this._dirtyRowTracker.markDirty(0);break;case 3:let x=this._activeBuffer.lines.length-this._bufferService.rows;x>0&&(this._activeBuffer.lines.trimStart(x),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-x,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-x,0),this._onScroll.fire(0))}return!0}eraseInLine(g,u=!1){switch(this._restrictCursor(this._bufferService.cols),g.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,u);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,u);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,u)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(g){this._restrictCursor();let u=g.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let f=this._activeBuffer.ybase+this._activeBuffer.y,x=this._bufferService.rows-1-this._activeBuffer.scrollBottom,b=this._bufferService.rows-1+this._activeBuffer.ybase-x+1;for(;u--;)this._activeBuffer.lines.splice(b-1,1),this._activeBuffer.lines.splice(f,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(g){this._restrictCursor();let u=g.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let f=this._activeBuffer.ybase+this._activeBuffer.y,x;for(x=this._bufferService.rows-1-this._activeBuffer.scrollBottom,x=this._bufferService.rows-1+this._activeBuffer.ybase-x;u--;)this._activeBuffer.lines.splice(f,1),this._activeBuffer.lines.splice(x,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(g){this._restrictCursor();let u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return u&&(u.insertCells(this._activeBuffer.x,g.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(g){this._restrictCursor();let u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return u&&(u.deleteCells(this._activeBuffer.x,g.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(g){let u=g.params[0]||1;for(;u--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(g){let u=g.params[0]||1;for(;u--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(A.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(g){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let u=g.params[0]||1;for(let f=this._activeBuffer.scrollTop;f<=this._activeBuffer.scrollBottom;++f){let x=this._activeBuffer.lines.get(this._activeBuffer.ybase+f);x.deleteCells(0,u,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),x.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(g){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let u=g.params[0]||1;for(let f=this._activeBuffer.scrollTop;f<=this._activeBuffer.scrollBottom;++f){let x=this._activeBuffer.lines.get(this._activeBuffer.ybase+f);x.insertCells(0,u,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),x.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(g){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let u=g.params[0]||1;for(let f=this._activeBuffer.scrollTop;f<=this._activeBuffer.scrollBottom;++f){let x=this._activeBuffer.lines.get(this._activeBuffer.ybase+f);x.insertCells(this._activeBuffer.x,u,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),x.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(g){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let u=g.params[0]||1;for(let f=this._activeBuffer.scrollTop;f<=this._activeBuffer.scrollBottom;++f){let x=this._activeBuffer.lines.get(this._activeBuffer.ybase+f);x.deleteCells(this._activeBuffer.x,u,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),x.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(g){this._restrictCursor();let u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return u&&(u.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(g.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(g){if(!this._parser.precedingCodepoint)return!0;let u=g.params[0]||1,f=new Uint32Array(u);for(let x=0;x<u;++x)f[x]=this._parser.precedingCodepoint;return this.print(f,0,f.length),!0}sendDeviceAttributesPrimary(g){return g.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(s.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(s.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(g){return g.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(s.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(s.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(g.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(s.C0.ESC+"[>83;40003;0c")),!0}_is(g){return(this._optionsService.rawOptions.termName+"").indexOf(g)===0}setMode(g){for(let u=0;u<g.length;u++)switch(g.params[u]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(g){for(let u=0;u<g.length;u++)switch(g.params[u]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,c.DEFAULT_CHARSET),this._charsetService.setgCharset(1,c.DEFAULT_CHARSET),this._charsetService.setgCharset(2,c.DEFAULT_CHARSET),this._charsetService.setgCharset(3,c.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(g){for(let u=0;u<g.length;u++)switch(g.params[u]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(g){for(let u=0;u<g.length;u++)switch(g.params[u]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),g.params[u]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(g,u){let f=this._coreService.decPrivateModes,{activeProtocol:x,activeEncoding:b}=this._coreMouseService,L=this._coreService,{buffers:N,cols:D}=this._bufferService,{active:V,alt:H}=N,R=this._optionsService.rawOptions,S=_=>_?1:2,y=g.params[0];return Q=y,G=u?y===2?3:y===4?S(L.modes.insertMode):y===12?4:y===20?S(R.convertEol):0:y===1?S(f.applicationCursorKeys):y===3?R.windowOptions.setWinLines?D===80?2:D===132?1:0:0:y===6?S(f.origin):y===7?S(f.wraparound):y===8?3:y===9?S(x==="X10"):y===12?S(R.cursorBlink):y===25?S(!L.isCursorHidden):y===45?S(f.reverseWraparound):y===66?S(f.applicationKeypad):y===1e3?S(x==="VT200"):y===1002?S(x==="DRAG"):y===1003?S(x==="ANY"):y===1004?S(f.sendFocus):y===1005?4:y===1006?S(b==="SGR"):y===1015?4:y===1016?S(b==="SGR_PIXELS"):y===1048?1:y===47||y===1047||y===1049?S(V===H):y===2004?S(f.bracketedPasteMode):0,L.triggerDataEvent(`${s.C0.ESC}[${u?"":"?"}${Q};${G}$y`),!0;var Q,G}_updateAttrColor(g,u,f,x,b){return u===2?(g|=50331648,g&=-16777216,g|=k.AttributeData.fromColorRGB([f,x,b])):u===5&&(g&=-50331904,g|=33554432|255&f),g}_extractColor(g,u,f){let x=[0,0,-1,0,0,0],b=0,L=0;do{if(x[L+b]=g.params[u+L],g.hasSubParams(u+L)){let N=g.getSubParams(u+L),D=0;do x[1]===5&&(b=1),x[L+D+1+b]=N[D];while(++D<N.length&&D+L+1+b<x.length);break}if(x[1]===5&&L+b>=2||x[1]===2&&L+b>=5)break;x[1]&&(b=1)}while(++L+u<g.length&&L+b<x.length);for(let N=2;N<x.length;++N)x[N]===-1&&(x[N]=0);switch(x[0]){case 38:f.fg=this._updateAttrColor(f.fg,x[1],x[3],x[4],x[5]);break;case 48:f.bg=this._updateAttrColor(f.bg,x[1],x[3],x[4],x[5]);break;case 58:f.extended=f.extended.clone(),f.extended.underlineColor=this._updateAttrColor(f.extended.underlineColor,x[1],x[3],x[4],x[5])}return L}_processUnderline(g,u){u.extended=u.extended.clone(),(!~g||g>5)&&(g=1),u.extended.underlineStyle=g,u.fg|=268435456,g===0&&(u.fg&=-268435457),u.updateExtended()}_processSGR0(g){g.fg=A.DEFAULT_ATTR_DATA.fg,g.bg=A.DEFAULT_ATTR_DATA.bg,g.extended=g.extended.clone(),g.extended.underlineStyle=0,g.extended.underlineColor&=-67108864,g.updateExtended()}charAttributes(g){if(g.length===1&&g.params[0]===0)return this._processSGR0(this._curAttrData),!0;let u=g.length,f,x=this._curAttrData;for(let b=0;b<u;b++)f=g.params[b],f>=30&&f<=37?(x.fg&=-50331904,x.fg|=16777216|f-30):f>=40&&f<=47?(x.bg&=-50331904,x.bg|=16777216|f-40):f>=90&&f<=97?(x.fg&=-50331904,x.fg|=16777224|f-90):f>=100&&f<=107?(x.bg&=-50331904,x.bg|=16777224|f-100):f===0?this._processSGR0(x):f===1?x.fg|=134217728:f===3?x.bg|=67108864:f===4?(x.fg|=268435456,this._processUnderline(g.hasSubParams(b)?g.getSubParams(b)[0]:1,x)):f===5?x.fg|=536870912:f===7?x.fg|=67108864:f===8?x.fg|=1073741824:f===9?x.fg|=2147483648:f===2?x.bg|=134217728:f===21?this._processUnderline(2,x):f===22?(x.fg&=-134217729,x.bg&=-134217729):f===23?x.bg&=-67108865:f===24?(x.fg&=-268435457,this._processUnderline(0,x)):f===25?x.fg&=-536870913:f===27?x.fg&=-67108865:f===28?x.fg&=-1073741825:f===29?x.fg&=2147483647:f===39?(x.fg&=-67108864,x.fg|=16777215&A.DEFAULT_ATTR_DATA.fg):f===49?(x.bg&=-67108864,x.bg|=16777215&A.DEFAULT_ATTR_DATA.bg):f===38||f===48||f===58?b+=this._extractColor(g,b,x):f===59?(x.extended=x.extended.clone(),x.extended.underlineColor=-1,x.updateExtended()):f===100?(x.fg&=-67108864,x.fg|=16777215&A.DEFAULT_ATTR_DATA.fg,x.bg&=-67108864,x.bg|=16777215&A.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",f);return!0}deviceStatus(g){switch(g.params[0]){case 5:this._coreService.triggerDataEvent(`${s.C0.ESC}[0n`);break;case 6:let u=this._activeBuffer.y+1,f=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${s.C0.ESC}[${u};${f}R`)}return!0}deviceStatusPrivate(g){if(g.params[0]===6){let u=this._activeBuffer.y+1,f=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${s.C0.ESC}[?${u};${f}R`)}return!0}softReset(g){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=A.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(g){let u=g.params[0]||1;switch(u){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}let f=u%2==1;return this._optionsService.options.cursorBlink=f,!0}setScrollRegion(g){let u=g.params[0]||1,f;return(g.length<2||(f=g.params[1])>this._bufferService.rows||f===0)&&(f=this._bufferService.rows),f>u&&(this._activeBuffer.scrollTop=u-1,this._activeBuffer.scrollBottom=f-1,this._setCursor(0,0)),!0}windowOptions(g){if(!E(g.params[0],this._optionsService.rawOptions.windowOptions))return!0;let u=g.length>1?g.params[1]:0;switch(g.params[0]){case 14:u!==2&&this._onRequestWindowsOptionsReport.fire(m.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(m.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${s.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:u!==0&&u!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),u!==0&&u!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:u!==0&&u!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),u!==0&&u!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(g){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(g){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(g){return this._windowTitle=g,this._onTitleChange.fire(g),!0}setIconName(g){return this._iconName=g,!0}setOrReportIndexedColor(g){let u=[],f=g.split(";");for(;f.length>1;){let x=f.shift(),b=f.shift();if(/^\d+$/.exec(x)){let L=parseInt(x);if(0<=L&&L<256)if(b==="?")u.push({type:0,index:L});else{let N=(0,i.parseColor)(b);N&&u.push({type:1,index:L,color:N})}}}return u.length&&this._onColor.fire(u),!0}setHyperlink(g){let u=g.split(";");return!(u.length<2)&&(u[1]?this._createHyperlink(u[0],u[1]):!u[0]&&this._finishHyperlink())}_createHyperlink(g,u){this._getCurrentLinkId()&&this._finishHyperlink();let f=g.split(":"),x,b=f.findIndex(L=>L.startsWith("id="));return b!==-1&&(x=f[b].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:x,uri:u}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(g,u){let f=g.split(";");for(let x=0;x<f.length&&!(u>=this._specialColors.length);++x,++u)if(f[x]==="?")this._onColor.fire([{type:0,index:this._specialColors[u]}]);else{let b=(0,i.parseColor)(f[x]);b&&this._onColor.fire([{type:1,index:this._specialColors[u],color:b}])}return!0}setOrReportFgColor(g){return this._setOrReportSpecialColor(g,0)}setOrReportBgColor(g){return this._setOrReportSpecialColor(g,1)}setOrReportCursorColor(g){return this._setOrReportSpecialColor(g,2)}restoreIndexedColor(g){if(!g)return this._onColor.fire([{type:2}]),!0;let u=[],f=g.split(";");for(let x=0;x<f.length;++x)if(/^\d+$/.exec(f[x])){let b=parseInt(f[x]);0<=b&&b<256&&u.push({type:2,index:b})}return u.length&&this._onColor.fire(u),!0}restoreFgColor(g){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(g){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(g){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,c.DEFAULT_CHARSET),!0}selectCharset(g){return g.length!==2?(this.selectDefaultCharset(),!0):(g[0]==="/"||this._charsetService.setgCharset(d[g[0]],c.CHARSETS[g[1]]||c.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let g=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,g,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=A.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=A.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(g){return this._charsetService.setgLevel(g),!0}screenAlignmentPattern(){let g=new j.CellData;g.content=4194304|"E".charCodeAt(0),g.fg=this._curAttrData.fg,g.bg=this._curAttrData.bg,this._setCursor(0,0);for(let u=0;u<this._bufferService.rows;++u){let f=this._activeBuffer.ybase+this._activeBuffer.y+u,x=this._activeBuffer.lines.get(f);x&&(x.fill(g),x.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(g,u){let f=this._bufferService.buffer,x=this._optionsService.rawOptions;return(b=>(this._coreService.triggerDataEvent(`${s.C0.ESC}${b}${s.C0.ESC}\\`),!0))(g==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:g==='"p'?'P1$r61;1"p':g==="r"?`P1$r${f.scrollTop+1};${f.scrollBottom+1}r`:g==="m"?"P1$r0m":g===" q"?`P1$r${{block:2,underline:4,bar:6}[x.cursorStyle]-(x.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(g,u){this._dirtyRowTracker.markRangeDirty(g,u)}}B.InputHandler=M;let T=class{constructor(w){this._bufferService=w,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(w){w<this.start?this.start=w:w>this.end&&(this.end=w)}markRangeDirty(w,g){w>g&&(X=w,w=g,g=X),w<this.start&&(this.start=w),g>this.end&&(this.end=g)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};T=o([p(0,a.IBufferService)],T)},844:(C,B)=>{function t(o){for(let p of o)p.dispose();o.length=0}Object.defineProperty(B,"__esModule",{value:!0}),B.getDisposeArrayDisposable=B.disposeArray=B.toDisposable=B.Disposable=void 0,B.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let o of this._disposables)o.dispose();this._disposables.length=0}register(o){return this._disposables.push(o),o}unregister(o){let p=this._disposables.indexOf(o);p!==-1&&this._disposables.splice(p,1)}},B.toDisposable=function(o){return{dispose:o}},B.disposeArray=t,B.getDisposeArrayDisposable=function(o){return{dispose:()=>t(o)}}},1505:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.FourKeyMap=B.TwoKeyMap=void 0;class t{constructor(){this._data={}}set(p,s,c){this._data[p]||(this._data[p]={}),this._data[p][s]=c}get(p,s){return this._data[p]?this._data[p][s]:void 0}clear(){this._data={}}}B.TwoKeyMap=t,B.FourKeyMap=class{constructor(){this._data=new t}set(o,p,s,c,P){this._data.get(o,p)||this._data.set(o,p,new t),this._data.get(o,p).set(s,c,P)}get(o,p,s,c){var P;return(P=this._data.get(o,p))===null||P===void 0?void 0:P.get(s,c)}clear(){this._data.clear()}}},6114:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.isChromeOS=B.isLinux=B.isWindows=B.isIphone=B.isIpad=B.isMac=B.getSafariVersion=B.isSafari=B.isLegacyEdge=B.isFirefox=B.isNode=void 0,B.isNode=typeof navigator=="undefined";let t=B.isNode?"node":navigator.userAgent,o=B.isNode?"node":navigator.platform;B.isFirefox=t.includes("Firefox"),B.isLegacyEdge=t.includes("Edge"),B.isSafari=/^((?!chrome|android).)*safari/i.test(t),B.getSafariVersion=function(){if(!B.isSafari)return 0;let p=t.match(/Version\/(\d+)/);return p===null||p.length<2?0:parseInt(p[1])},B.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(o),B.isIpad=o==="iPad",B.isIphone=o==="iPhone",B.isWindows=["Windows","Win16","Win32","WinCE"].includes(o),B.isLinux=o.indexOf("Linux")>=0,B.isChromeOS=/\bCrOS\b/.test(t)},6106:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.SortedList=void 0;let t=0;B.SortedList=class{constructor(o){this._getKey=o,this._array=[]}clear(){this._array.length=0}insert(o){this._array.length!==0?(t=this._search(this._getKey(o),0,this._array.length-1),this._array.splice(t,0,o)):this._array.push(o)}delete(o){if(this._array.length===0)return!1;let p=this._getKey(o);if(p===void 0||(t=this._search(p,0,this._array.length-1),t===-1)||this._getKey(this._array[t])!==p)return!1;do if(this._array[t]===o)return this._array.splice(t,1),!0;while(++t<this._array.length&&this._getKey(this._array[t])===p);return!1}*getKeyIterator(o){if(this._array.length!==0&&(t=this._search(o,0,this._array.length-1),!(t<0||t>=this._array.length)&&this._getKey(this._array[t])===o))do yield this._array[t];while(++t<this._array.length&&this._getKey(this._array[t])===o)}forEachByKey(o,p){if(this._array.length!==0&&(t=this._search(o,0,this._array.length-1),!(t<0||t>=this._array.length)&&this._getKey(this._array[t])===o))do p(this._array[t]);while(++t<this._array.length&&this._getKey(this._array[t])===o)}values(){return this._array.values()}_search(o,p,s){if(s<p)return p;let c=Math.floor((p+s)/2),P=this._getKey(this._array[c]);if(P>o)return this._search(o,p,c-1);if(P<o)return this._search(o,c+1,s);for(;c>0&&this._getKey(this._array[c-1])===o;)c--;return c}}},7226:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.DebouncedIdleTask=B.IdleTaskQueue=B.PriorityTaskQueue=void 0;let o=t(6114);class p{constructor(){this._tasks=[],this._i=0}enqueue(P){this._tasks.push(P),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(P){this._idleCallback=void 0;let n=0,r=0,A=P.timeRemaining(),$=0;for(;this._i<this._tasks.length;){if(n=Date.now(),this._tasks[this._i]()||this._i++,n=Math.max(1,Date.now()-n),r=Math.max(n,r),$=P.timeRemaining(),1.5*r>$)return A-n<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(A-n))}ms`),void this._start();A=$}this.clear()}}class s extends p{_requestCallback(P){return setTimeout(()=>P(this._createDeadline(16)))}_cancelCallback(P){clearTimeout(P)}_createDeadline(P){let n=Date.now()+P;return{timeRemaining:()=>Math.max(0,n-Date.now())}}}B.PriorityTaskQueue=s,B.IdleTaskQueue=!o.isNode&&"requestIdleCallback"in window?class extends p{_requestCallback(c){return requestIdleCallback(c)}_cancelCallback(c){cancelIdleCallback(c)}}:s,B.DebouncedIdleTask=class{constructor(){this._queue=new B.IdleTaskQueue}set(c){this._queue.clear(),this._queue.enqueue(c)}flush(){this._queue.flush()}}},9282:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.updateWindowsModeWrappedState=void 0;let o=t(643);B.updateWindowsModeWrappedState=function(p){let s=p.buffer.lines.get(p.buffer.ybase+p.buffer.y-1),c=s==null?void 0:s.get(p.cols-1),P=p.buffer.lines.get(p.buffer.ybase+p.buffer.y);P&&c&&(P.isWrapped=c[o.CHAR_DATA_CODE_INDEX]!==o.NULL_CELL_CODE&&c[o.CHAR_DATA_CODE_INDEX]!==o.WHITESPACE_CELL_CODE)}},3734:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.ExtendedAttrs=B.AttributeData=void 0;class t{constructor(){this.fg=0,this.bg=0,this.extended=new o}static toColorRGB(s){return[s>>>16&255,s>>>8&255,255&s]}static fromColorRGB(s){return(255&s[0])<<16|(255&s[1])<<8|255&s[2]}clone(){let s=new t;return s.fg=this.fg,s.bg=this.bg,s.extended=this.extended.clone(),s}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}B.AttributeData=t;class o{constructor(s=0,c=0){this._ext=0,this._urlId=0,this._ext=s,this._urlId=c}get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(s){this._ext=s}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(s){this._ext&=-469762049,this._ext|=s<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(s){this._ext&=-67108864,this._ext|=67108863&s}get urlId(){return this._urlId}set urlId(s){this._urlId=s}clone(){return new o(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}B.ExtendedAttrs=o},9092:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.BufferStringIterator=B.Buffer=B.MAX_BUFFER_SIZE=void 0;let o=t(6349),p=t(8437),s=t(511),c=t(643),P=t(4634),n=t(4863),r=t(7116),A=t(3734),$=t(7226);B.MAX_BUFFER_SIZE=4294967295,B.Buffer=class{constructor(j,k,a){this._hasScrollback=j,this._optionsService=k,this._bufferService=a,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=p.DEFAULT_ATTR_DATA.clone(),this.savedCharset=r.DEFAULT_CHARSET,this.markers=[],this._nullCell=s.CellData.fromCharData([0,c.NULL_CELL_CHAR,c.NULL_CELL_WIDTH,c.NULL_CELL_CODE]),this._whitespaceCell=s.CellData.fromCharData([0,c.WHITESPACE_CELL_CHAR,c.WHITESPACE_CELL_WIDTH,c.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new $.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new o.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(j){return j?(this._nullCell.fg=j.fg,this._nullCell.bg=j.bg,this._nullCell.extended=j.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new A.ExtendedAttrs),this._nullCell}getWhitespaceCell(j){return j?(this._whitespaceCell.fg=j.fg,this._whitespaceCell.bg=j.bg,this._whitespaceCell.extended=j.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new A.ExtendedAttrs),this._whitespaceCell}getBlankLine(j,k){return new p.BufferLine(this._bufferService.cols,this.getNullCell(j),k)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let j=this.ybase+this.y-this.ydisp;return j>=0&&j<this._rows}_getCorrectBufferLength(j){if(!this._hasScrollback)return j;let k=j+this._optionsService.rawOptions.scrollback;return k>B.MAX_BUFFER_SIZE?B.MAX_BUFFER_SIZE:k}fillViewportRows(j){if(this.lines.length===0){j===void 0&&(j=p.DEFAULT_ATTR_DATA);let k=this._rows;for(;k--;)this.lines.push(this.getBlankLine(j))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new o.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(j,k){let a=this.getNullCell(p.DEFAULT_ATTR_DATA),l=0,h=this._getCorrectBufferLength(k);if(h>this.lines.maxLength&&(this.lines.maxLength=h),this.lines.length>0){if(this._cols<j)for(let d=0;d<this.lines.length;d++)l+=+this.lines.get(d).resize(j,a);let i=0;if(this._rows<k)for(let d=this._rows;d<k;d++)this.lines.length<k+this.ybase&&(this._optionsService.rawOptions.windowsMode?this.lines.push(new p.BufferLine(j,a)):this.ybase>0&&this.lines.length<=this.ybase+this.y+i+1?(this.ybase--,i++,this.ydisp>0&&this.ydisp--):this.lines.push(new p.BufferLine(j,a)));else for(let d=this._rows;d>k;d--)this.lines.length>k+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(h<this.lines.maxLength){let d=this.lines.length-h;d>0&&(this.lines.trimStart(d),this.ybase=Math.max(this.ybase-d,0),this.ydisp=Math.max(this.ydisp-d,0),this.savedY=Math.max(this.savedY-d,0)),this.lines.maxLength=h}this.x=Math.min(this.x,j-1),this.y=Math.min(this.y,k-1),i&&(this.y+=i),this.savedX=Math.min(this.savedX,j-1),this.scrollTop=0}if(this.scrollBottom=k-1,this._isReflowEnabled&&(this._reflow(j,k),this._cols>j))for(let i=0;i<this.lines.length;i++)l+=+this.lines.get(i).resize(j,a);this._cols=j,this._rows=k,this._memoryCleanupQueue.clear(),l>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let j=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,j=!1);let k=0;for(;this._memoryCleanupPosition<this.lines.length;)if(k+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),k>100)return!0;return j}get _isReflowEnabled(){return this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(j,k){this._cols!==j&&(j>this._cols?this._reflowLarger(j,k):this._reflowSmaller(j,k))}_reflowLarger(j,k){let a=(0,P.reflowLargerGetLinesToRemove)(this.lines,this._cols,j,this.ybase+this.y,this.getNullCell(p.DEFAULT_ATTR_DATA));if(a.length>0){let l=(0,P.reflowLargerCreateNewLayout)(this.lines,a);(0,P.reflowLargerApplyNewLayout)(this.lines,l.layout),this._reflowLargerAdjustViewport(j,k,l.countRemoved)}}_reflowLargerAdjustViewport(j,k,a){let l=this.getNullCell(p.DEFAULT_ATTR_DATA),h=a;for(;h-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<k&&this.lines.push(new p.BufferLine(j,l))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-a,0)}_reflowSmaller(j,k){let a=this.getNullCell(p.DEFAULT_ATTR_DATA),l=[],h=0;for(let i=this.lines.length-1;i>=0;i--){let d=this.lines.get(i);if(!d||!d.isWrapped&&d.getTrimmedLength()<=j)continue;let v=[d];for(;d.isWrapped&&i>0;)d=this.lines.get(--i),v.unshift(d);let E=this.ybase+this.y;if(E>=i&&E<i+v.length)continue;let m=v[v.length-1].getTrimmedLength(),X=(0,P.reflowSmallerGetNewLineLengths)(v,this._cols,j),M=X.length-v.length,T;T=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+M):Math.max(0,this.lines.length-this.lines.maxLength+M);let w=[];for(let L=0;L<M;L++){let N=this.getBlankLine(p.DEFAULT_ATTR_DATA,!0);w.push(N)}w.length>0&&(l.push({start:i+v.length+h,newLines:w}),h+=w.length),v.push(...w);let g=X.length-1,u=X[g];u===0&&(g--,u=X[g]);let f=v.length-M-1,x=m;for(;f>=0;){let L=Math.min(x,u);if(v[g]===void 0)break;if(v[g].copyCellsFrom(v[f],x-L,u-L,L,!0),u-=L,u===0&&(g--,u=X[g]),x-=L,x===0){f--;let N=Math.max(f,0);x=(0,P.getWrappedLineTrimmedLength)(v,N,this._cols)}}for(let L=0;L<v.length;L++)X[L]<j&&v[L].setCell(X[L],a);let b=M-T;for(;b-- >0;)this.ybase===0?this.y<k-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+h)-k&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+M,this.ybase+k-1)}if(l.length>0){let i=[],d=[];for(let g=0;g<this.lines.length;g++)d.push(this.lines.get(g));let v=this.lines.length,E=v-1,m=0,X=l[m];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+h);let M=0;for(let g=Math.min(this.lines.maxLength-1,v+h-1);g>=0;g--)if(X&&X.start>E+M){for(let u=X.newLines.length-1;u>=0;u--)this.lines.set(g--,X.newLines[u]);g++,i.push({index:E+1,amount:X.newLines.length}),M+=X.newLines.length,X=l[++m]}else this.lines.set(g,d[E--]);let T=0;for(let g=i.length-1;g>=0;g--)i[g].index+=T,this.lines.onInsertEmitter.fire(i[g]),T+=i[g].amount;let w=Math.max(0,v+h-this.lines.maxLength);w>0&&this.lines.onTrimEmitter.fire(w)}}stringIndexToBufferIndex(j,k,a=!1){for(;k;){let l=this.lines.get(j);if(!l)return[-1,-1];let h=a?l.getTrimmedLength():l.length;for(let i=0;i<h;++i)if(l.get(i)[c.CHAR_DATA_WIDTH_INDEX]&&(k-=l.get(i)[c.CHAR_DATA_CHAR_INDEX].length||1),k<0)return[j,i];j++}return[j,0]}translateBufferLineToString(j,k,a=0,l){let h=this.lines.get(j);return h?h.translateToString(k,a,l):""}getWrappedRangeForLine(j){let k=j,a=j;for(;k>0&&this.lines.get(k).isWrapped;)k--;for(;a+1<this.lines.length&&this.lines.get(a+1).isWrapped;)a++;return{first:k,last:a}}setupTabStops(j){for(j!=null?this.tabs[j]||(j=this.prevStop(j)):(this.tabs={},j=0);j<this._cols;j+=this._optionsService.rawOptions.tabStopWidth)this.tabs[j]=!0}prevStop(j){for(j==null&&(j=this.x);!this.tabs[--j]&&j>0;);return j>=this._cols?this._cols-1:j<0?0:j}nextStop(j){for(j==null&&(j=this.x);!this.tabs[++j]&&j<this._cols;);return j>=this._cols?this._cols-1:j<0?0:j}clearMarkers(j){this._isClearing=!0;for(let k=0;k<this.markers.length;k++)this.markers[k].line===j&&(this.markers[k].dispose(),this.markers.splice(k--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let j=0;j<this.markers.length;j++)this.markers[j].dispose(),this.markers.splice(j--,1);this._isClearing=!1}addMarker(j){let k=new n.Marker(j);return this.markers.push(k),k.register(this.lines.onTrim(a=>{k.line-=a,k.line<0&&k.dispose()})),k.register(this.lines.onInsert(a=>{k.line>=a.index&&(k.line+=a.amount)})),k.register(this.lines.onDelete(a=>{k.line>=a.index&&k.line<a.index+a.amount&&k.dispose(),k.line>a.index&&(k.line-=a.amount)})),k.register(k.onDispose(()=>this._removeMarker(k))),k}_removeMarker(j){this._isClearing||this.markers.splice(this.markers.indexOf(j),1)}iterator(j,k,a,l,h){return new e(this,j,k,a,l,h)}};class e{constructor(k,a,l=0,h=k.lines.length,i=0,d=0){this._buffer=k,this._trimRight=a,this._startIndex=l,this._endIndex=h,this._startOverscan=i,this._endOverscan=d,this._startIndex<0&&(this._startIndex=0),this._endIndex>this._buffer.lines.length&&(this._endIndex=this._buffer.lines.length),this._current=this._startIndex}hasNext(){return this._current<this._endIndex}next(){let k=this._buffer.getWrappedRangeForLine(this._current);k.first<this._startIndex-this._startOverscan&&(k.first=this._startIndex-this._startOverscan),k.last>this._endIndex+this._endOverscan&&(k.last=this._endIndex+this._endOverscan),k.first=Math.max(k.first,0),k.last=Math.min(k.last,this._buffer.lines.length);let a="";for(let l=k.first;l<=k.last;++l)a+=this._buffer.translateBufferLineToString(l,this._trimRight);return this._current=k.last+1,{range:k,content:a}}}B.BufferStringIterator=e},8437:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.BufferLine=B.DEFAULT_ATTR_DATA=void 0;let o=t(482),p=t(643),s=t(511),c=t(3734);B.DEFAULT_ATTR_DATA=Object.freeze(new c.AttributeData);let P=0;class n{constructor(A,$,e=!1){this.isWrapped=e,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*A);let j=$||s.CellData.fromCharData([0,p.NULL_CELL_CHAR,p.NULL_CELL_WIDTH,p.NULL_CELL_CODE]);for(let k=0;k<A;++k)this.setCell(k,j);this.length=A}get(A){let $=this._data[3*A+0],e=2097151&$;return[this._data[3*A+1],2097152&$?this._combined[A]:e?(0,o.stringFromCodePoint)(e):"",$>>22,2097152&$?this._combined[A].charCodeAt(this._combined[A].length-1):e]}set(A,$){this._data[3*A+1]=$[p.CHAR_DATA_ATTR_INDEX],$[p.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[A]=$[1],this._data[3*A+0]=2097152|A|$[p.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*A+0]=$[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|$[p.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(A){return this._data[3*A+0]>>22}hasWidth(A){return 12582912&this._data[3*A+0]}getFg(A){return this._data[3*A+1]}getBg(A){return this._data[3*A+2]}hasContent(A){return 4194303&this._data[3*A+0]}getCodePoint(A){let $=this._data[3*A+0];return 2097152&$?this._combined[A].charCodeAt(this._combined[A].length-1):2097151&$}isCombined(A){return 2097152&this._data[3*A+0]}getString(A){let $=this._data[3*A+0];return 2097152&$?this._combined[A]:2097151&$?(0,o.stringFromCodePoint)(2097151&$):""}isProtected(A){return 536870912&this._data[3*A+2]}loadCell(A,$){return P=3*A,$.content=this._data[P+0],$.fg=this._data[P+1],$.bg=this._data[P+2],2097152&$.content&&($.combinedData=this._combined[A]),268435456&$.bg&&($.extended=this._extendedAttrs[A]),$}setCell(A,$){2097152&$.content&&(this._combined[A]=$.combinedData),268435456&$.bg&&(this._extendedAttrs[A]=$.extended),this._data[3*A+0]=$.content,this._data[3*A+1]=$.fg,this._data[3*A+2]=$.bg}setCellFromCodePoint(A,$,e,j,k,a){268435456&k&&(this._extendedAttrs[A]=a),this._data[3*A+0]=$|e<<22,this._data[3*A+1]=j,this._data[3*A+2]=k}addCodepointToCell(A,$){let e=this._data[3*A+0];2097152&e?this._combined[A]+=(0,o.stringFromCodePoint)($):(2097151&e?(this._combined[A]=(0,o.stringFromCodePoint)(2097151&e)+(0,o.stringFromCodePoint)($),e&=-2097152,e|=2097152):e=$|4194304,this._data[3*A+0]=e)}insertCells(A,$,e,j){if((A%=this.length)&&this.getWidth(A-1)===2&&this.setCellFromCodePoint(A-1,0,1,(j==null?void 0:j.fg)||0,(j==null?void 0:j.bg)||0,(j==null?void 0:j.extended)||new c.ExtendedAttrs),$<this.length-A){let k=new s.CellData;for(let a=this.length-A-$-1;a>=0;--a)this.setCell(A+$+a,this.loadCell(A+a,k));for(let a=0;a<$;++a)this.setCell(A+a,e)}else for(let k=A;k<this.length;++k)this.setCell(k,e);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,(j==null?void 0:j.fg)||0,(j==null?void 0:j.bg)||0,(j==null?void 0:j.extended)||new c.ExtendedAttrs)}deleteCells(A,$,e,j){if(A%=this.length,$<this.length-A){let k=new s.CellData;for(let a=0;a<this.length-A-$;++a)this.setCell(A+a,this.loadCell(A+$+a,k));for(let a=this.length-$;a<this.length;++a)this.setCell(a,e)}else for(let k=A;k<this.length;++k)this.setCell(k,e);A&&this.getWidth(A-1)===2&&this.setCellFromCodePoint(A-1,0,1,(j==null?void 0:j.fg)||0,(j==null?void 0:j.bg)||0,(j==null?void 0:j.extended)||new c.ExtendedAttrs),this.getWidth(A)!==0||this.hasContent(A)||this.setCellFromCodePoint(A,0,1,(j==null?void 0:j.fg)||0,(j==null?void 0:j.bg)||0,(j==null?void 0:j.extended)||new c.ExtendedAttrs)}replaceCells(A,$,e,j,k=!1){if(k)for(A&&this.getWidth(A-1)===2&&!this.isProtected(A-1)&&this.setCellFromCodePoint(A-1,0,1,(j==null?void 0:j.fg)||0,(j==null?void 0:j.bg)||0,(j==null?void 0:j.extended)||new c.ExtendedAttrs),$<this.length&&this.getWidth($-1)===2&&!this.isProtected($)&&this.setCellFromCodePoint($,0,1,(j==null?void 0:j.fg)||0,(j==null?void 0:j.bg)||0,(j==null?void 0:j.extended)||new c.ExtendedAttrs);A<$&&A<this.length;)this.isProtected(A)||this.setCell(A,e),A++;else for(A&&this.getWidth(A-1)===2&&this.setCellFromCodePoint(A-1,0,1,(j==null?void 0:j.fg)||0,(j==null?void 0:j.bg)||0,(j==null?void 0:j.extended)||new c.ExtendedAttrs),$<this.length&&this.getWidth($-1)===2&&this.setCellFromCodePoint($,0,1,(j==null?void 0:j.fg)||0,(j==null?void 0:j.bg)||0,(j==null?void 0:j.extended)||new c.ExtendedAttrs);A<$&&A<this.length;)this.setCell(A++,e)}resize(A,$){if(A===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let e=3*A;if(A>this.length){if(this._data.buffer.byteLength>=4*e)this._data=new Uint32Array(this._data.buffer,0,e);else{let j=new Uint32Array(e);j.set(this._data),this._data=j}for(let j=this.length;j<A;++j)this.setCell(j,$)}else{this._data=this._data.subarray(0,e);let j=Object.keys(this._combined);for(let a=0;a<j.length;a++){let l=parseInt(j[a],10);l>=A&&delete this._combined[l]}let k=Object.keys(this._extendedAttrs);for(let a=0;a<k.length;a++){let l=parseInt(k[a],10);l>=A&&delete this._extendedAttrs[l]}}return this.length=A,4*e*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let A=new Uint32Array(this._data.length);return A.set(this._data),this._data=A,1}return 0}fill(A,$=!1){if($)for(let e=0;e<this.length;++e)this.isProtected(e)||this.setCell(e,A);else{this._combined={},this._extendedAttrs={};for(let e=0;e<this.length;++e)this.setCell(e,A)}}copyFrom(A){this.length!==A.length?this._data=new Uint32Array(A._data):this._data.set(A._data),this.length=A.length,this._combined={};for(let $ in A._combined)this._combined[$]=A._combined[$];this._extendedAttrs={};for(let $ in A._extendedAttrs)this._extendedAttrs[$]=A._extendedAttrs[$];this.isWrapped=A.isWrapped}clone(){let A=new n(0);A._data=new Uint32Array(this._data),A.length=this.length;for(let $ in this._combined)A._combined[$]=this._combined[$];for(let $ in this._extendedAttrs)A._extendedAttrs[$]=this._extendedAttrs[$];return A.isWrapped=this.isWrapped,A}getTrimmedLength(){for(let A=this.length-1;A>=0;--A)if(4194303&this._data[3*A+0])return A+(this._data[3*A+0]>>22);return 0}copyCellsFrom(A,$,e,j,k){let a=A._data;if(k)for(let h=j-1;h>=0;h--){for(let i=0;i<3;i++)this._data[3*(e+h)+i]=a[3*($+h)+i];268435456&a[3*($+h)+2]&&(this._extendedAttrs[e+h]=A._extendedAttrs[$+h])}else for(let h=0;h<j;h++){for(let i=0;i<3;i++)this._data[3*(e+h)+i]=a[3*($+h)+i];268435456&a[3*($+h)+2]&&(this._extendedAttrs[e+h]=A._extendedAttrs[$+h])}let l=Object.keys(A._combined);for(let h=0;h<l.length;h++){let i=parseInt(l[h],10);i>=$&&(this._combined[i-$+e]=A._combined[i])}}translateToString(A=!1,$=0,e=this.length){A&&(e=Math.min(e,this.getTrimmedLength()));let j="";for(;$<e;){let k=this._data[3*$+0],a=2097151&k;j+=2097152&k?this._combined[$]:a?(0,o.stringFromCodePoint)(a):p.WHITESPACE_CELL_CHAR,$+=k>>22||1}return j}}B.BufferLine=n},4841:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.getRangeLength=void 0,B.getRangeLength=function(t,o){if(t.start.y>t.end.y)throw new Error(`Buffer range end (${t.end.x}, ${t.end.y}) cannot be before start (${t.start.x}, ${t.start.y})`);return o*(t.end.y-t.start.y)+(t.end.x-t.start.x+1)}},4634:(C,B)=>{function t(o,p,s){if(p===o.length-1)return o[p].getTrimmedLength();let c=!o[p].hasContent(s-1)&&o[p].getWidth(s-1)===1,P=o[p+1].getWidth(0)===2;return c&&P?s-1:s}Object.defineProperty(B,"__esModule",{value:!0}),B.getWrappedLineTrimmedLength=B.reflowSmallerGetNewLineLengths=B.reflowLargerApplyNewLayout=B.reflowLargerCreateNewLayout=B.reflowLargerGetLinesToRemove=void 0,B.reflowLargerGetLinesToRemove=function(o,p,s,c,P){let n=[];for(let r=0;r<o.length-1;r++){let A=r,$=o.get(++A);if(!$.isWrapped)continue;let e=[o.get(r)];for(;A<o.length&&$.isWrapped;)e.push($),$=o.get(++A);if(c>=r&&c<A){r+=e.length-1;continue}let j=0,k=t(e,j,p),a=1,l=0;for(;a<e.length;){let i=t(e,a,p),d=i-l,v=s-k,E=Math.min(d,v);e[j].copyCellsFrom(e[a],l,k,E,!1),k+=E,k===s&&(j++,k=0),l+=E,l===i&&(a++,l=0),k===0&&j!==0&&e[j-1].getWidth(s-1)===2&&(e[j].copyCellsFrom(e[j-1],s-1,k++,1,!1),e[j-1].setCell(s-1,P))}e[j].replaceCells(k,s,P);let h=0;for(let i=e.length-1;i>0&&(i>j||e[i].getTrimmedLength()===0);i--)h++;h>0&&(n.push(r+e.length-h),n.push(h)),r+=e.length-1}return n},B.reflowLargerCreateNewLayout=function(o,p){let s=[],c=0,P=p[c],n=0;for(let r=0;r<o.length;r++)if(P===r){let A=p[++c];o.onDeleteEmitter.fire({index:r-n,amount:A}),r+=A-1,n+=A,P=p[++c]}else s.push(r);return{layout:s,countRemoved:n}},B.reflowLargerApplyNewLayout=function(o,p){let s=[];for(let c=0;c<p.length;c++)s.push(o.get(p[c]));for(let c=0;c<s.length;c++)o.set(c,s[c]);o.length=p.length},B.reflowSmallerGetNewLineLengths=function(o,p,s){let c=[],P=o.map(($,e)=>t(o,e,p)).reduce(($,e)=>$+e),n=0,r=0,A=0;for(;A<P;){if(P-A<s){c.push(P-A);break}n+=s;let $=t(o,r,p);n>$&&(n-=$,r++);let e=o[r].getWidth(n-1)===2;e&&n--;let j=e?s-1:s;c.push(j),A+=j}return c},B.getWrappedLineTrimmedLength=t},5295:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.BufferSet=void 0;let o=t(9092),p=t(8460),s=t(844);class c extends s.Disposable{constructor(n,r){super(),this._optionsService=n,this._bufferService=r,this._onBufferActivate=this.register(new p.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new o.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new o.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(n){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(n),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(n,r){this._normal.resize(n,r),this._alt.resize(n,r),this.setupTabStops(n)}setupTabStops(n){this._normal.setupTabStops(n),this._alt.setupTabStops(n)}}B.BufferSet=c},511:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.CellData=void 0;let o=t(482),p=t(643),s=t(3734);class c extends s.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new s.ExtendedAttrs,this.combinedData=""}static fromCharData(n){let r=new c;return r.setFromCharData(n),r}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,o.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(n){this.fg=n[p.CHAR_DATA_ATTR_INDEX],this.bg=0;let r=!1;if(n[p.CHAR_DATA_CHAR_INDEX].length>2)r=!0;else if(n[p.CHAR_DATA_CHAR_INDEX].length===2){let A=n[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=A&&A<=56319){let $=n[p.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=$&&$<=57343?this.content=1024*(A-55296)+$-56320+65536|n[p.CHAR_DATA_WIDTH_INDEX]<<22:r=!0}else r=!0}else this.content=n[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|n[p.CHAR_DATA_WIDTH_INDEX]<<22;r&&(this.combinedData=n[p.CHAR_DATA_CHAR_INDEX],this.content=2097152|n[p.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}B.CellData=c},643:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.WHITESPACE_CELL_CODE=B.WHITESPACE_CELL_WIDTH=B.WHITESPACE_CELL_CHAR=B.NULL_CELL_CODE=B.NULL_CELL_WIDTH=B.NULL_CELL_CHAR=B.CHAR_DATA_CODE_INDEX=B.CHAR_DATA_WIDTH_INDEX=B.CHAR_DATA_CHAR_INDEX=B.CHAR_DATA_ATTR_INDEX=B.DEFAULT_EXT=B.DEFAULT_ATTR=B.DEFAULT_COLOR=void 0,B.DEFAULT_COLOR=0,B.DEFAULT_ATTR=256|B.DEFAULT_COLOR<<9,B.DEFAULT_EXT=0,B.CHAR_DATA_ATTR_INDEX=0,B.CHAR_DATA_CHAR_INDEX=1,B.CHAR_DATA_WIDTH_INDEX=2,B.CHAR_DATA_CODE_INDEX=3,B.NULL_CELL_CHAR="",B.NULL_CELL_WIDTH=1,B.NULL_CELL_CODE=0,B.WHITESPACE_CELL_CHAR=" ",B.WHITESPACE_CELL_WIDTH=1,B.WHITESPACE_CELL_CODE=32},4863:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.Marker=void 0;let o=t(8460),p=t(844);class s{constructor(P){this.line=P,this.isDisposed=!1,this._disposables=[],this._id=s._nextId++,this._onDispose=this.register(new o.EventEmitter),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,p.disposeArray)(this._disposables),this._disposables.length=0)}register(P){return this._disposables.push(P),P}}B.Marker=s,s._nextId=1},7116:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.DEFAULT_CHARSET=B.CHARSETS=void 0,B.CHARSETS={},B.DEFAULT_CHARSET=B.CHARSETS.B,B.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},B.CHARSETS.A={"#":"\xA3"},B.CHARSETS.B=void 0,B.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},B.CHARSETS.C=B.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},B.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},B.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},B.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},B.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},B.CHARSETS.E=B.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},B.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},B.CHARSETS.H=B.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},B.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},2584:(C,B)=>{var t,o;Object.defineProperty(B,"__esModule",{value:!0}),B.C1_ESCAPED=B.C1=B.C0=void 0,function(p){p.NUL="\0",p.SOH="",p.STX="",p.ETX="",p.EOT="",p.ENQ="",p.ACK="",p.BEL="\x07",p.BS="\b",p.HT="	",p.LF=`
`,p.VT="\v",p.FF="\f",p.CR="\r",p.SO="",p.SI="",p.DLE="",p.DC1="",p.DC2="",p.DC3="",p.DC4="",p.NAK="",p.SYN="",p.ETB="",p.CAN="",p.EM="",p.SUB="",p.ESC="\x1B",p.FS="",p.GS="",p.RS="",p.US="",p.SP=" ",p.DEL="\x7F"}(t=B.C0||(B.C0={})),(o=B.C1||(B.C1={})).PAD="\x80",o.HOP="\x81",o.BPH="\x82",o.NBH="\x83",o.IND="\x84",o.NEL="\x85",o.SSA="\x86",o.ESA="\x87",o.HTS="\x88",o.HTJ="\x89",o.VTS="\x8A",o.PLD="\x8B",o.PLU="\x8C",o.RI="\x8D",o.SS2="\x8E",o.SS3="\x8F",o.DCS="\x90",o.PU1="\x91",o.PU2="\x92",o.STS="\x93",o.CCH="\x94",o.MW="\x95",o.SPA="\x96",o.EPA="\x97",o.SOS="\x98",o.SGCI="\x99",o.SCI="\x9A",o.CSI="\x9B",o.ST="\x9C",o.OSC="\x9D",o.PM="\x9E",o.APC="\x9F",(B.C1_ESCAPED||(B.C1_ESCAPED={})).ST=`${t.ESC}\\`},7399:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.evaluateKeyboardEvent=void 0;let o=t(2584),p={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};B.evaluateKeyboardEvent=function(s,c,P,n){let r={type:0,cancel:!1,key:void 0},A=(s.shiftKey?1:0)|(s.altKey?2:0)|(s.ctrlKey?4:0)|(s.metaKey?8:0);switch(s.keyCode){case 0:s.key==="UIKeyInputUpArrow"?r.key=c?o.C0.ESC+"OA":o.C0.ESC+"[A":s.key==="UIKeyInputLeftArrow"?r.key=c?o.C0.ESC+"OD":o.C0.ESC+"[D":s.key==="UIKeyInputRightArrow"?r.key=c?o.C0.ESC+"OC":o.C0.ESC+"[C":s.key==="UIKeyInputDownArrow"&&(r.key=c?o.C0.ESC+"OB":o.C0.ESC+"[B");break;case 8:if(s.altKey){r.key=o.C0.ESC+o.C0.DEL;break}r.key=o.C0.DEL;break;case 9:if(s.shiftKey){r.key=o.C0.ESC+"[Z";break}r.key=o.C0.HT,r.cancel=!0;break;case 13:r.key=s.altKey?o.C0.ESC+o.C0.CR:o.C0.CR,r.cancel=!0;break;case 27:r.key=o.C0.ESC,s.altKey&&(r.key=o.C0.ESC+o.C0.ESC),r.cancel=!0;break;case 37:if(s.metaKey)break;A?(r.key=o.C0.ESC+"[1;"+(A+1)+"D",r.key===o.C0.ESC+"[1;3D"&&(r.key=o.C0.ESC+(P?"b":"[1;5D"))):r.key=c?o.C0.ESC+"OD":o.C0.ESC+"[D";break;case 39:if(s.metaKey)break;A?(r.key=o.C0.ESC+"[1;"+(A+1)+"C",r.key===o.C0.ESC+"[1;3C"&&(r.key=o.C0.ESC+(P?"f":"[1;5C"))):r.key=c?o.C0.ESC+"OC":o.C0.ESC+"[C";break;case 38:if(s.metaKey)break;A?(r.key=o.C0.ESC+"[1;"+(A+1)+"A",P||r.key!==o.C0.ESC+"[1;3A"||(r.key=o.C0.ESC+"[1;5A")):r.key=c?o.C0.ESC+"OA":o.C0.ESC+"[A";break;case 40:if(s.metaKey)break;A?(r.key=o.C0.ESC+"[1;"+(A+1)+"B",P||r.key!==o.C0.ESC+"[1;3B"||(r.key=o.C0.ESC+"[1;5B")):r.key=c?o.C0.ESC+"OB":o.C0.ESC+"[B";break;case 45:s.shiftKey||s.ctrlKey||(r.key=o.C0.ESC+"[2~");break;case 46:r.key=A?o.C0.ESC+"[3;"+(A+1)+"~":o.C0.ESC+"[3~";break;case 36:r.key=A?o.C0.ESC+"[1;"+(A+1)+"H":c?o.C0.ESC+"OH":o.C0.ESC+"[H";break;case 35:r.key=A?o.C0.ESC+"[1;"+(A+1)+"F":c?o.C0.ESC+"OF":o.C0.ESC+"[F";break;case 33:s.shiftKey?r.type=2:s.ctrlKey?r.key=o.C0.ESC+"[5;"+(A+1)+"~":r.key=o.C0.ESC+"[5~";break;case 34:s.shiftKey?r.type=3:s.ctrlKey?r.key=o.C0.ESC+"[6;"+(A+1)+"~":r.key=o.C0.ESC+"[6~";break;case 112:r.key=A?o.C0.ESC+"[1;"+(A+1)+"P":o.C0.ESC+"OP";break;case 113:r.key=A?o.C0.ESC+"[1;"+(A+1)+"Q":o.C0.ESC+"OQ";break;case 114:r.key=A?o.C0.ESC+"[1;"+(A+1)+"R":o.C0.ESC+"OR";break;case 115:r.key=A?o.C0.ESC+"[1;"+(A+1)+"S":o.C0.ESC+"OS";break;case 116:r.key=A?o.C0.ESC+"[15;"+(A+1)+"~":o.C0.ESC+"[15~";break;case 117:r.key=A?o.C0.ESC+"[17;"+(A+1)+"~":o.C0.ESC+"[17~";break;case 118:r.key=A?o.C0.ESC+"[18;"+(A+1)+"~":o.C0.ESC+"[18~";break;case 119:r.key=A?o.C0.ESC+"[19;"+(A+1)+"~":o.C0.ESC+"[19~";break;case 120:r.key=A?o.C0.ESC+"[20;"+(A+1)+"~":o.C0.ESC+"[20~";break;case 121:r.key=A?o.C0.ESC+"[21;"+(A+1)+"~":o.C0.ESC+"[21~";break;case 122:r.key=A?o.C0.ESC+"[23;"+(A+1)+"~":o.C0.ESC+"[23~";break;case 123:r.key=A?o.C0.ESC+"[24;"+(A+1)+"~":o.C0.ESC+"[24~";break;default:if(!s.ctrlKey||s.shiftKey||s.altKey||s.metaKey)if(P&&!n||!s.altKey||s.metaKey)!P||s.altKey||s.ctrlKey||s.shiftKey||!s.metaKey?s.key&&!s.ctrlKey&&!s.altKey&&!s.metaKey&&s.keyCode>=48&&s.key.length===1?r.key=s.key:s.key&&s.ctrlKey&&(s.key==="_"&&(r.key=o.C0.US),s.key==="@"&&(r.key=o.C0.NUL)):s.keyCode===65&&(r.type=1);else{let $=p[s.keyCode],e=$==null?void 0:$[s.shiftKey?1:0];if(e)r.key=o.C0.ESC+e;else if(s.keyCode>=65&&s.keyCode<=90){let j=s.ctrlKey?s.keyCode-64:s.keyCode+32,k=String.fromCharCode(j);s.shiftKey&&(k=k.toUpperCase()),r.key=o.C0.ESC+k}else if(s.keyCode===32)r.key=o.C0.ESC+(s.ctrlKey?o.C0.NUL:" ");else if(s.key==="Dead"&&s.code.startsWith("Key")){let j=s.code.slice(3,4);s.shiftKey||(j=j.toLowerCase()),r.key=o.C0.ESC+j,r.cancel=!0}}else s.keyCode>=65&&s.keyCode<=90?r.key=String.fromCharCode(s.keyCode-64):s.keyCode===32?r.key=o.C0.NUL:s.keyCode>=51&&s.keyCode<=55?r.key=String.fromCharCode(s.keyCode-51+27):s.keyCode===56?r.key=o.C0.DEL:s.keyCode===219?r.key=o.C0.ESC:s.keyCode===220?r.key=o.C0.FS:s.keyCode===221&&(r.key=o.C0.GS)}return r}},482:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.Utf8ToUtf32=B.StringToUtf32=B.utf32ToString=B.stringFromCodePoint=void 0,B.stringFromCodePoint=function(t){return t>65535?(t-=65536,String.fromCharCode(55296+(t>>10))+String.fromCharCode(t%1024+56320)):String.fromCharCode(t)},B.utf32ToString=function(t,o=0,p=t.length){let s="";for(let c=o;c<p;++c){let P=t[c];P>65535?(P-=65536,s+=String.fromCharCode(55296+(P>>10))+String.fromCharCode(P%1024+56320)):s+=String.fromCharCode(P)}return s},B.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(t,o){let p=t.length;if(!p)return 0;let s=0,c=0;if(this._interim){let P=t.charCodeAt(c++);56320<=P&&P<=57343?o[s++]=1024*(this._interim-55296)+P-56320+65536:(o[s++]=this._interim,o[s++]=P),this._interim=0}for(let P=c;P<p;++P){let n=t.charCodeAt(P);if(55296<=n&&n<=56319){if(++P>=p)return this._interim=n,s;let r=t.charCodeAt(P);56320<=r&&r<=57343?o[s++]=1024*(n-55296)+r-56320+65536:(o[s++]=n,o[s++]=r)}else n!==65279&&(o[s++]=n)}return s}},B.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(t,o){let p=t.length;if(!p)return 0;let s,c,P,n,r=0,A=0,$=0;if(this.interim[0]){let k=!1,a=this.interim[0];a&=(224&a)==192?31:(240&a)==224?15:7;let l,h=0;for(;(l=63&this.interim[++h])&&h<4;)a<<=6,a|=l;let i=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,d=i-h;for(;$<d;){if($>=p)return 0;if(l=t[$++],(192&l)!=128){$--,k=!0;break}this.interim[h++]=l,a<<=6,a|=63&l}k||(i===2?a<128?$--:o[r++]=a:i===3?a<2048||a>=55296&&a<=57343||a===65279||(o[r++]=a):a<65536||a>1114111||(o[r++]=a)),this.interim.fill(0)}let e=p-4,j=$;for(;j<p;){for(;!(!(j<e)||128&(s=t[j])||128&(c=t[j+1])||128&(P=t[j+2])||128&(n=t[j+3]));)o[r++]=s,o[r++]=c,o[r++]=P,o[r++]=n,j+=4;if(s=t[j++],s<128)o[r++]=s;else if((224&s)==192){if(j>=p)return this.interim[0]=s,r;if(c=t[j++],(192&c)!=128){j--;continue}if(A=(31&s)<<6|63&c,A<128){j--;continue}o[r++]=A}else if((240&s)==224){if(j>=p)return this.interim[0]=s,r;if(c=t[j++],(192&c)!=128){j--;continue}if(j>=p)return this.interim[0]=s,this.interim[1]=c,r;if(P=t[j++],(192&P)!=128){j--;continue}if(A=(15&s)<<12|(63&c)<<6|63&P,A<2048||A>=55296&&A<=57343||A===65279)continue;o[r++]=A}else if((248&s)==240){if(j>=p)return this.interim[0]=s,r;if(c=t[j++],(192&c)!=128){j--;continue}if(j>=p)return this.interim[0]=s,this.interim[1]=c,r;if(P=t[j++],(192&P)!=128){j--;continue}if(j>=p)return this.interim[0]=s,this.interim[1]=c,this.interim[2]=P,r;if(n=t[j++],(192&n)!=128){j--;continue}if(A=(7&s)<<18|(63&c)<<12|(63&P)<<6|63&n,A<65536||A>1114111)continue;o[r++]=A}}return r}}},225:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.UnicodeV6=void 0;let t=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],o=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],p;B.UnicodeV6=class{constructor(){if(this.version="6",!p){p=new Uint8Array(65536),p.fill(1),p[0]=0,p.fill(0,1,32),p.fill(0,127,160),p.fill(2,4352,4448),p[9001]=2,p[9002]=2,p.fill(2,11904,42192),p[12351]=1,p.fill(2,44032,55204),p.fill(2,63744,64256),p.fill(2,65040,65050),p.fill(2,65072,65136),p.fill(2,65280,65377),p.fill(2,65504,65511);for(let s=0;s<t.length;++s)p.fill(0,t[s][0],t[s][1]+1)}}wcwidth(s){return s<32?0:s<127?1:s<65536?p[s]:function(c,P){let n,r=0,A=P.length-1;if(c<P[0][0]||c>P[A][1])return!1;for(;A>=r;)if(n=r+A>>1,c>P[n][1])r=n+1;else{if(!(c<P[n][0]))return!0;A=n-1}return!1}(s,o)?0:s>=131072&&s<=196605||s>=196608&&s<=262141?2:1}}},5981:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.WriteBuffer=void 0;let o=t(8460),p=t(844);class s extends p.Disposable{constructor(P){super(),this._action=P,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new o.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(P,n){if(n!==void 0&&this._syncCalls>n)return void(this._syncCalls=0);if(this._pendingData+=P.length,this._writeBuffer.push(P),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let r;for(this._isSyncWriting=!0;r=this._writeBuffer.shift();){this._action(r);let A=this._callbacks.shift();A&&A()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(P,n){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=P.length,this._writeBuffer.push(P),this._callbacks.push(n),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=P.length,this._writeBuffer.push(P),this._callbacks.push(n)}_innerWrite(P=0,n=!0){let r=P||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){let A=this._writeBuffer[this._bufferOffset],$=this._action(A,n);if($){let j=k=>Date.now()-r>=12?setTimeout(()=>this._innerWrite(0,k)):this._innerWrite(r,k);return void $.catch(k=>(queueMicrotask(()=>{throw k}),Promise.resolve(!1))).then(j)}let e=this._callbacks[this._bufferOffset];if(e&&e(),this._bufferOffset++,this._pendingData-=A.length,Date.now()-r>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}B.WriteBuffer=s},5941:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.toRgbString=B.parseColor=void 0;let t=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,o=/^[\da-f]+$/;function p(s,c){let P=s.toString(16),n=P.length<2?"0"+P:P;switch(c){case 4:return P[0];case 8:return n;case 12:return(n+n).slice(0,3);default:return n+n}}B.parseColor=function(s){if(!s)return;let c=s.toLowerCase();if(c.indexOf("rgb:")===0){c=c.slice(4);let P=t.exec(c);if(P){let n=P[1]?15:P[4]?255:P[7]?4095:65535;return[Math.round(parseInt(P[1]||P[4]||P[7]||P[10],16)/n*255),Math.round(parseInt(P[2]||P[5]||P[8]||P[11],16)/n*255),Math.round(parseInt(P[3]||P[6]||P[9]||P[12],16)/n*255)]}}else if(c.indexOf("#")===0&&(c=c.slice(1),o.exec(c)&&[3,6,9,12].includes(c.length))){let P=c.length/3,n=[0,0,0];for(let r=0;r<3;++r){let A=parseInt(c.slice(P*r,P*r+P),16);n[r]=P===1?A<<4:P===2?A:P===3?A>>4:A>>8}return n}},B.toRgbString=function(s,c=16){let[P,n,r]=s;return`rgb:${p(P,c)}/${p(n,c)}/${p(r,c)}`}},5770:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.PAYLOAD_LIMIT=void 0,B.PAYLOAD_LIMIT=1e7},6351:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.DcsHandler=B.DcsParser=void 0;let o=t(482),p=t(8742),s=t(5770),c=[];B.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=c,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=c}registerHandler(n,r){this._handlers[n]===void 0&&(this._handlers[n]=[]);let A=this._handlers[n];return A.push(r),{dispose:()=>{let $=A.indexOf(r);$!==-1&&A.splice($,1)}}}clearHandler(n){this._handlers[n]&&delete this._handlers[n]}setHandlerFallback(n){this._handlerFb=n}reset(){if(this._active.length)for(let n=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;n>=0;--n)this._active[n].unhook(!1);this._stack.paused=!1,this._active=c,this._ident=0}hook(n,r){if(this.reset(),this._ident=n,this._active=this._handlers[n]||c,this._active.length)for(let A=this._active.length-1;A>=0;A--)this._active[A].hook(r);else this._handlerFb(this._ident,"HOOK",r)}put(n,r,A){if(this._active.length)for(let $=this._active.length-1;$>=0;$--)this._active[$].put(n,r,A);else this._handlerFb(this._ident,"PUT",(0,o.utf32ToString)(n,r,A))}unhook(n,r=!0){if(this._active.length){let A=!1,$=this._active.length-1,e=!1;if(this._stack.paused&&($=this._stack.loopPosition-1,A=r,e=this._stack.fallThrough,this._stack.paused=!1),!e&&A===!1){for(;$>=0&&(A=this._active[$].unhook(n),A!==!0);$--)if(A instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=$,this._stack.fallThrough=!1,A;$--}for(;$>=0;$--)if(A=this._active[$].unhook(!1),A instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=$,this._stack.fallThrough=!0,A}else this._handlerFb(this._ident,"UNHOOK",n);this._active=c,this._ident=0}};let P=new p.Params;P.addParam(0),B.DcsHandler=class{constructor(n){this._handler=n,this._data="",this._params=P,this._hitLimit=!1}hook(n){this._params=n.length>1||n.params[0]?n.clone():P,this._data="",this._hitLimit=!1}put(n,r,A){this._hitLimit||(this._data+=(0,o.utf32ToString)(n,r,A),this._data.length>s.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(n){let r=!1;if(this._hitLimit)r=!1;else if(n&&(r=this._handler(this._data,this._params),r instanceof Promise))return r.then(A=>(this._params=P,this._data="",this._hitLimit=!1,A));return this._params=P,this._data="",this._hitLimit=!1,r}}},2015:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.EscapeSequenceParser=B.VT500_TRANSITION_TABLE=B.TransitionTable=void 0;let o=t(844),p=t(8742),s=t(6242),c=t(6351);class P{constructor($){this.table=new Uint8Array($)}setDefault($,e){this.table.fill($<<4|e)}add($,e,j,k){this.table[e<<8|$]=j<<4|k}addMany($,e,j,k){for(let a=0;a<$.length;a++)this.table[e<<8|$[a]]=j<<4|k}}B.TransitionTable=P;let n=160;B.VT500_TRANSITION_TABLE=function(){let A=new P(4095),$=Array.apply(null,Array(256)).map((h,i)=>i),e=(h,i)=>$.slice(h,i),j=e(32,127),k=e(0,24);k.push(25),k.push.apply(k,e(28,32));let a=e(0,14),l;for(l in A.setDefault(1,0),A.addMany(j,0,2,0),a)A.addMany([24,26,153,154],l,3,0),A.addMany(e(128,144),l,3,0),A.addMany(e(144,152),l,3,0),A.add(156,l,0,0),A.add(27,l,11,1),A.add(157,l,4,8),A.addMany([152,158,159],l,0,7),A.add(155,l,11,3),A.add(144,l,11,9);return A.addMany(k,0,3,0),A.addMany(k,1,3,1),A.add(127,1,0,1),A.addMany(k,8,0,8),A.addMany(k,3,3,3),A.add(127,3,0,3),A.addMany(k,4,3,4),A.add(127,4,0,4),A.addMany(k,6,3,6),A.addMany(k,5,3,5),A.add(127,5,0,5),A.addMany(k,2,3,2),A.add(127,2,0,2),A.add(93,1,4,8),A.addMany(j,8,5,8),A.add(127,8,5,8),A.addMany([156,27,24,26,7],8,6,0),A.addMany(e(28,32),8,0,8),A.addMany([88,94,95],1,0,7),A.addMany(j,7,0,7),A.addMany(k,7,0,7),A.add(156,7,0,0),A.add(127,7,0,7),A.add(91,1,11,3),A.addMany(e(64,127),3,7,0),A.addMany(e(48,60),3,8,4),A.addMany([60,61,62,63],3,9,4),A.addMany(e(48,60),4,8,4),A.addMany(e(64,127),4,7,0),A.addMany([60,61,62,63],4,0,6),A.addMany(e(32,64),6,0,6),A.add(127,6,0,6),A.addMany(e(64,127),6,0,0),A.addMany(e(32,48),3,9,5),A.addMany(e(32,48),5,9,5),A.addMany(e(48,64),5,0,6),A.addMany(e(64,127),5,7,0),A.addMany(e(32,48),4,9,5),A.addMany(e(32,48),1,9,2),A.addMany(e(32,48),2,9,2),A.addMany(e(48,127),2,10,0),A.addMany(e(48,80),1,10,0),A.addMany(e(81,88),1,10,0),A.addMany([89,90,92],1,10,0),A.addMany(e(96,127),1,10,0),A.add(80,1,11,9),A.addMany(k,9,0,9),A.add(127,9,0,9),A.addMany(e(28,32),9,0,9),A.addMany(e(32,48),9,9,12),A.addMany(e(48,60),9,8,10),A.addMany([60,61,62,63],9,9,10),A.addMany(k,11,0,11),A.addMany(e(32,128),11,0,11),A.addMany(e(28,32),11,0,11),A.addMany(k,10,0,10),A.add(127,10,0,10),A.addMany(e(28,32),10,0,10),A.addMany(e(48,60),10,8,10),A.addMany([60,61,62,63],10,0,11),A.addMany(e(32,48),10,9,12),A.addMany(k,12,0,12),A.add(127,12,0,12),A.addMany(e(28,32),12,0,12),A.addMany(e(32,48),12,9,12),A.addMany(e(48,64),12,0,11),A.addMany(e(64,127),12,12,13),A.addMany(e(64,127),10,12,13),A.addMany(e(64,127),9,12,13),A.addMany(k,13,13,13),A.addMany(j,13,13,13),A.add(127,13,0,13),A.addMany([27,156,24,26],13,14,0),A.add(n,0,2,0),A.add(n,8,5,8),A.add(n,6,0,6),A.add(n,11,0,11),A.add(n,13,13,13),A}();class r extends o.Disposable{constructor($=B.VT500_TRANSITION_TABLE){super(),this._transitions=$,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new p.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(e,j,k)=>{},this._executeHandlerFb=e=>{},this._csiHandlerFb=(e,j)=>{},this._escHandlerFb=e=>{},this._errorHandlerFb=e=>e,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,o.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new s.OscParser),this._dcsParser=this.register(new c.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier($,e=[64,126]){let j=0;if($.prefix){if($.prefix.length>1)throw new Error("only one byte as prefix supported");if(j=$.prefix.charCodeAt(0),j&&60>j||j>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if($.intermediates){if($.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let a=0;a<$.intermediates.length;++a){let l=$.intermediates.charCodeAt(a);if(32>l||l>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");j<<=8,j|=l}}if($.final.length!==1)throw new Error("final must be a single byte");let k=$.final.charCodeAt(0);if(e[0]>k||k>e[1])throw new Error(`final must be in range ${e[0]} .. ${e[1]}`);return j<<=8,j|=k,j}identToString($){let e=[];for(;$;)e.push(String.fromCharCode(255&$)),$>>=8;return e.reverse().join("")}setPrintHandler($){this._printHandler=$}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler($,e){let j=this._identifier($,[48,126]);this._escHandlers[j]===void 0&&(this._escHandlers[j]=[]);let k=this._escHandlers[j];return k.push(e),{dispose:()=>{let a=k.indexOf(e);a!==-1&&k.splice(a,1)}}}clearEscHandler($){this._escHandlers[this._identifier($,[48,126])]&&delete this._escHandlers[this._identifier($,[48,126])]}setEscHandlerFallback($){this._escHandlerFb=$}setExecuteHandler($,e){this._executeHandlers[$.charCodeAt(0)]=e}clearExecuteHandler($){this._executeHandlers[$.charCodeAt(0)]&&delete this._executeHandlers[$.charCodeAt(0)]}setExecuteHandlerFallback($){this._executeHandlerFb=$}registerCsiHandler($,e){let j=this._identifier($);this._csiHandlers[j]===void 0&&(this._csiHandlers[j]=[]);let k=this._csiHandlers[j];return k.push(e),{dispose:()=>{let a=k.indexOf(e);a!==-1&&k.splice(a,1)}}}clearCsiHandler($){this._csiHandlers[this._identifier($)]&&delete this._csiHandlers[this._identifier($)]}setCsiHandlerFallback($){this._csiHandlerFb=$}registerDcsHandler($,e){return this._dcsParser.registerHandler(this._identifier($),e)}clearDcsHandler($){this._dcsParser.clearHandler(this._identifier($))}setDcsHandlerFallback($){this._dcsParser.setHandlerFallback($)}registerOscHandler($,e){return this._oscParser.registerHandler($,e)}clearOscHandler($){this._oscParser.clearHandler($)}setOscHandlerFallback($){this._oscParser.setHandlerFallback($)}setErrorHandler($){this._errorHandler=$}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack($,e,j,k,a){this._parseStack.state=$,this._parseStack.handlers=e,this._parseStack.handlerPos=j,this._parseStack.transition=k,this._parseStack.chunkPos=a}parse($,e,j){let k,a=0,l=0,h=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,h=this._parseStack.chunkPos+1;else{if(j===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let i=this._parseStack.handlers,d=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(j===!1&&d>-1){for(;d>=0&&(k=i[d](this._params),k!==!0);d--)if(k instanceof Promise)return this._parseStack.handlerPos=d,k}this._parseStack.handlers=[];break;case 4:if(j===!1&&d>-1){for(;d>=0&&(k=i[d](),k!==!0);d--)if(k instanceof Promise)return this._parseStack.handlerPos=d,k}this._parseStack.handlers=[];break;case 6:if(a=$[this._parseStack.chunkPos],k=this._dcsParser.unhook(a!==24&&a!==26,j),k)return k;a===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(a=$[this._parseStack.chunkPos],k=this._oscParser.end(a!==24&&a!==26,j),k)return k;a===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,h=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let i=h;i<e;++i){switch(a=$[i],l=this._transitions.table[this.currentState<<8|(a<160?a:n)],l>>4){case 2:for(let X=i+1;;++X){if(X>=e||(a=$[X])<32||a>126&&a<n){this._printHandler($,i,X),i=X-1;break}if(++X>=e||(a=$[X])<32||a>126&&a<n){this._printHandler($,i,X),i=X-1;break}if(++X>=e||(a=$[X])<32||a>126&&a<n){this._printHandler($,i,X),i=X-1;break}if(++X>=e||(a=$[X])<32||a>126&&a<n){this._printHandler($,i,X),i=X-1;break}}break;case 3:this._executeHandlers[a]?this._executeHandlers[a]():this._executeHandlerFb(a),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:i,code:a,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let d=this._csiHandlers[this._collect<<8|a],v=d?d.length-1:-1;for(;v>=0&&(k=d[v](this._params),k!==!0);v--)if(k instanceof Promise)return this._preserveStack(3,d,v,l,i),k;v<0&&this._csiHandlerFb(this._collect<<8|a,this._params),this.precedingCodepoint=0;break;case 8:do switch(a){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(a-48)}while(++i<e&&(a=$[i])>47&&a<60);i--;break;case 9:this._collect<<=8,this._collect|=a;break;case 10:let E=this._escHandlers[this._collect<<8|a],m=E?E.length-1:-1;for(;m>=0&&(k=E[m](),k!==!0);m--)if(k instanceof Promise)return this._preserveStack(4,E,m,l,i),k;m<0&&this._escHandlerFb(this._collect<<8|a),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|a,this._params);break;case 13:for(let X=i+1;;++X)if(X>=e||(a=$[X])===24||a===26||a===27||a>127&&a<n){this._dcsParser.put($,i,X),i=X-1;break}break;case 14:if(k=this._dcsParser.unhook(a!==24&&a!==26),k)return this._preserveStack(6,[],0,l,i),k;a===27&&(l|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let X=i+1;;X++)if(X>=e||(a=$[X])<32||a>127&&a<n){this._oscParser.put($,i,X),i=X-1;break}break;case 6:if(k=this._oscParser.end(a!==24&&a!==26),k)return this._preserveStack(5,[],0,l,i),k;a===27&&(l|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&l}}}B.EscapeSequenceParser=r},6242:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.OscHandler=B.OscParser=void 0;let o=t(5770),p=t(482),s=[];B.OscParser=class{constructor(){this._state=0,this._active=s,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(c,P){this._handlers[c]===void 0&&(this._handlers[c]=[]);let n=this._handlers[c];return n.push(P),{dispose:()=>{let r=n.indexOf(P);r!==-1&&n.splice(r,1)}}}clearHandler(c){this._handlers[c]&&delete this._handlers[c]}setHandlerFallback(c){this._handlerFb=c}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=s}reset(){if(this._state===2)for(let c=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;c>=0;--c)this._active[c].end(!1);this._stack.paused=!1,this._active=s,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||s,this._active.length)for(let c=this._active.length-1;c>=0;c--)this._active[c].start();else this._handlerFb(this._id,"START")}_put(c,P,n){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(c,P,n);else this._handlerFb(this._id,"PUT",(0,p.utf32ToString)(c,P,n))}start(){this.reset(),this._state=1}put(c,P,n){if(this._state!==3){if(this._state===1)for(;P<n;){let r=c[P++];if(r===59){this._state=2,this._start();break}if(r<48||57<r)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+r-48}this._state===2&&n-P>0&&this._put(c,P,n)}}end(c,P=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let n=!1,r=this._active.length-1,A=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,n=P,A=this._stack.fallThrough,this._stack.paused=!1),!A&&n===!1){for(;r>=0&&(n=this._active[r].end(c),n!==!0);r--)if(n instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,n;r--}for(;r>=0;r--)if(n=this._active[r].end(!1),n instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,n}else this._handlerFb(this._id,"END",c);this._active=s,this._id=-1,this._state=0}}},B.OscHandler=class{constructor(c){this._handler=c,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(c,P,n){this._hitLimit||(this._data+=(0,p.utf32ToString)(c,P,n),this._data.length>o.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(c){let P=!1;if(this._hitLimit)P=!1;else if(c&&(P=this._handler(this._data),P instanceof Promise))return P.then(n=>(this._data="",this._hitLimit=!1,n));return this._data="",this._hitLimit=!1,P}}},8742:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.Params=void 0;let t=2147483647;class o{constructor(s=32,c=32){if(this.maxLength=s,this.maxSubParamsLength=c,c>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(s),this.length=0,this._subParams=new Int32Array(c),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(s),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(s){let c=new o;if(!s.length)return c;for(let P=Array.isArray(s[0])?1:0;P<s.length;++P){let n=s[P];if(Array.isArray(n))for(let r=0;r<n.length;++r)c.addSubParam(n[r]);else c.addParam(n)}return c}clone(){let s=new o(this.maxLength,this.maxSubParamsLength);return s.params.set(this.params),s.length=this.length,s._subParams.set(this._subParams),s._subParamsLength=this._subParamsLength,s._subParamsIdx.set(this._subParamsIdx),s._rejectDigits=this._rejectDigits,s._rejectSubDigits=this._rejectSubDigits,s._digitIsSub=this._digitIsSub,s}toArray(){let s=[];for(let c=0;c<this.length;++c){s.push(this.params[c]);let P=this._subParamsIdx[c]>>8,n=255&this._subParamsIdx[c];n-P>0&&s.push(Array.prototype.slice.call(this._subParams,P,n))}return s}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(s){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(s<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=s>t?t:s}}addSubParam(s){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(s<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=s>t?t:s,this._subParamsIdx[this.length-1]++}}hasSubParams(s){return(255&this._subParamsIdx[s])-(this._subParamsIdx[s]>>8)>0}getSubParams(s){let c=this._subParamsIdx[s]>>8,P=255&this._subParamsIdx[s];return P-c>0?this._subParams.subarray(c,P):null}getSubParamsAll(){let s={};for(let c=0;c<this.length;++c){let P=this._subParamsIdx[c]>>8,n=255&this._subParamsIdx[c];n-P>0&&(s[c]=this._subParams.slice(P,n))}return s}addDigit(s){let c;if(this._rejectDigits||!(c=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let P=this._digitIsSub?this._subParams:this.params,n=P[c-1];P[c-1]=~n?Math.min(10*n+s,t):s}}B.Params=o},5741:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.AddonManager=void 0,B.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let t=this._addons.length-1;t>=0;t--)this._addons[t].instance.dispose()}loadAddon(t,o){let p={instance:o,dispose:o.dispose,isDisposed:!1};this._addons.push(p),o.dispose=()=>this._wrappedAddonDispose(p),o.activate(t)}_wrappedAddonDispose(t){if(t.isDisposed)return;let o=-1;for(let p=0;p<this._addons.length;p++)if(this._addons[p]===t){o=p;break}if(o===-1)throw new Error("Could not dispose an addon that has not been loaded");t.isDisposed=!0,t.dispose.apply(t.instance),this._addons.splice(o,1)}}},8771:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.BufferApiView=void 0;let o=t(3785),p=t(511);B.BufferApiView=class{constructor(s,c){this._buffer=s,this.type=c}init(s){return this._buffer=s,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(s){let c=this._buffer.lines.get(s);if(c)return new o.BufferLineApiView(c)}getNullCell(){return new p.CellData}}},3785:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.BufferLineApiView=void 0;let o=t(511);B.BufferLineApiView=class{constructor(p){this._line=p}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(p,s){if(!(p<0||p>=this._line.length))return s?(this._line.loadCell(p,s),s):this._line.loadCell(p,new o.CellData)}translateToString(p,s,c){return this._line.translateToString(p,s,c)}}},8285:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.BufferNamespaceApi=void 0;let o=t(8771),p=t(8460);B.BufferNamespaceApi=class{constructor(s){this._core=s,this._onBufferChange=new p.EventEmitter,this.onBufferChange=this._onBufferChange.event,this._normal=new o.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new o.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}},7975:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.ParserApi=void 0,B.ParserApi=class{constructor(t){this._core=t}registerCsiHandler(t,o){return this._core.registerCsiHandler(t,p=>o(p.toArray()))}addCsiHandler(t,o){return this.registerCsiHandler(t,o)}registerDcsHandler(t,o){return this._core.registerDcsHandler(t,(p,s)=>o(p,s.toArray()))}addDcsHandler(t,o){return this.registerDcsHandler(t,o)}registerEscHandler(t,o){return this._core.registerEscHandler(t,o)}addEscHandler(t,o){return this.registerEscHandler(t,o)}registerOscHandler(t,o){return this._core.registerOscHandler(t,o)}addOscHandler(t,o){return this.registerOscHandler(t,o)}}},7090:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.UnicodeApi=void 0,B.UnicodeApi=class{constructor(t){this._core=t}register(t){this._core.unicodeService.register(t)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(t){this._core.unicodeService.activeVersion=t}}},744:function(C,B,t){var o=this&&this.__decorate||function(A,$,e,j){var k,a=arguments.length,l=a<3?$:j===null?j=Object.getOwnPropertyDescriptor($,e):j;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(A,$,e,j);else for(var h=A.length-1;h>=0;h--)(k=A[h])&&(l=(a<3?k(l):a>3?k($,e,l):k($,e))||l);return a>3&&l&&Object.defineProperty($,e,l),l},p=this&&this.__param||function(A,$){return function(e,j){$(e,j,A)}};Object.defineProperty(B,"__esModule",{value:!0}),B.BufferService=B.MINIMUM_ROWS=B.MINIMUM_COLS=void 0;let s=t(2585),c=t(5295),P=t(8460),n=t(844);B.MINIMUM_COLS=2,B.MINIMUM_ROWS=1;let r=class extends n.Disposable{constructor(A){super(),this.isUserScrolling=!1,this._onResize=this.register(new P.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new P.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(A.rawOptions.cols||0,B.MINIMUM_COLS),this.rows=Math.max(A.rawOptions.rows||0,B.MINIMUM_ROWS),this.buffers=this.register(new c.BufferSet(A,this))}get buffer(){return this.buffers.active}resize(A,$){this.cols=A,this.rows=$,this.buffers.resize(A,$),this._onResize.fire({cols:A,rows:$})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(A,$=!1){let e=this.buffer,j;j=this._cachedBlankLine,j&&j.length===this.cols&&j.getFg(0)===A.fg&&j.getBg(0)===A.bg||(j=e.getBlankLine(A,$),this._cachedBlankLine=j),j.isWrapped=$;let k=e.ybase+e.scrollTop,a=e.ybase+e.scrollBottom;if(e.scrollTop===0){let l=e.lines.isFull;a===e.lines.length-1?l?e.lines.recycle().copyFrom(j):e.lines.push(j.clone()):e.lines.splice(a+1,0,j.clone()),l?this.isUserScrolling&&(e.ydisp=Math.max(e.ydisp-1,0)):(e.ybase++,this.isUserScrolling||e.ydisp++)}else{let l=a-k+1;e.lines.shiftElements(k+1,l-1,-1),e.lines.set(a,j.clone())}this.isUserScrolling||(e.ydisp=e.ybase),this._onScroll.fire(e.ydisp)}scrollLines(A,$,e){let j=this.buffer;if(A<0){if(j.ydisp===0)return;this.isUserScrolling=!0}else A+j.ydisp>=j.ybase&&(this.isUserScrolling=!1);let k=j.ydisp;j.ydisp=Math.max(Math.min(j.ydisp+A,j.ybase),0),k!==j.ydisp&&($||this._onScroll.fire(j.ydisp))}scrollPages(A){this.scrollLines(A*(this.rows-1))}scrollToTop(){this.scrollLines(-this.buffer.ydisp)}scrollToBottom(){this.scrollLines(this.buffer.ybase-this.buffer.ydisp)}scrollToLine(A){let $=A-this.buffer.ydisp;$!==0&&this.scrollLines($)}};r=o([p(0,s.IOptionsService)],r),B.BufferService=r},7994:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.CharsetService=void 0,B.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(t){this.glevel=t,this.charset=this._charsets[t]}setgCharset(t,o){this._charsets[t]=o,this.glevel===t&&(this.charset=o)}}},1753:function(C,B,t){var o=this&&this.__decorate||function(j,k,a,l){var h,i=arguments.length,d=i<3?k:l===null?l=Object.getOwnPropertyDescriptor(k,a):l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(j,k,a,l);else for(var v=j.length-1;v>=0;v--)(h=j[v])&&(d=(i<3?h(d):i>3?h(k,a,d):h(k,a))||d);return i>3&&d&&Object.defineProperty(k,a,d),d},p=this&&this.__param||function(j,k){return function(a,l){k(a,l,j)}};Object.defineProperty(B,"__esModule",{value:!0}),B.CoreMouseService=void 0;let s=t(2585),c=t(8460),P=t(844),n={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:j=>j.button!==4&&j.action===1&&(j.ctrl=!1,j.alt=!1,j.shift=!1,!0)},VT200:{events:19,restrict:j=>j.action!==32},DRAG:{events:23,restrict:j=>j.action!==32||j.button!==3},ANY:{events:31,restrict:j=>!0}};function r(j,k){let a=(j.ctrl?16:0)|(j.shift?4:0)|(j.alt?8:0);return j.button===4?(a|=64,a|=j.action):(a|=3&j.button,4&j.button&&(a|=64),8&j.button&&(a|=128),j.action===32?a|=32:j.action!==0||k||(a|=3)),a}let A=String.fromCharCode,$={DEFAULT:j=>{let k=[r(j,!1)+32,j.col+32,j.row+32];return k[0]>255||k[1]>255||k[2]>255?"":`\x1B[M${A(k[0])}${A(k[1])}${A(k[2])}`},SGR:j=>{let k=j.action===0&&j.button!==4?"m":"M";return`\x1B[<${r(j,!0)};${j.col};${j.row}${k}`},SGR_PIXELS:j=>{let k=j.action===0&&j.button!==4?"m":"M";return`\x1B[<${r(j,!0)};${j.x};${j.y}${k}`}},e=class extends P.Disposable{constructor(j,k){super(),this._bufferService=j,this._coreService=k,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new c.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let a of Object.keys(n))this.addProtocol(a,n[a]);for(let a of Object.keys($))this.addEncoding(a,$[a]);this.reset()}addProtocol(j,k){this._protocols[j]=k}addEncoding(j,k){this._encodings[j]=k}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(j){if(!this._protocols[j])throw new Error(`unknown protocol "${j}"`);this._activeProtocol=j,this._onProtocolChange.fire(this._protocols[j].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(j){if(!this._encodings[j])throw new Error(`unknown encoding "${j}"`);this._activeEncoding=j}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(j){if(j.col<0||j.col>=this._bufferService.cols||j.row<0||j.row>=this._bufferService.rows||j.button===4&&j.action===32||j.button===3&&j.action!==32||j.button!==4&&(j.action===2||j.action===3)||(j.col++,j.row++,j.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,j,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(j))return!1;let k=this._encodings[this._activeEncoding](j);return k&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(k):this._coreService.triggerDataEvent(k,!0)),this._lastEvent=j,!0}explainEvents(j){return{down:!!(1&j),up:!!(2&j),drag:!!(4&j),move:!!(8&j),wheel:!!(16&j)}}_equalEvents(j,k,a){if(a){if(j.x!==k.x||j.y!==k.y)return!1}else if(j.col!==k.col||j.row!==k.row)return!1;return j.button===k.button&&j.action===k.action&&j.ctrl===k.ctrl&&j.alt===k.alt&&j.shift===k.shift}};e=o([p(0,s.IBufferService),p(1,s.ICoreService)],e),B.CoreMouseService=e},6975:function(C,B,t){var o=this&&this.__decorate||function(e,j,k,a){var l,h=arguments.length,i=h<3?j:a===null?a=Object.getOwnPropertyDescriptor(j,k):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,j,k,a);else for(var d=e.length-1;d>=0;d--)(l=e[d])&&(i=(h<3?l(i):h>3?l(j,k,i):l(j,k))||i);return h>3&&i&&Object.defineProperty(j,k,i),i},p=this&&this.__param||function(e,j){return function(k,a){j(k,a,e)}};Object.defineProperty(B,"__esModule",{value:!0}),B.CoreService=void 0;let s=t(2585),c=t(8460),P=t(1439),n=t(844),r=Object.freeze({insertMode:!1}),A=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),$=class extends n.Disposable{constructor(e,j,k){super(),this._bufferService=e,this._logService=j,this._optionsService=k,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new c.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new c.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new c.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new c.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,P.clone)(r),this.decPrivateModes=(0,P.clone)(A)}reset(){this.modes=(0,P.clone)(r),this.decPrivateModes=(0,P.clone)(A)}triggerDataEvent(e,j=!1){if(this._optionsService.rawOptions.disableStdin)return;let k=this._bufferService.buffer;j&&this._optionsService.rawOptions.scrollOnUserInput&&k.ybase!==k.ydisp&&this._onRequestScrollToBottom.fire(),j&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`,()=>e.split("").map(a=>a.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`,()=>e.split("").map(j=>j.charCodeAt(0))),this._onBinary.fire(e))}};$=o([p(0,s.IBufferService),p(1,s.ILogService),p(2,s.IOptionsService)],$),B.CoreService=$},9074:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.DecorationService=void 0;let o=t(8055),p=t(8460),s=t(844),c=t(6106),P=0,n=0;class r extends s.Disposable{constructor(){super(),this._decorations=new c.SortedList(e=>e==null?void 0:e.marker.line),this._onDecorationRegistered=this.register(new p.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new p.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,s.toDisposable)(()=>{for(let e of this._decorations.values())this._onDecorationRemoved.fire(e);this.reset()}))}get decorations(){return this._decorations.values()}registerDecoration(e){if(e.marker.isDisposed)return;let j=new A(e);if(j){let k=j.marker.onDispose(()=>j.dispose());j.onDispose(()=>{j&&(this._decorations.delete(j)&&this._onDecorationRemoved.fire(j),k.dispose())}),this._decorations.insert(j),this._onDecorationRegistered.fire(j)}return j}reset(){for(let e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,j,k){var a,l,h;let i=0,d=0;for(let v of this._decorations.getKeyIterator(j))i=(a=v.options.x)!==null&&a!==void 0?a:0,d=i+((l=v.options.width)!==null&&l!==void 0?l:1),e>=i&&e<d&&(!k||((h=v.options.layer)!==null&&h!==void 0?h:"bottom")===k)&&(yield v)}forEachDecorationAtCell(e,j,k,a){this._decorations.forEachByKey(j,l=>{var h,i,d;P=(h=l.options.x)!==null&&h!==void 0?h:0,n=P+((i=l.options.width)!==null&&i!==void 0?i:1),e>=P&&e<n&&(!k||((d=l.options.layer)!==null&&d!==void 0?d:"bottom")===k)&&a(l)})}dispose(){for(let e of this._decorations.values())this._onDecorationRemoved.fire(e);this.reset()}}B.DecorationService=r;class A extends s.Disposable{constructor(e){super(),this.options=e,this.isDisposed=!1,this.onRenderEmitter=this.register(new p.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new p.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=o.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=o.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.InstantiationService=B.ServiceCollection=void 0;let o=t(2585),p=t(8343);class s{constructor(...P){this._entries=new Map;for(let[n,r]of P)this.set(n,r)}set(P,n){let r=this._entries.get(P);return this._entries.set(P,n),r}forEach(P){for(let[n,r]of this._entries.entries())P(n,r)}has(P){return this._entries.has(P)}get(P){return this._entries.get(P)}}B.ServiceCollection=s,B.InstantiationService=class{constructor(){this._services=new s,this._services.set(o.IInstantiationService,this)}setService(c,P){this._services.set(c,P)}getService(c){return this._services.get(c)}createInstance(c,...P){let n=(0,p.getServiceDependencies)(c).sort(($,e)=>$.index-e.index),r=[];for(let $ of n){let e=this._services.get($.id);if(!e)throw new Error(`[createInstance] ${c.name} depends on UNKNOWN service ${$.id}.`);r.push(e)}let A=n.length>0?n[0].index:P.length;if(P.length!==A)throw new Error(`[createInstance] First service dependency of ${c.name} at position ${A+1} conflicts with ${P.length} static arguments`);return new c(...P,...r)}}},7866:function(C,B,t){var o=this&&this.__decorate||function(r,A,$,e){var j,k=arguments.length,a=k<3?A:e===null?e=Object.getOwnPropertyDescriptor(A,$):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,A,$,e);else for(var l=r.length-1;l>=0;l--)(j=r[l])&&(a=(k<3?j(a):k>3?j(A,$,a):j(A,$))||a);return k>3&&a&&Object.defineProperty(A,$,a),a},p=this&&this.__param||function(r,A){return function($,e){A($,e,r)}};Object.defineProperty(B,"__esModule",{value:!0}),B.LogService=void 0;let s=t(844),c=t(2585),P={debug:c.LogLevelEnum.DEBUG,info:c.LogLevelEnum.INFO,warn:c.LogLevelEnum.WARN,error:c.LogLevelEnum.ERROR,off:c.LogLevelEnum.OFF},n=class extends s.Disposable{constructor(r){super(),this._optionsService=r,this.logLevel=c.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel()))}_updateLogLevel(){this.logLevel=P[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(r){for(let A=0;A<r.length;A++)typeof r[A]=="function"&&(r[A]=r[A]())}_log(r,A,$){this._evalLazyOptionalParams($),r.call(console,"xterm.js: "+A,...$)}debug(r,...A){this.logLevel<=c.LogLevelEnum.DEBUG&&this._log(console.log,r,A)}info(r,...A){this.logLevel<=c.LogLevelEnum.INFO&&this._log(console.info,r,A)}warn(r,...A){this.logLevel<=c.LogLevelEnum.WARN&&this._log(console.warn,r,A)}error(r,...A){this.logLevel<=c.LogLevelEnum.ERROR&&this._log(console.error,r,A)}};n=o([p(0,c.IOptionsService)],n),B.LogService=n},7302:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.OptionsService=B.DEFAULT_OPTIONS=void 0;let o=t(8460),p=t(6114),s=t(844);B.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:p.isMac,windowOptions:{},windowsMode:!1,wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};let c=["normal","bold","100","200","300","400","500","600","700","800","900"];class P extends s.Disposable{constructor(r){super(),this._onOptionChange=this.register(new o.EventEmitter),this.onOptionChange=this._onOptionChange.event;let A=Object.assign({},B.DEFAULT_OPTIONS);for(let $ in r)if($ in A)try{let e=r[$];A[$]=this._sanitizeAndValidateOption($,e)}catch(e){console.error(e)}this.rawOptions=A,this.options=Object.assign({},A),this._setupOptions()}onSpecificOptionChange(r,A){return this.onOptionChange($=>{$===r&&A(this.rawOptions[r])})}onMultipleOptionChange(r,A){return this.onOptionChange($=>{r.indexOf($)!==-1&&A()})}_setupOptions(){let r=$=>{if(!($ in B.DEFAULT_OPTIONS))throw new Error(`No option with key "${$}"`);return this.rawOptions[$]},A=($,e)=>{if(!($ in B.DEFAULT_OPTIONS))throw new Error(`No option with key "${$}"`);e=this._sanitizeAndValidateOption($,e),this.rawOptions[$]!==e&&(this.rawOptions[$]=e,this._onOptionChange.fire($))};for(let $ in this.rawOptions){let e={get:r.bind(this,$),set:A.bind(this,$)};Object.defineProperty(this.options,$,e)}}_sanitizeAndValidateOption(r,A){switch(r){case"cursorStyle":if(A||(A=B.DEFAULT_OPTIONS[r]),!function($){return $==="block"||$==="underline"||$==="bar"}(A))throw new Error(`"${A}" is not a valid value for ${r}`);break;case"wordSeparator":A||(A=B.DEFAULT_OPTIONS[r]);break;case"fontWeight":case"fontWeightBold":if(typeof A=="number"&&1<=A&&A<=1e3)break;A=c.includes(A)?A:B.DEFAULT_OPTIONS[r];break;case"cursorWidth":A=Math.floor(A);case"lineHeight":case"tabStopWidth":if(A<1)throw new Error(`${r} cannot be less than 1, value: ${A}`);break;case"minimumContrastRatio":A=Math.max(1,Math.min(21,Math.round(10*A)/10));break;case"scrollback":if((A=Math.min(A,4294967295))<0)throw new Error(`${r} cannot be less than 0, value: ${A}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(A<=0)throw new Error(`${r} cannot be less than or equal to 0, value: ${A}`);case"rows":case"cols":if(!A&&A!==0)throw new Error(`${r} must be numeric, value: ${A}`)}return A}}B.OptionsService=P},2660:function(C,B,t){var o=this&&this.__decorate||function(P,n,r,A){var $,e=arguments.length,j=e<3?n:A===null?A=Object.getOwnPropertyDescriptor(n,r):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate(P,n,r,A);else for(var k=P.length-1;k>=0;k--)($=P[k])&&(j=(e<3?$(j):e>3?$(n,r,j):$(n,r))||j);return e>3&&j&&Object.defineProperty(n,r,j),j},p=this&&this.__param||function(P,n){return function(r,A){n(r,A,P)}};Object.defineProperty(B,"__esModule",{value:!0}),B.OscLinkService=void 0;let s=t(2585),c=class{constructor(P){this._bufferService=P,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(P){let n=this._bufferService.buffer;if(P.id===void 0){let k=n.addMarker(n.ybase+n.y),a={data:P,id:this._nextId++,lines:[k]};return k.onDispose(()=>this._removeMarkerFromLink(a,k)),this._dataByLinkId.set(a.id,a),a.id}let r=P,A=this._getEntryIdKey(r),$=this._entriesWithId.get(A);if($)return this.addLineToLink($.id,n.ybase+n.y),$.id;let e=n.addMarker(n.ybase+n.y),j={id:this._nextId++,key:this._getEntryIdKey(r),data:r,lines:[e]};return e.onDispose(()=>this._removeMarkerFromLink(j,e)),this._entriesWithId.set(j.key,j),this._dataByLinkId.set(j.id,j),j.id}addLineToLink(P,n){let r=this._dataByLinkId.get(P);if(r&&r.lines.every(A=>A.line!==n)){let A=this._bufferService.buffer.addMarker(n);r.lines.push(A),A.onDispose(()=>this._removeMarkerFromLink(r,A))}}getLinkData(P){var n;return(n=this._dataByLinkId.get(P))===null||n===void 0?void 0:n.data}_getEntryIdKey(P){return`${P.id};;${P.uri}`}_removeMarkerFromLink(P,n){let r=P.lines.indexOf(n);r!==-1&&(P.lines.splice(r,1),P.lines.length===0&&(P.data.id!==void 0&&this._entriesWithId.delete(P.key),this._dataByLinkId.delete(P.id)))}};c=o([p(0,s.IBufferService)],c),B.OscLinkService=c},8343:(C,B)=>{function t(o,p,s){p.di$target===p?p.di$dependencies.push({id:o,index:s}):(p.di$dependencies=[{id:o,index:s}],p.di$target=p)}Object.defineProperty(B,"__esModule",{value:!0}),B.createDecorator=B.getServiceDependencies=B.serviceRegistry=void 0,B.serviceRegistry=new Map,B.getServiceDependencies=function(o){return o.di$dependencies||[]},B.createDecorator=function(o){if(B.serviceRegistry.has(o))return B.serviceRegistry.get(o);let p=function(s,c,P){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");t(p,s,P)};return p.toString=()=>o,B.serviceRegistry.set(o,p),p}},2585:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.IDecorationService=B.IUnicodeService=B.IOscLinkService=B.IOptionsService=B.ILogService=B.LogLevelEnum=B.IInstantiationService=B.ICharsetService=B.ICoreService=B.ICoreMouseService=B.IBufferService=void 0;let o=t(8343);var p;B.IBufferService=(0,o.createDecorator)("BufferService"),B.ICoreMouseService=(0,o.createDecorator)("CoreMouseService"),B.ICoreService=(0,o.createDecorator)("CoreService"),B.ICharsetService=(0,o.createDecorator)("CharsetService"),B.IInstantiationService=(0,o.createDecorator)("InstantiationService"),(p=B.LogLevelEnum||(B.LogLevelEnum={}))[p.DEBUG=0]="DEBUG",p[p.INFO=1]="INFO",p[p.WARN=2]="WARN",p[p.ERROR=3]="ERROR",p[p.OFF=4]="OFF",B.ILogService=(0,o.createDecorator)("LogService"),B.IOptionsService=(0,o.createDecorator)("OptionsService"),B.IOscLinkService=(0,o.createDecorator)("OscLinkService"),B.IUnicodeService=(0,o.createDecorator)("UnicodeService"),B.IDecorationService=(0,o.createDecorator)("DecorationService")},1480:(C,B,t)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.UnicodeService=void 0;let o=t(8460),p=t(225);B.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new o.EventEmitter,this.onChange=this._onChange.event;let s=new p.UnicodeV6;this.register(s),this._active=s.version,this._activeProvider=s}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(s){if(!this._providers[s])throw new Error(`unknown Unicode version "${s}"`);this._active=s,this._activeProvider=this._providers[s],this._onChange.fire(s)}register(s){this._providers[s.version]=s}wcwidth(s){return this._activeProvider.wcwidth(s)}getStringCellWidth(s){let c=0,P=s.length;for(let n=0;n<P;++n){let r=s.charCodeAt(n);if(55296<=r&&r<=56319){if(++n>=P)return c+this.wcwidth(r);let A=s.charCodeAt(n);56320<=A&&A<=57343?r=1024*(r-55296)+A-56320+65536:c+=this.wcwidth(A)}c+=this.wcwidth(r)}return c}}}},F={};function U(C){var B=F[C];if(B!==void 0)return B.exports;var t=F[C]={exports:{}};return I[C].call(t.exports,t,t.exports,U),t.exports}var W={};return(()=>{var C=W;Object.defineProperty(C,"__esModule",{value:!0}),C.Terminal=void 0;let B=U(3236),t=U(9042),o=U(7975),p=U(7090),s=U(5741),c=U(8285),P=["cols","rows"];C.Terminal=class{constructor(n){this._core=new B.Terminal(n),this._addonManager=new s.AddonManager,this._publicOptions=Object.assign({},this._core.options);let r=$=>this._core.options[$],A=($,e)=>{this._checkReadonlyOptions($),this._core.options[$]=e};for(let $ in this._core.options){let e={get:r.bind(this,$),set:A.bind(this,$)};Object.defineProperty(this._publicOptions,$,e)}}_checkReadonlyOptions(n){if(P.includes(n))throw new Error(`Option "${n}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new o.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new p.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=new c.BufferNamespaceApi(this._core)),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let n=this._core.coreService.decPrivateModes,r="none";switch(this._core.coreMouseService.activeProtocol){case"X10":r="x10";break;case"VT200":r="vt200";break;case"DRAG":r="drag";break;case"ANY":r="any"}return{applicationCursorKeysMode:n.applicationCursorKeys,applicationKeypadMode:n.applicationKeypad,bracketedPasteMode:n.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:r,originMode:n.origin,reverseWraparoundMode:n.reverseWraparound,sendFocusMode:n.sendFocus,wraparoundMode:n.wraparound}}get options(){return this._publicOptions}set options(n){for(let r in n)this._publicOptions[r]=n[r]}blur(){this._core.blur()}focus(){this._core.focus()}resize(n,r){this._verifyIntegers(n,r),this._core.resize(n,r)}open(n){this._core.open(n)}attachCustomKeyEventHandler(n){this._core.attachCustomKeyEventHandler(n)}registerLinkProvider(n){return this._core.registerLinkProvider(n)}registerCharacterJoiner(n){return this._checkProposedApi(),this._core.registerCharacterJoiner(n)}deregisterCharacterJoiner(n){this._checkProposedApi(),this._core.deregisterCharacterJoiner(n)}registerMarker(n=0){return this._verifyIntegers(n),this._core.addMarker(n)}registerDecoration(n){var r,A,$;return this._checkProposedApi(),this._verifyPositiveIntegers((r=n.x)!==null&&r!==void 0?r:0,(A=n.width)!==null&&A!==void 0?A:0,($=n.height)!==null&&$!==void 0?$:0),this._core.registerDecoration(n)}hasSelection(){return this._core.hasSelection()}select(n,r,A){this._verifyIntegers(n,r,A),this._core.select(n,r,A)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(n,r){this._verifyIntegers(n,r),this._core.selectLines(n,r)}dispose(){this._addonManager.dispose(),this._core.dispose()}scrollLines(n){this._verifyIntegers(n),this._core.scrollLines(n)}scrollPages(n){this._verifyIntegers(n),this._core.scrollPages(n)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(n){this._verifyIntegers(n),this._core.scrollToLine(n)}clear(){this._core.clear()}write(n,r){this._core.write(n,r)}writeln(n,r){this._core.write(n),this._core.write(`\r
`,r)}paste(n){this._core.paste(n)}refresh(n,r){this._verifyIntegers(n,r),this._core.refresh(n,r)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(n){return this._addonManager.loadAddon(this,n)}static get strings(){return t}_verifyIntegers(...n){for(let r of n)if(r===1/0||isNaN(r)||r%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...n){for(let r of n)if(r&&(r===1/0||isNaN(r)||r%1!=0||r<0))throw new Error("This API only accepts positive integers")}}})(),W})()})});var aA=BA((J,kA)=>{(function(I,F){typeof J=="object"&&typeof kA=="object"?kA.exports=F():typeof define=="function"&&define.amd?define([],F):typeof J=="object"?J.FitAddon=F():I.FitAddon=F()})(self,function(){return(()=>{"use strict";var I={};return(()=>{var F=I;Object.defineProperty(F,"__esModule",{value:!0}),F.FitAddon=void 0,F.FitAddon=class{constructor(){}activate(U){this._terminal=U}dispose(){}fit(){let U=this.proposeDimensions();if(!U||!this._terminal||isNaN(U.cols)||isNaN(U.rows))return;let W=this._terminal._core;this._terminal.rows===U.rows&&this._terminal.cols===U.cols||(W._renderService.clear(),this._terminal.resize(U.cols,U.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let U=this._terminal._core,W=U._renderService.dimensions;if(W.css.cell.width===0||W.css.cell.height===0)return;let C=this._terminal.options.scrollback===0?0:U.viewport.scrollBarWidth,B=window.getComputedStyle(this._terminal.element.parentElement),t=parseInt(B.getPropertyValue("height")),o=Math.max(0,parseInt(B.getPropertyValue("width"))),p=window.getComputedStyle(this._terminal.element),s=t-(parseInt(p.getPropertyValue("padding-top"))+parseInt(p.getPropertyValue("padding-bottom"))),c=o-(parseInt(p.getPropertyValue("padding-right"))+parseInt(p.getPropertyValue("padding-left")))-C;return{cols:Math.max(2,Math.floor(c/W.css.cell.width)),rows:Math.max(1,Math.floor(s/W.css.cell.height))}}}})(),I})()})});var cA=BA((z,eA)=>{(function(I,F){typeof z=="object"&&typeof eA=="object"?eA.exports=F():typeof define=="function"&&define.amd?define([],F):typeof z=="object"?z.WebLinksAddon=F():I.WebLinksAddon=F()})(self,function(){return(()=>{"use strict";var I={6:(C,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.LinkComputer=B.WebLinkProvider=void 0,B.WebLinkProvider=class{constructor(o,p,s,c={}){this._terminal=o,this._regex=p,this._handler=s,this._options=c}provideLinks(o,p){let s=t.computeLink(o,this._regex,this._terminal,this._handler);p(this._addCallbacks(s))}_addCallbacks(o){return o.map(p=>(p.leave=this._options.leave,p.hover=(s,c)=>{if(this._options.hover){let{range:P}=p;this._options.hover(s,c,P)}},p))}};class t{static computeLink(p,s,c,P){let n=new RegExp(s.source,(s.flags||"")+"g"),[r,A]=t._getWindowedLineStrings(p-1,c),$=r.join(""),e,j=[];for(;e=n.exec($);){let k=e[0];try{let v=new URL(k),E=decodeURI(v.toString());if(k!==E&&k+"/"!==E)continue}catch(v){continue}let[a,l]=t._mapStrIdx(c,A,0,e.index),[h,i]=t._mapStrIdx(c,a,l,k.length);if(a===-1||l===-1||h===-1||i===-1)continue;let d={start:{x:l+1,y:a+1},end:{x:i,y:h+1}};j.push({range:d,text:k,activate:P})}return j}static _getWindowedLineStrings(p,s){let c,P=p,n=p,r=0,A="",$=[];if(c=s.buffer.active.getLine(p)){let e=c.translateToString(!0);if(c.isWrapped&&e[0]!==" "){for(r=0;(c=s.buffer.active.getLine(--P))&&r<2048&&(A=c.translateToString(!0),r+=A.length,$.push(A),c.isWrapped&&A.indexOf(" ")===-1););$.reverse()}for($.push(e),r=0;(c=s.buffer.active.getLine(++n))&&c.isWrapped&&r<2048&&(A=c.translateToString(!0),r+=A.length,$.push(A),A.indexOf(" ")===-1););}return[$,P]}static _mapStrIdx(p,s,c,P){let n=p.buffer.active,r=n.getNullCell(),A=c;for(;P;){let $=n.getLine(s);if(!$)return[-1,-1];for(let e=A;e<$.length;++e){$.getCell(e,r);let j=r.getChars();if(r.getWidth()&&(P-=j.length||1,e===$.length-1&&j==="")){let k=n.getLine(s+1);k&&k.isWrapped&&(k.getCell(0,r),r.getWidth()===2&&(P+=1))}if(P<0)return[s,e]}s++,A=0}return[s,A]}}B.LinkComputer=t}},F={};function U(C){var B=F[C];if(B!==void 0)return B.exports;var t=F[C]={exports:{}};return I[C](t,t.exports,U),t.exports}var W={};return(()=>{var C=W;Object.defineProperty(C,"__esModule",{value:!0}),C.WebLinksAddon=void 0;let B=U(6),t=/https?:[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function o(p,s){let c=window.open();if(c){try{c.opener=null}catch(P){}c.location.href=s}else console.warn("Opening link blocked as opener could not be cleared")}C.WebLinksAddon=class{constructor(p=o,s={}){this._handler=p,this._options=s}activate(p){this._terminal=p;let s=this._options,c=s.urlRegex||t;this._linkProvider=this._terminal.registerLinkProvider(new B.WebLinkProvider(this._terminal,c,this._handler,s))}dispose(){var p;(p=this._linkProvider)===null||p===void 0||p.dispose()}}})(),W})()})});(()=>{let I=()=>{let W=new Error("not implemented");return W.code="ENOSYS",W};if(!globalThis.fs){let W="";globalThis.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},writeSync(C,B){W+=U.decode(B);let t=W.lastIndexOf(`
`);return t!=-1&&(console.log(W.substring(0,t)),W=W.substring(t+1)),B.length},write(C,B,t,o,p,s){if(t!==0||o!==B.length||p!==null){s(I());return}let c=this.writeSync(C,B);s(null,c)},chmod(C,B,t){t(I())},chown(C,B,t,o){o(I())},close(C,B){B(I())},fchmod(C,B,t){t(I())},fchown(C,B,t,o){o(I())},fstat(C,B){B(I())},fsync(C,B){B(null)},ftruncate(C,B,t){t(I())},lchown(C,B,t,o){o(I())},link(C,B,t){t(I())},lstat(C,B){B(I())},mkdir(C,B,t){t(I())},open(C,B,t,o){o(I())},read(C,B,t,o,p,s){s(I())},readdir(C,B){B(I())},readlink(C,B){B(I())},rename(C,B,t){t(I())},rmdir(C,B){B(I())},stat(C,B){B(I())},symlink(C,B,t){t(I())},truncate(C,B,t){t(I())},unlink(C,B){B(I())},utimes(C,B,t,o){o(I())}}}if(globalThis.process||(globalThis.process={getuid(){return-1},getgid(){return-1},geteuid(){return-1},getegid(){return-1},getgroups(){throw I()},pid:-1,ppid:-1,umask(){throw I()},cwd(){throw I()},chdir(){throw I()}}),!globalThis.crypto)throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");if(!globalThis.performance)throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");if(!globalThis.TextEncoder)throw new Error("globalThis.TextEncoder is not available, polyfill required");if(!globalThis.TextDecoder)throw new Error("globalThis.TextDecoder is not available, polyfill required");let F=new TextEncoder("utf-8"),U=new TextDecoder("utf-8");globalThis.Go=class{constructor(){this.argv=["js"],this.env={},this.exit=P=>{P!==0&&console.warn("exit code:",P)},this._exitPromise=new Promise(P=>{this._resolveExitPromise=P}),this._pendingEvent=null,this._scheduledTimeouts=new Map,this._nextCallbackTimeoutID=1;let W=(P,n)=>{this.mem.setUint32(P+0,n,!0),this.mem.setUint32(P+4,Math.floor(n/4294967296),!0)},C=P=>{let n=this.mem.getUint32(P+0,!0),r=this.mem.getInt32(P+4,!0);return n+r*4294967296},B=P=>{let n=this.mem.getFloat64(P,!0);if(n===0)return;if(!isNaN(n))return n;let r=this.mem.getUint32(P,!0);return this._values[r]},t=(P,n)=>{if(typeof n=="number"&&n!==0){if(isNaN(n)){this.mem.setUint32(P+4,2146959360,!0),this.mem.setUint32(P,0,!0);return}this.mem.setFloat64(P,n,!0);return}if(n===void 0){this.mem.setFloat64(P,0,!0);return}let A=this._ids.get(n);A===void 0&&(A=this._idPool.pop(),A===void 0&&(A=this._values.length),this._values[A]=n,this._goRefCounts[A]=0,this._ids.set(n,A)),this._goRefCounts[A]++;let $=0;switch(typeof n){case"object":n!==null&&($=1);break;case"string":$=2;break;case"symbol":$=3;break;case"function":$=4;break}this.mem.setUint32(P+4,2146959360|$,!0),this.mem.setUint32(P,A,!0)},o=P=>{let n=C(P+0),r=C(P+8);return new Uint8Array(this._inst.exports.mem.buffer,n,r)},p=P=>{let n=C(P+0),r=C(P+8),A=new Array(r);for(let $=0;$<r;$++)A[$]=B(n+$*8);return A},s=P=>{let n=C(P+0),r=C(P+8);return U.decode(new DataView(this._inst.exports.mem.buffer,n,r))},c=Date.now()-performance.now();this.importObject={go:{"runtime.wasmExit":P=>{P>>>=0;let n=this.mem.getInt32(P+8,!0);this.exited=!0,delete this._inst,delete this._values,delete this._goRefCounts,delete this._ids,delete this._idPool,this.exit(n)},"runtime.wasmWrite":P=>{P>>>=0;let n=C(P+8),r=C(P+16),A=this.mem.getInt32(P+24,!0);fs.writeSync(n,new Uint8Array(this._inst.exports.mem.buffer,r,A))},"runtime.resetMemoryDataView":P=>{P>>>=0,this.mem=new DataView(this._inst.exports.mem.buffer)},"runtime.nanotime1":P=>{P>>>=0,W(P+8,(c+performance.now())*1e6)},"runtime.walltime":P=>{P>>>=0;let n=new Date().getTime();W(P+8,n/1e3),this.mem.setInt32(P+16,n%1e3*1e6,!0)},"runtime.scheduleTimeoutEvent":P=>{P>>>=0;let n=this._nextCallbackTimeoutID;this._nextCallbackTimeoutID++,this._scheduledTimeouts.set(n,setTimeout(()=>{for(this._resume();this._scheduledTimeouts.has(n);)console.warn("scheduleTimeoutEvent: missed timeout event"),this._resume()},C(P+8)+1)),this.mem.setInt32(P+16,n,!0)},"runtime.clearTimeoutEvent":P=>{P>>>=0;let n=this.mem.getInt32(P+8,!0);clearTimeout(this._scheduledTimeouts.get(n)),this._scheduledTimeouts.delete(n)},"runtime.getRandomData":P=>{P>>>=0,crypto.getRandomValues(o(P+8))},"syscall/js.finalizeRef":P=>{P>>>=0;let n=this.mem.getUint32(P+8,!0);if(this._goRefCounts[n]--,this._goRefCounts[n]===0){let r=this._values[n];this._values[n]=null,this._ids.delete(r),this._idPool.push(n)}},"syscall/js.stringVal":P=>{P>>>=0,t(P+24,s(P+8))},"syscall/js.valueGet":P=>{P>>>=0;let n=Reflect.get(B(P+8),s(P+16));P=this._inst.exports.getsp()>>>0,t(P+32,n)},"syscall/js.valueSet":P=>{P>>>=0,Reflect.set(B(P+8),s(P+16),B(P+32))},"syscall/js.valueDelete":P=>{P>>>=0,Reflect.deleteProperty(B(P+8),s(P+16))},"syscall/js.valueIndex":P=>{P>>>=0,t(P+24,Reflect.get(B(P+8),C(P+16)))},"syscall/js.valueSetIndex":P=>{P>>>=0,Reflect.set(B(P+8),C(P+16),B(P+24))},"syscall/js.valueCall":P=>{P>>>=0;try{let n=B(P+8),r=Reflect.get(n,s(P+16)),A=p(P+32),$=Reflect.apply(r,n,A);P=this._inst.exports.getsp()>>>0,t(P+56,$),this.mem.setUint8(P+64,1)}catch(n){P=this._inst.exports.getsp()>>>0,t(P+56,n),this.mem.setUint8(P+64,0)}},"syscall/js.valueInvoke":P=>{P>>>=0;try{let n=B(P+8),r=p(P+16),A=Reflect.apply(n,void 0,r);P=this._inst.exports.getsp()>>>0,t(P+40,A),this.mem.setUint8(P+48,1)}catch(n){P=this._inst.exports.getsp()>>>0,t(P+40,n),this.mem.setUint8(P+48,0)}},"syscall/js.valueNew":P=>{P>>>=0;try{let n=B(P+8),r=p(P+16),A=Reflect.construct(n,r);P=this._inst.exports.getsp()>>>0,t(P+40,A),this.mem.setUint8(P+48,1)}catch(n){P=this._inst.exports.getsp()>>>0,t(P+40,n),this.mem.setUint8(P+48,0)}},"syscall/js.valueLength":P=>{P>>>=0,W(P+16,parseInt(B(P+8).length))},"syscall/js.valuePrepareString":P=>{P>>>=0;let n=F.encode(String(B(P+8)));t(P+16,n),W(P+24,n.length)},"syscall/js.valueLoadString":P=>{P>>>=0;let n=B(P+8);o(P+16).set(n)},"syscall/js.valueInstanceOf":P=>{P>>>=0,this.mem.setUint8(P+24,B(P+8)instanceof B(P+16)?1:0)},"syscall/js.copyBytesToGo":P=>{P>>>=0;let n=o(P+8),r=B(P+32);if(!(r instanceof Uint8Array||r instanceof Uint8ClampedArray)){this.mem.setUint8(P+48,0);return}let A=r.subarray(0,n.length);n.set(A),W(P+40,A.length),this.mem.setUint8(P+48,1)},"syscall/js.copyBytesToJS":P=>{P>>>=0;let n=B(P+8),r=o(P+16);if(!(n instanceof Uint8Array||n instanceof Uint8ClampedArray)){this.mem.setUint8(P+48,0);return}let A=r.subarray(0,n.length);n.set(A),W(P+40,A.length),this.mem.setUint8(P+48,1)},debug:P=>{console.log(P)}}}}async run(W){if(!(W instanceof WebAssembly.Instance))throw new Error("Go.run: WebAssembly.Instance expected");this._inst=W,this.mem=new DataView(this._inst.exports.mem.buffer),this._values=[NaN,0,null,!0,!1,globalThis,this],this._goRefCounts=new Array(this._values.length).fill(1/0),this._ids=new Map([[0,1],[null,2],[!0,3],[!1,4],[globalThis,5],[this,6]]),this._idPool=[],this.exited=!1;let C=4096,B=P=>{let n=C,r=F.encode(P+"\0");return new Uint8Array(this.mem.buffer,C,r.length).set(r),C+=r.length,C%8!==0&&(C+=8-C%8),n},t=this.argv.length,o=[];this.argv.forEach(P=>{o.push(B(P))}),o.push(0),Object.keys(this.env).sort().forEach(P=>{o.push(B(`${P}=${this.env[P]}`))}),o.push(0);let s=C;o.forEach(P=>{this.mem.setUint32(C,P,!0),this.mem.setUint32(C+4,0,!0),C+=8});let c=4096+8192;if(C>=c)throw new Error("total length of command line and environment variables exceeds limit");this._inst.exports.run(t,s),this.exited&&this._resolveExitPromise(),await this._exitPromise}_resume(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}_makeFuncWrapper(W){let C=this;return function(){let B={id:W,this:this,args:arguments};return C._pendingEvent=B,C._resume(),B.result}}}})();var oA="./main.wasm";var pA=jA(sA()),lA=jA(aA()),dA=jA(cA());function HA(I,F,U,W,C){var r;let B=(r=I.ownerDocument.defaultView)!=null?r:window,t=new pA.Terminal(rA({cursorBlink:!0,allowProposedApi:!0},C)),o=new lA.FitAddon;t.loadAddon(o),t.open(I),o.fit();let p=new dA.WebLinksAddon((A,$)=>{var e;return(e=A.view)==null?void 0:e.open($,"_blank","noopener")});t.loadAddon(p);let s;t.onData(A=>{s==null||s(A)}),t.focus();let c,P,n=U.ssh(F.hostname,F.username,{writeFn(A){t.write(A)},writeErrorFn(A){var $;($=W.onError)==null||$.call(W,A),t.write(A)},setReadFn(A){s=A},rows:t.rows,cols:t.cols,onConnectionProgress:W.onConnectionProgress,onConnected:W.onConnected,onDone(){c==null||c.disconnect(),t.dispose(),P&&B.removeEventListener("unload",P),W.onDone()},timeoutSeconds:F.timeoutSeconds});c=new B.ResizeObserver(()=>o.fit()),c.observe(I),t.onResize(({rows:A,cols:$})=>n.resize(A,$)),P=()=>n.close(),B.addEventListener("unload",P)}async function y7(I){var W;let F=new Go,U=await WebAssembly.instantiateStreaming(fetch((W=I.wasmURL)!=null?W:oA),F.importObject);return F.run(U.instance).then(()=>I.panicHandler("Unexpected shutdown")),newIPN(I)}export{y7 as createIPN,HA as runSSHSession};
//# sourceMappingURL=pkg.js.map
